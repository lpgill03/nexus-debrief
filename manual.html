<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="NEXUS INVESTING - Complete User Manual & Technical Reference - Version 98.1">
    <meta name="keywords" content="algorithmic trading, options trading, iron condor, IBKR, live trading, LLM agents">
    <title>NEXUS INVESTING - User Manual V98.1</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@400;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-dark: #2d3e50;
            --primary-blue: #98c1d9;
            --secondary-blue: #415a7a;
            --accent-blue: #5fa8d3;
            --text-color: #2c3e50;
            --light-bg: #f8f9fa;
            --border-color: #ddd;
            --code-bg: #1e293b;
            --code-text: #e2e8f0;
            --info-bg: #e7f3ff;
            --info-border: #0066cc;
            --warning-bg: #fff8e7;
            --warning-border: #ff9800;
            --danger-bg: #ffe7e7;
            --danger-border: #f44336;
            --success-bg: #e7ffe7;
            --success-border: #4caf50;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @media print {
            @page {
                size: letter;
                margin: 1in;
            }
            body {
                margin: 0;
                padding: 0;
            }
            .page-break {
                page-break-before: always;
            }
        }

        html {
            font-size: 16px;
        }

        body {
            font-family: 'Inter', sans-serif;
            color: var(--text-color);
            line-height: 1.6;
            background-color: white;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }

        /* Typography */
        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 1.5rem 0 1rem 0;
            color: var(--primary-dark);
            letter-spacing: -0.5px;
        }

        h2 {
            font-size: 2rem;
            font-weight: 700;
            margin: 1.5rem 0 0.75rem 0;
            color: var(--primary-dark);
            border-bottom: 3px solid var(--primary-blue);
            padding-bottom: 0.5rem;
        }

        h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 1.25rem 0 0.5rem 0;
            color: var(--secondary-blue);
        }

        h4 {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 1rem 0 0.5rem 0;
            color: var(--text-color);
        }

        h5 {
            font-size: 1rem;
            font-weight: 600;
            margin: 0.75rem 0 0.25rem 0;
            color: var(--secondary-blue);
        }

        p {
            margin-bottom: 1rem;
            text-align: justify;
        }

        ul, ol {
            margin-left: 2rem;
            margin-bottom: 1rem;
        }

        li {
            margin-bottom: 0.5rem;
        }

        a {
            color: var(--primary-blue);
            text-decoration: none;
            font-weight: 500;
        }

        a:hover {
            text-decoration: underline;
            color: var(--accent-blue);
        }

        /* Cover Page */
        .cover-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--secondary-blue) 100%);
            color: white;
            padding: 40px 20px;
            page-break-after: always;
        }

        .cover-title {
            font-size: 4rem;
            font-weight: 700;
            margin-bottom: 20px;
            letter-spacing: -1px;
        }

        .cover-subtitle {
            font-size: 1.8rem;
            font-weight: 300;
            margin-bottom: 40px;
            opacity: 0.95;
        }

        .cover-edition {
            font-size: 1.3rem;
            margin-bottom: 60px;
            border-top: 2px solid var(--primary-blue);
            border-bottom: 2px solid var(--primary-blue);
            padding: 20px 0;
            font-weight: 500;
        }

        .meta-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            width: 100%;
            max-width: 600px;
            margin-bottom: 60px;
            text-align: left;
            font-size: 0.95rem;
        }

        .meta-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 5px;
            border-left: 3px solid var(--primary-blue);
        }

        .meta-label {
            font-weight: 600;
            font-size: 0.85rem;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .meta-value {
            font-size: 1rem;
            font-weight: 500;
        }

        .legal-box {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--primary-blue);
            border-radius: 5px;
            padding: 20px;
            max-width: 600px;
            font-size: 0.9rem;
            line-height: 1.5;
            color: rgba(255, 255, 255, 0.9);
        }

        /* Table of Contents */
        .toc-container {
            page-break-after: always;
        }

        .toc-title {
            text-align: center;
            font-size: 2.5rem;
            margin: 2rem 0 2rem 0;
            color: var(--primary-dark);
        }

        .toc-part {
            margin: 2rem 0;
        }

        .toc-part-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 1rem;
            border-left: 4px solid var(--primary-blue);
            padding-left: 1rem;
        }

        .toc-chapter {
            margin-left: 1.5rem;
            margin-bottom: 0.75rem;
            font-size: 0.95rem;
        }

        .toc-chapter a {
            color: var(--text-color);
        }

        .toc-section {
            margin-left: 3rem;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: #666;
        }

        /* Part Headers */
        .part-header {
            page-break-before: always;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--accent-blue) 100%);
            color: white;
            text-align: center;
            padding: 40px 20px;
            margin: 0;
            page-break-after: always;
        }

        .part-header-content h2 {
            font-size: 3.5rem;
            color: white;
            border: none;
            margin-bottom: 20px;
        }

        .part-header-content p {
            font-size: 1.3rem;
            font-weight: 300;
            opacity: 0.95;
        }

        /* Content Sections */
        .chapter {
            margin: 2rem 0;
        }

        .section {
            margin: 1.5rem 0;
        }

        /* Info Boxes */
        .info-box {
            border-left: 4px solid;
            border-radius: 4px;
            padding: 15px;
            margin: 1.5rem 0;
            font-size: 0.95rem;
        }

        .info-box.note {
            background-color: var(--info-bg);
            border-color: var(--info-border);
        }

        .info-box.warning {
            background-color: var(--warning-bg);
            border-color: var(--warning-border);
        }

        .info-box.danger {
            background-color: var(--danger-bg);
            border-color: var(--danger-border);
        }

        .info-box.success {
            background-color: var(--success-bg);
            border-color: var(--success-border);
        }

        .info-box strong {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        /* Code Blocks */
        code {
            font-family: 'Fira Code', monospace;
            font-size: 0.9rem;
        }

        p > code, li > code {
            background-color: rgba(30, 41, 59, 0.1);
            padding: 2px 6px;
            border-radius: 3px;
            color: var(--primary-dark);
            font-weight: 500;
        }

        pre {
            background-color: var(--code-bg);
            color: var(--code-text);
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 1.5rem 0;
            font-size: 0.85rem;
            line-height: 1.5;
            border: 1px solid #334155;
        }

        pre code {
            background: none;
            padding: 0;
            color: var(--code-text);
            font-weight: 400;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            border: 1px solid var(--border-color);
            font-size: 0.95rem;
        }

        th {
            background-color: var(--primary-blue);
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        tr:nth-child(even) {
            background-color: var(--light-bg);
        }

        tr:hover {
            background-color: rgba(152, 193, 217, 0.1);
        }

        /* Diagrams & Special Content */
        .diagram {
            background-color: var(--code-bg);
            border: 1px solid #334155;
            border-radius: 5px;
            padding: 15px;
            margin: 1.5rem 0;
            font-family: 'Fira Code', monospace;
            font-size: 0.85rem;
            color: var(--code-text);
            overflow-x: auto;
            line-height: 1.6;
        }

        .comparison-table {
            width: 100%;
            margin: 2rem 0;
        }

        .feature-list {
            list-style: none;
            margin-left: 0;
        }

        .feature-list li {
            padding-left: 1.5rem;
            position: relative;
            margin-bottom: 0.75rem;
        }

        .feature-list li:before {
            content: "✓";
            position: absolute;
            left: 0;
            color: var(--success-border);
            font-weight: bold;
        }

        /* Responsive Design */
        @media (max-width: 900px) {
            body {
                padding: 15px;
                font-size: 15px;
            }

            h1 {
                font-size: 2rem;
            }

            h2 {
                font-size: 1.7rem;
            }

            .meta-grid {
                grid-template-columns: 1fr;
            }

            table {
                font-size: 0.9rem;
            }

            th, td {
                padding: 10px;
            }
        }

        @media (max-width: 640px) {
            body {
                padding: 10px;
                font-size: 14px;
            }

            h1 {
                font-size: 1.7rem;
            }

            h2 {
                font-size: 1.4rem;
            }

            h3 {
                font-size: 1.2rem;
            }

            .cover-title {
                font-size: 2.5rem;
            }

            .cover-subtitle {
                font-size: 1.3rem;
            }

            pre {
                font-size: 0.75rem;
                padding: 10px;
            }

            table {
                font-size: 0.85rem;
                display: block;
                overflow-x: auto;
            }
        }

        @media (max-width: 480px) {
            html {
                font-size: 14px;
            }

            body {
                padding: 8px;
            }

            h1 {
                font-size: 1.5rem;
            }

            h2 {
                font-size: 1.2rem;
            }

            .cover-title {
                font-size: 2rem;
            }

            .meta-grid {
                gap: 15px;
            }
        }

        @media (max-width: 360px) {
            html {
                font-size: 13px;
            }

            body {
                padding: 5px;
            }

            h1 {
                font-size: 1.3rem;
            }

            h2 {
                font-size: 1.1rem;
            }

            .meta-grid {
                gap: 10px;
            }

            th, td {
                padding: 6px;
            }
        }

        /* Print Styles */
        @media print {
            body {
                padding: 0;
                background: white;
            }

            a {
                color: var(--text-color);
                text-decoration: none;
            }

            .page-break {
                page-break-before: always;
            }

            h2 {
                page-break-after: avoid;
            }

            h3 {
                page-break-after: avoid;
            }

            .info-box {
                page-break-inside: avoid;
            }

            table {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>

<!-- COVER PAGE -->
<div class="cover-page">
    <div class="cover-title">NEXUS INVESTING</div>
    <div class="cover-subtitle">Complete User Manual & Technical Reference</div>
    <div class="cover-edition">Version 98.1 — Live Iron Condor Trading Engine</div>

    <div class="meta-grid">
        <div class="meta-item">
            <div class="meta-label">Edition</div>
            <div class="meta-value">V98.1</div>
        </div>
        <div class="meta-item">
            <div class="meta-label">Release Date</div>
            <div class="meta-value">February 2026</div>
        </div>
        <div class="meta-item">
            <div class="meta-label">Classification</div>
            <div class="meta-value">Confidential</div>
        </div>
        <div class="meta-item">
            <div class="meta-label">Framework</div>
            <div class="meta-value">Python 3.10+ / LangGraph</div>
        </div>
        <div class="meta-item">
            <div class="meta-label">Architecture</div>
            <div class="meta-value">Two-Lane + Premium Selling</div>
        </div>
        <div class="meta-item">
            <div class="meta-label">Deployment</div>
            <div class="meta-value">Docker / Synology NAS</div>
        </div>
    </div>

    <div class="legal-box">
        <strong>CONFIDENTIALITY NOTICE</strong><br><br>
        This manual contains proprietary and confidential information relating to the NEXUS INVESTING algorithmic trading system. The information herein is intended solely for authorized users. Unauthorized access, reproduction, or distribution is strictly prohibited. All trading involves substantial risk of loss. Past performance does not guarantee future results. Users must have appropriate experience and risk tolerance before deploying this system with real capital.
    </div>
</div>

<!-- TABLE OF CONTENTS -->
<div class="toc-container">
    <h1 class="toc-title">Table of Contents</h1>

    <div class="toc-part">
        <div class="toc-part-title">PART I: Introduction & System Overview</div>
        <div class="toc-chapter">Chapter 1: Introduction to Nexus Investing</div>
        <div class="toc-section">1.1 Executive Summary</div>
        <div class="toc-section">1.2 Core Philosophy</div>
        <div class="toc-section">1.3 V98.1 Strategic Evolution</div>
        <div class="toc-section">1.4 Key Innovations</div>
        <div class="toc-section">1.5 Target User Segments</div>
        <div class="toc-section">1.6 Document Structure Guide</div>
        <div class="toc-section">1.7 Legal & Risk Disclaimer</div>

        <div class="toc-chapter" style="margin-top: 1.5rem;">Chapter 2: System Architecture Overview</div>
        <div class="toc-section">2.1 Architectural Diagram</div>
        <div class="toc-section">2.2 Two-Lane Trading System</div>
        <div class="toc-section">2.3 Pre-Fetch Architecture V3.0</div>
        <div class="toc-section">2.4 Technology Stack</div>
        <div class="toc-section">2.5 File Structure</div>
        <div class="toc-section">2.6 Component Interactions</div>

        <div class="toc-chapter" style="margin-top: 1.5rem;">Chapter 3: What's New in V98.1</div>
        <div class="toc-section">3.1 Premium Selling Focus (Iron Condors & Credit Spreads)</div>
        <div class="toc-section">3.2 Walk-Forward Optimization (+181% Improvement)</div>
        <div class="toc-section">3.3 Live Iron Condor Execution</div>
        <div class="toc-section">3.4 IBKR TWS Broker Integration</div>
        <div class="toc-section">3.5 Trailing Stop Configuration Fix</div>
        <div class="toc-section">3.6 Opus Auditor Removal</div>
        <div class="toc-section">3.7 Strategy Diversity Validation</div>
        <div class="toc-section">3.8 Configuration Changes Summary</div>
        <div class="toc-section">3.9 Migration Guide from V96.1</div>
    </div>

    <div class="toc-part">
        <div class="toc-part-title">PART II: Installation & Setup</div>
        <div class="toc-chapter">Chapter 4: System Requirements</div>
        <div class="toc-section">4.1 Hardware Requirements</div>
        <div class="toc-section">4.2 Software Requirements</div>
        <div class="toc-section">4.3 Network Requirements</div>
        <div class="toc-section">4.4 Account & API Requirements</div>

        <div class="toc-chapter" style="margin-top: 1.5rem;">Chapter 5: Installation Procedures</div>
        <div class="toc-section">5.1 Local Installation</div>
        <div class="toc-section">5.2 Docker Deployment</div>
        <div class="toc-section">5.3 IBKR Gateway Setup</div>
        <div class="toc-section">5.4 Common Installation Issues</div>

        <div class="toc-chapter" style="margin-top: 1.5rem;">Chapter 6: API Configuration</div>
        <div class="toc-section">6.1 Environment Variables</div>
        <div class="toc-section">6.2 API Key Generation</div>
        <div class="toc-section">6.3 Rate Limits and Quotas</div>

        <div class="toc-chapter" style="margin-top: 1.5rem;">Chapter 7: Initial Setup & Verification</div>
        <div class="toc-section">7.1 Database Initialization</div>
        <div class="toc-section">7.2 Verification Checklist</div>
        <div class="toc-section">7.3 Paper Trading Setup</div>
    </div>
</div>

<!-- PART I HEADER -->
<div class="part-header">
    <div class="part-header-content">
        <h2>PART I</h2>
        <p>Introduction & System Overview</p>
    </div>
</div>

<!-- CHAPTER 1: INTRODUCTION -->
<div class="chapter">
    <h2>Chapter 1: Introduction to Nexus Investing</h2>

    <h3>1.1 Executive Summary</h3>

    <p>Nexus Investing represents a next-generation algorithmic trading platform engineered specifically for options traders seeking consistent, repeatable returns through premium selling strategies. Built on a sophisticated multi-agent architecture powered by five distinct Large Language Model families (Claude Opus, Claude Haiku, GPT-4o, Gemini Pro, and Llama 3.1), Nexus orchestrates eight specialized agents that work in concert to identify, validate, and execute iron condor and credit spread trades across multiple underlyings. This system was designed from the ground up to overcome the fundamental limitations of directional call-buying strategies, which historically generate negative returns despite their apparent simplicity.</p>

    <p>The Version 98.1 release marks a watershed moment in the platform's evolution. Rather than pursuing incremental improvements, this release embraces a complete philosophical and technical restructuring around premium selling—specifically iron condors (IC) and credit spreads (CS). The historical data is unambiguous: call buying strategies deployed on this system generated negative $5,458 returns over a two-year period with a 13% win rate. In contrast, iron condor strategies produced positive $10,444 returns with a 90.1% win rate, while credit spreads achieved a perfect 100% win rate with $5,457 in total returns. This represents not merely a new feature, but a fundamental business model recalibration.</p>

    <p>V98.1 integrates live iron condor execution capabilities via Alpaca's options trading API, implementing a sophisticated four-leg order architecture that handles both entry limit orders and exit market orders with conditional exit logic based on 50% profit targets, 2x per-side stop losses, and time-based exits. Additionally, this release introduces Interactive Brokers (IBKR) TWS integration via the ib_insync library, enabling traders to leverage IBKR's superior options chains, tighter spreads, and advanced order management capabilities. The system incorporates walk-forward optimization that improved baseline strategy performance by 181%, delivering optimized delta targets of 0.25 (versus the previous 0.10-0.12), optimal wing spreads of 10 points (down from 20), and entry windows concentrated in the 09:35 UTC timeframe on Monday and Wednesday trading days.</p>

    <p>At its core, Nexus Investing answers a fundamental question: can an algorithmic trading system, through intelligent multi-model consensus, detailed pre-trade analysis, and disciplined execution, generate consistent returns in the options markets? The answer, demonstrated across twelve months of live and backtested trading data, is unequivocally yes. This manual provides you with the complete technical and operational framework to deploy this system in your own trading operations.</p>

    <h3>1.2 Core Philosophy</h3>

    <h4>1.2.1 Multi-Model Intelligence Through Consensus</h4>

    <p>No single artificial intelligence model possesses perfect market insight. Each of the five LLM families used by Nexus—Claude Opus for complex strategic reasoning, Claude Haiku for rapid tactical analysis, GPT-4o for numerical precision, Gemini Pro for pattern recognition, and Llama 3.1 for open-source reliability—brings distinct cognitive strengths and biases. Claude Opus excels at nuanced strategic thinking and considering multiple competing hypotheses simultaneously. GPT-4o demonstrates superior mathematical reasoning and numerical accuracy. Gemini Pro shows exceptional capability in visual pattern recognition and temporal analysis. Haiku provides extremely fast, cost-effective preliminary filtering. Llama 3.1 offers reproducibility and freedom from commercial constraints.</p>

    <p>Rather than selecting a single "best" model, Nexus implements a consensus architecture where decisions are validated across multiple models. When a majority of models agree on a trade opportunity, or when the models provide supporting arguments from different analytical angles, the system exhibits higher confidence. When models diverge significantly, the system either flags the analysis as ambiguous or seeks additional data. This multi-model consensus approach meaningfully reduces the prevalence of false signals and idiosyncratic biases inherent to any single model.</p>

    <h4>1.2.2 Radical Transparency in Analysis</h4>

    <p>Every trade decision must be explicable. The system captures the complete reasoning chain: what signals triggered the analysis, which models were consulted, what data was evaluated, what concerns or risks were identified, and what alternative actions were considered and rejected. This transparency serves multiple critical functions. It enables human review and override when analysis appears flawed. It creates an audit trail for regulatory compliance. It facilitates continuous system improvement by making failures observable and analytically traceable. And critically, it builds confidence in the system's recommendations—traders are far more likely to follow algorithmic advice they understand than advice presented as a "black box."</p>

    <h4>1.2.3 Disciplined Execution Above All</h4>

    <p>Discipline is the hardest variable to automate because it requires suppressing the human instinct to react emotionally to market movements. Nexus enforces discipline through hard technical constraints. Once a trade entry is executed, exit decisions follow predetermined rules: when the underlying moves 50% of the maximum possible profit to the trade, an automatic closing order executes regardless of market sentiment. When the underlying threatens to exceed 2x the per-side maximum loss on either the short call or short put, automatic loss-cutting occurs. At 2:30 PM UTC on expiration day, all positions automatically exit. These rules cannot be overridden by human emotion or market noise. They execute mechanically.</p>

    <h3>1.3 V98.1 Strategic Evolution</h3>

    <h4>1.3.1 The Problem with Call Buying</h4>

    <p>To understand why V98.1 represents such a fundamental departure, it's essential to understand what failed in prior versions. Previous Nexus implementations focused substantially on call option buying—purchasing out-of-the-money call options on bullish signals, with the premise that successful prediction of upward price movements would generate outsized returns. The theoretical rationale is sound: a call option provides leverage and defined risk. The practical reality, however, contradicts this theory.</p>

    <p>Over the two-year validation period (2022-2024), call buying strategies on Nexus generated the following results:</p>

    <ul>
        <li>Total Return: -$5,458 (negative)</li>
        <li>Win Rate: 13%</li>
        <li>Average Winning Trade: +$147</li>
        <li>Average Losing Trade: -$285</li>
        <li>Profit Factor: 0.43 (indicating losses significantly exceed wins)</li>
        <li>Total Trades: 247</li>
        <li>Consecutive Losing Streaks: Maximum 23 trades</li>
    </ul>

    <p>The fundamental problem: the system successfully predicted direction approximately 45-50% of the time, but the asymmetric payoff structure of purchased options makes this frequency insufficient. When the system correctly predicted direction, the average profit of $147 per trade often failed to materialize because option time decay accelerated into expiration or volatility contracted. When the system incorrectly predicted direction, the average loss of $285 materialized with cruel consistency because purchased options decay rapidly toward zero. The 13% win rate reflects the ultimate outcome: even when successful predictions substantially outnumbered failures, the mathematics of options decay created consistent account deterioration.</p>

    <p>This problem is not a flaw in Nexus's analytical capability. Rather, it reveals a fundamental truth about options mathematics: purchased options are inherently asymmetric instruments where the probability of expiration at zero exceeds the probability of meaningful profitability. Statistical analysis suggests that even with a 50% directional accuracy rate, purchased options lose money over time due to theta decay. This is not coincidental—it reflects that option sellers (the counterparties) are compensated for taking this risk.</p>

    <h4>1.3.2 Why Premium Selling (Iron Condors) Wins</h4>

    <p>Premium selling strategies—particularly iron condors—invert this asymmetry in favor of the option seller. Instead of purchasing options and hoping for large price movements, the iron condor strategy sells both an out-of-the-money call spread and an out-of-the-money put spread on the same underlying, collecting premium from both sides while betting that the underlying will remain between the sold strike prices at expiration. The mathematical advantage is profound:</p>

    <table>
        <tr>
            <th>Metric</th>
            <th>Call Buying</th>
            <th>Iron Condor</th>
            <th>Credit Spread</th>
        </tr>
        <tr>
            <td>Total Return (2-year)</td>
            <td>-$5,458</td>
            <td>+$10,444</td>
            <td>+$5,457</td>
        </tr>
        <tr>
            <td>Win Rate</td>
            <td>13%</td>
            <td>90.1%</td>
            <td>100%</td>
        </tr>
        <tr>
            <td>Average Winning Trade</td>
            <td>$147</td>
            <td>$187</td>
            <td>$156</td>
        </tr>
        <tr>
            <td>Average Losing Trade</td>
            <td>-$285</td>
            <td>-$284</td>
            <td>N/A</td>
        </tr>
        <tr>
            <td>Profit Factor</td>
            <td>0.43</td>
            <td>2.85</td>
            <td>Infinite</td>
        </tr>
        <tr>
            <td>Total Trades Executed</td>
            <td>247</td>
            <td>56</td>
            <td>18</td>
        </tr>
        <tr>
            <td>Best Consecutive Wins</td>
            <td>3 trades</td>
            <td>17 trades</td>
            <td>18 trades</td>
        </tr>
    </table>

    <p>The comparison is striking. Iron condors achieve a 90.1% win rate because they profit in a wide range of scenarios: significant upward movement, significant downward movement, or sideways consolidation. The strategy loses money only if the underlying penetrates one of the sold strike prices, which happens rarely when strikes are correctly selected. Credit spreads, being simpler one-sided positions, achieved a perfect 100% win rate in the validated sample, though with lower trade frequency due to stricter entry criteria.</p>

    <p>The mathematics explain the difference. When the system is correct (which occurs approximately 50% of the time), the iron condor captures the full premium sold, generating consistent profits. When the system is incorrect and the underlying moves against the position, the iron condor still remains profitable as long as the underlying hasn't penetrated the sold strike—which, due to proper strike selection, occurs infrequently. This creates a favorable asymmetry: high probability of profit, moderate profit size, and well-defined risk management.</p>

    <h4>1.3.3 V98.1 Feature Summary</h4>

    <table>
        <tr>
            <th>Feature</th>
            <th>Status</th>
            <th>Impact</th>
        </tr>
        <tr>
            <td>Live Iron Condor Execution</td>
            <td>NEW</td>
            <td>Enables real-money trading of optimized IC strategies via Alpaca API</td>
        </tr>
        <tr>
            <td>Walk-Forward Optimization</td>
            <td>ENHANCED</td>
            <td>+181% improvement in baseline strategy returns through parameter optimization</td>
        </tr>
        <tr>
            <td>IBKR TWS Integration</td>
            <td>NEW</td>
            <td>Access to IBKR's superior options chains, tighter spreads, advanced order management</td>
        </tr>
        <tr>
            <td>Trailing Stop Configuration Fix</td>
            <td>CRITICAL FIX</td>
            <td>Corrects stop-loss behavior; previous versions were catastrophic</td>
        </tr>
        <tr>
            <td>Opus Auditor Removal</td>
            <td>COST OPTIMIZATION</td>
            <td>Eliminated $374.40 annual cost for non-performing component</td>
        </tr>
        <tr>
            <td>Call Buying Strategy</td>
            <td>DEPRECATED</td>
            <td>Removed due to consistent negative returns; replaced with premium selling</td>
        </tr>
        <tr>
            <td>Deterministic Pre-Fetch V3.0</td>
            <td>OPTIMIZED</td>
            <td>Improved data cache efficiency and trade setup timing</td>
        </tr>
        <tr>
            <td>Multi-Model Consensus</td>
            <td>MAINTAINED</td>
            <td>All 5 LLM families remain operational for validation</td>
        </tr>
    </table>

    <h3>1.4 Key Innovations in V98.1</h3>

    <h4>1.4.1 Two-Lane Architecture</h4>

    <p>The system routes opportunities through two distinct execution pipelines, each with different risk tolerance and analysis depth. The APEX (Aggressive Profit Expression) lane operates in fast mode, executing trades when signals are strong but not necessarily overwhelming, accepting slightly higher false-positive rates in exchange for faster execution and more frequent opportunities. The Strategic lane operates in conservative mode, requiring multiple confirmatory signals and deeper analysis before execution, resulting in fewer trades but dramatically higher win rates.</p>

    <p>This dual-lane design recognizes that different traders have different risk tolerance. A trader with a large account and decades of experience might happily trade via the APEX lane to capture more opportunities, while a trader new to algorithmic trading might prefer the Strategic lane's cautious approach. Both lanes operate continuously, allowing a single instance of the system to serve multiple distinct operational models.</p>

    <h4>1.4.2 Deterministic Pre-Fetch V3.0</h4>

    <p>The system does not wait to receive trade opportunities and then begin analysis. Instead, it continuously pre-fetches market data—options chains, volatility metrics, earnings calendars, technical indicators—before any trade signal appears. When a signal materializes, the analysis begins with complete information already cached and validated. This dramatically reduces latency between signal identification and trade execution readiness. In the fastest cases, trade readiness can be achieved within 60-120 seconds of signal identification, critical for time-sensitive options trades.</p>

    <h4>1.4.3 Confluence Scoring V93+</h4>

    <p>Rather than using binary "trade or don't trade" decision logic, the system evaluates trade signals through a continuous scoring mechanism. A signal might receive a score of 4.2 out of 10.0 based on technical analysis, but when combined with fundamental data suggesting earnings catalysts (adding 1.5 points), macroeconomic positioning (adding 1.8 points), and consensus among multiple LLM models (adding 2.1 points), the total confluence score becomes 9.6, representing very high confidence. This scoring mechanism enables nuanced decision-making rather than binary thresholds.</p>

    <h4>1.4.4 Three-Tier Command Architecture</h4>

    <p>Commands to the execution engine flow through three distinct tiers. Tier 1 (Strategic) permits only the most conservative trades—those scoring above 8.5 confluence points with no contradictory data. Tier 2 (APEX) permits opportunistic trades scoring above 6.0. Tier 3 (Emergency Override) allows human traders to manually execute specific positions even if they don't meet systematic criteria. This architecture enables the system to function autonomously while preserving human override capability for unusual situations.</p>

    <h3>1.5 Target User Segments</h3>

    <h4>Professional Options Traders</h4>
    <p>Experienced traders with established options trading experience, minimum $50,000 account size, and familiarity with Greeks, volatility management, and multi-leg order execution. This segment values the system's analytical consensus mechanism and integration with professional-grade brokers like IBKR. Expected usage: 3-5 trades per week, deployed across 2-3 underlyings, with medium to large position sizes. Time commitment: 2-3 hours per trading day for monitoring and manual override decisions.</p>

    <h4>Retail Algorithmic Enthusiasts</h4>
    <p>Self-directed traders with programming knowledge or strong technical interest in algorithmic trading, minimum $25,000 account size, moderate options experience. This segment values the system's transparency and educational component—understanding why trades are recommended, not just receiving recommendations. Expected usage: 1-3 trades per week on a single underlying, with smaller position sizes. Time commitment: 1-2 hours per trading day plus active learning and system monitoring.</p>

    <h4>Wealth Managers & Advisory Firms</h4>
    <p>Professional advisors seeking systematic options strategies to integrate into broader portfolio construction for high-net-worth clients. This segment values the system's consistent returns, low volatility, and comprehensive audit trail for regulatory compliance. Expected usage: 2-4 trades per week across 3-5 underlyings, with position sizing determined by client account size. Time commitment: 1 hour per trading day for portfolio coordination plus weekly/monthly reporting.</p>

    <h4>Systematic Trading Programs</h4>
    <p>Institutions or high-frequency firms seeking to add systematic premium selling capabilities to their broader trading operations. This segment values integration capability, API access, and scalability across multiple underlyings simultaneously. Expected usage: 5-10 trades per week across 5+ underlyings with varying position sizes. Time commitment: Primarily system integration and ongoing performance monitoring; day-to-day trading is fully automated.</p>

    <h3>1.6 Document Structure Guide</h3>

    <p>This manual is divided into eight distinct parts, each serving different purposes within your deployment journey:</p>

    <p><strong>Part I: Introduction & System Overview</strong> provides context, philosophy, and high-level architectural understanding. Read this section thoroughly before any installation or configuration work. This section is essential for understanding why the system works the way it does.</p>

    <p><strong>Part II: Installation & Setup</strong> contains step-by-step procedural instructions for installing the system on your infrastructure. This section is reference material—you'll follow specific installation scripts and procedures without needing to understand the underlying code.</p>

    <p><strong>Part III: Configuration & Optimization</strong> details how to configure the system for your specific trading goals, risk tolerance, and market conditions. This is where you'll spend significant time customizing the system to your needs.</p>

    <p><strong>Part IV: Trading Operations</strong> explains how to monitor, supervise, and interact with the system once it's running. This is your day-to-day reference material.</p>

    <p><strong>Part V: API Reference</strong> provides comprehensive technical documentation of every function, class, and method in the system. This is reference material you'll consult when integrating the system with external tools or when debugging issues.</p>

    <p><strong>Part VI: Troubleshooting & Maintenance</strong> contains diagnostic procedures for common problems, plus maintenance schedules for system health.</p>

    <p><strong>Part VII: Advanced Topics</strong> covers specialized scenarios including multi-underling deployment, custom indicator development, and performance optimization.</p>

    <p><strong>Part VIII: Appendices</strong> includes reference tables, historical performance data, glossary, and support contact information.</p>

    <h3>1.7 Legal & Risk Disclaimer</h3>

    <div class="info-box danger">
        <strong>CRITICAL LEGAL NOTICE</strong>

        <p>Trading options involves substantial risk of loss. The Nexus Investing system, while engineered to generate consistent returns, is not guaranteed to be profitable. Past performance, whether backtested or live, does not guarantee future results. Market conditions change. Tail risks materialize. System assumptions break down.</p>

        <p><strong>You must have:</strong> (1) appropriate trading experience and knowledge; (2) adequate financial resources to absorb potential losses; (3) understanding of options Greeks, implied volatility, and portfolio margin implications; (4) sufficient trading capital—minimum $25,000 for futures account or $50,000 for standard margin account, depending on broker rules and strategy choices; (5) willingness to actively monitor positions and intervene when system behavior seems anomalous.</p>

        <p><strong>You must not:</strong> (1) deploy this system with borrowed capital you cannot afford to lose; (2) trade this system if you lack understanding of what it does; (3) assume the system will continue performing at historical rates; (4) disable loss-limiting safeguards for any reason; (5) trade during periods of market stress, high volatility, or system outages without explicit preparation.</p>

        <p><strong>Regulatory Note:</strong> Trading in US options markets requires a brokerage account at a registered broker. Nexus is not a registered investment advisor, fund, or broker. Users are entirely responsible for regulatory compliance in their jurisdiction. We recommend consulting with qualified legal and tax professionals before deploying this system.</p>
    </div>

</div>

<!-- CHAPTER 2: ARCHITECTURE -->
<div class="chapter">
    <h2>Chapter 2: System Architecture Overview</h2>

    <h3>2.1 Architectural Diagram</h3>

    <p>The Nexus Investing system operates through a sophisticated layered architecture where multiple subsystems communicate asynchronously through message queues and shared state management. Below is a text-based representation of the high-level architecture:</p>

    <div class="diagram">
┌─────────────────────────────────────────────────────────────────────────┐
│                           MARKET DATA LAYER                             │
│  (Real-time quotes, options chains, volatility surface, earnings data) │
└────────────────┬────────────────────────────┬────────────────────────────┘
                 │                            │
    ┌────────────▼─────────────┐  ┌──────────▼──────────────┐
    │   DATA VALIDATION &      │  │  CACHE/PRE-FETCH       │
    │   NORMALIZATION          │  │  (Deterministic V3.0)  │
    └────────────┬─────────────┘  └──────────┬──────────────┘
                 │                            │
    ┌────────────▼──────────────────────────▼────────────┐
    │  SIGNAL DETECTION ENGINE                           │
    │  - Technical Analysis (30+ indicators)             │
    │  - Fundamental Catalysts                           │
    │  - Macro Regime Detection                          │
    │  - LLM-Based Pattern Recognition                   │
    └────────────┬──────────────────────────┬────────────┘
                 │                          │
      ┌──────────▼──────────┐  ┌───────────▼──────────┐
      │  CONFLUENCE SCORING │  │  MULTI-MODEL        │
      │  (Combines signals) │  │  CONSENSUS (5 LLMs) │
      └──────────┬──────────┘  └───────────┬──────────┘
                 │                          │
      ┌──────────▼───────────────────────┬─▼──────────────┐
      │  TRADE OPPORTUNITY EVALUATION    │  CONFLUENCE    │
      │  (Valuation, Greeks, Probability)│  SCORE: 0-10   │
      └──────────┬───────────────────────┴─┬──────────────┘
                 │                          │
      ┌──────────▼──────────────────────────▼───────────┐
      │  TWO-LANE ROUTING SYSTEM                       │
      │  ┌───────────────────┬──────────────────────┐  │
      │  │ STRATEGIC LANE    │    APEX LANE         │  │
      │  │ (Conservative)    │    (Aggressive)      │  │
      │  │ Score: 8.5+       │    Score: 6.0+       │  │
      │  └──────────┬────────┴───────────┬──────────┘  │
      └─────────────┼────────────────────┼─────────────┘
                    │                    │
      ┌─────────────▼────┐  ┌───────────▼──────────┐
      │  ORDER BUILDING  │  │  ORDER BUILDING      │
      │  (4-leg IC/CS)   │  │  (4-leg IC/CS)       │
      └─────────────┬────┘  └───────────┬──────────┘
                    │                    │
      ┌─────────────▼────────────────────▼──────────────┐
      │  EXECUTION ENGINE (BROKER ABSTRACTION)          │
      │  - Alpaca: REST API, direct multi-leg orders   │
      │  - IBKR: ib_insync library, sophisticated API  │
      │  - Paper Trading: Mock order execution          │
      └─────────────┬────────────────────┬──────────────┘
                    │                    │
      ┌─────────────▼────┐  ┌───────────▼──────────┐
      │ LIVE ORDER       │  │ POSITION MONITORING  │
      │ MANAGEMENT       │  │ & EXIT LOGIC         │
      │ (Limit/Market)   │  │ - 50% profit exits   │
      │                  │  │ - Stop loss triggers │
      │                  │  │ - Time-based exits   │
      └─────────────┬────┘  └───────────┬──────────┘
                    │                    │
      ┌─────────────▼────────────────────▼──────────────┐
      │  AUDIT LOG & PERFORMANCE TRACKING               │
      │  - Every trade, decision, signal                │
      │  - Real-time P&L tracking                       │
      │  - Performance attribution                      │
      └──────────────────────────────────────────────────┘
    </div>

    <h3>2.2 Two-Lane Trading System</h3>

    <h4>Strategic Lane (Conservative)</h4>

    <p>The Strategic lane represents the most conservative execution path, requiring extremely high confluence before executing any trade. This lane targets traders prioritizing reliability over frequency, or newer traders seeking to build confidence in system behavior.</p>

    <ul class="feature-list">
        <li>Minimum Confluence Score: 8.5 out of 10.0</li>
        <li>Required Validations: All three independent LLM models must agree</li>
        <li>Technical Confirmation: Minimum 3 independent technical signals</li>
        <li>Fundamental Confirmation: Must include earnings, macroeconomic, or technical regime confirmation</li>
        <li>Expected Frequency: 0.5-1.5 trades per week (highly selective)</li>
        <li>Typical Win Rate: 92-95% (very high confidence trades)</li>
        <li>Average Trade Duration: 5-7 days</li>
        <li>Position Sizing: Conservative (1-2% risk per trade)</li>
    </ul>

    <h4>APEX Lane (Aggressive)</h4>

    <p>The APEX (Aggressive Profit Expression) lane accepts lower confluence thresholds in exchange for higher trade frequency. This lane targets experienced traders comfortable with slightly higher false-positive rates in exchange for more opportunities and overall higher absolute returns.</p>

    <ul class="feature-list">
        <li>Minimum Confluence Score: 6.0 out of 10.0</li>
        <li>Required Validations: Majority agreement among LLM models (2 of 3)</li>
        <li>Technical Confirmation: Minimum 2 independent technical signals</li>
        <li>Fundamental Confirmation: Optional but valuable</li>
        <li>Expected Frequency: 2-4 trades per week (opportunistic)</li>
        <li>Typical Win Rate: 85-89% (still very strong)</li>
        <li>Average Trade Duration: 4-6 days</li>
        <li>Position Sizing: Moderate (1.5-2.5% risk per trade)</li>
    </ul>

    <h3>2.3 Pre-Fetch Architecture V3.0</h3>

    <p>Traditional trading systems wait for a signal to appear, then begin data collection and analysis. This sequential approach creates unnecessary latency. Nexus implements continuous pre-fetching where data collection occurs continuously in the background, updated at optimized intervals. When a signal appears, analysis begins with complete information already cached and validated.</p>

    <div class="diagram">
Time: 09:00 UTC  │  Data collection cycle begins
                 │  - Fetch full options chain
                 │  - Fetch current stock price & volume
                 │  - Fetch historical volatility
                 │  - Fetch earnings calendar
                 │  - Calculate technical indicators
                 │  Cache duration: 3 minutes (dynamic)

Time: 09:03 UTC  │  SIGNAL DETECTED
                 │  All necessary data available
                 │  Analysis begins immediately
                 │  Complete trade setup in 60-120 seconds

Time: 09:04 UTC  │  Trade execution ready
                 │  Decision: EXECUTE or SKIP

Time: 09:05 UTC  │  Next pre-fetch cycle begins
                 │  (Options expiration dates may have changed)
                 │  (Volatility surface updated)
                 │  (New earnings events loaded)
    </div>

    <p>This architecture creates three distinct cache layers:</p>

    <table>
        <tr>
            <th>Cache Layer</th>
            <th>Content</th>
            <th>Refresh Interval</th>
            <th>Priority</th>
        </tr>
        <tr>
            <td>L1 (Immediate)</td>
            <td>Current price, volume, bid/ask spreads</td>
            <td>30 seconds</td>
            <td>Highest - Used for entry/exit pricing</td>
        </tr>
        <tr>
            <td>L2 (Tactical)</td>
            <td>Full options chain, Greeks, implied vol</td>
            <td>180 seconds (3 min)</td>
            <td>High - Drives signal detection</td>
        </tr>
        <tr>
            <td>L3 (Strategic)</td>
            <td>Earnings calendar, economic events, news</td>
            <td>3600 seconds (1 hr)</td>
            <td>Medium - Provides fundamental context</td>
        </tr>
    </table>

    <h3>2.4 Technology Stack</h3>

    <table>
        <tr>
            <th>Component</th>
            <th>Technology</th>
            <th>Version</th>
            <th>Purpose</th>
        </tr>
        <tr>
            <td>Language Runtime</td>
            <td>Python</td>
            <td>3.10+</td>
            <td>All system logic, data processing, agent orchestration</td>
        </tr>
        <tr>
            <td>Agent Orchestration</td>
            <td>LangGraph</td>
            <td>0.1.0+</td>
            <td>Multi-agent coordination, workflow management</td>
        </tr>
        <tr>
            <td>LLM - Strategic</td>
            <td>Claude Opus</td>
            <td>claude-opus-4-20250514</td>
            <td>Complex analysis, multi-hypothesis reasoning</td>
        </tr>
        <tr>
            <td>LLM - Fast</td>
            <td>Claude Haiku</td>
            <td>claude-haiku-3-5-20241022</td>
            <td>Rapid preliminary filtering, cost optimization</td>
        </tr>
        <tr>
            <td>LLM - Numerical</td>
            <td>GPT-4o</td>
            <td>gpt-4o-2025-01-03</td>
            <td>Mathematical analysis, Greeks computation</td>
        </tr>
        <tr>
            <td>LLM - Pattern</td>
            <td>Gemini Pro</td>
            <td>gemini-2.0-flash</td>
            <td>Visual pattern recognition, temporal analysis</td>
        </tr>
        <tr>
            <td>LLM - Reproducible</td>
            <td>Llama 3.1</td>
            <td>llama-3.1-405b-instruct</td>
            <td>Open-source verification, reproducibility</td>
        </tr>
        <tr>
            <td>Message Queue</td>
            <td>Redis</td>
            <td>7.0+</td>
            <td>Asynchronous task queuing, state management</td>
        </tr>
        <tr>
            <td>Database</td>
            <td>PostgreSQL</td>
            <td>14+</td>
            <td>Persistent storage of trades, signals, performance data</td>
        </tr>
        <tr>
            <td>HTTP Client</td>
            <td>httpx</td>
            <td>0.24.0+</td>
            <td>Async HTTP requests to brokers and data APIs</td>
        </tr>
        <tr>
            <td>Options Analysis</td>
            <td>mibian</td>
            <td>0.1.6+</td>
            <td>Black-Scholes Greeks calculations</td>
        </tr>
        <tr>
            <td>Broker Integration</td>
            <td>Alpaca SDK</td>
            <td>2.0.0+</td>
            <td>Order execution, position management</td>
        </tr>
        <tr>
            <td>Broker Integration</td>
            <td>ib_insync</td>
            <td>0.9.17+</td>
            <td>IBKR TWS connectivity, advanced order types</td>
        </tr>
        <tr>
            <td>Data Processing</td>
            <td>pandas</td>
            <td>2.0+</td>
            <td>Time series analysis, OHLCV data processing</td>
        </tr>
        <tr>
            <td>Numerical Computing</td>
            <td>NumPy</td>
            <td>1.24+</td>
            <td>Mathematical operations, signal processing</td>
        </tr>
        <tr>
            <td>API Services</td>
            <td>FMP (Financial Modeling Prep)</td>
            <td>N/A</td>
            <td>Earnings calendar, economic events, fundamentals</td>
        </tr>
        <tr>
            <td>API Services</td>
            <td>Theta Terminal</td>
            <td>N/A</td>
            <td>Options analytics, volatility data</td>
        </tr>
        <tr>
            <td>API Services</td>
            <td>News/Sentiment</td>
            <td>N/A</td>
            <td>News filtering, sentiment analysis</td>
        </tr>
        <tr>
            <td>Containerization</td>
            <td>Docker</td>
            <td>24.0+</td>
            <td>System packaging, deployment</td>
        </tr>
        <tr>
            <td>NAS Runtime</td>
            <td>Synology Docker</td>
            <td>Latest</td>
            <td>NAS-based deployment runtime</td>
        </tr>
        <tr>
            <td>IBKR Gateway</td>
            <td>gnzsnz/ib-gateway</td>
            <td>Latest</td>
            <td>IB Gateway containerized image</td>
        </tr>
    </table>

    <h3>2.5 File Structure</h3>

    <p>The complete Nexus Investing system consists of the following directory structure. When you deploy the system, this exact structure will be created on your infrastructure:</p>

    <div class="diagram">
nexus-investing/
├── README.md                          # Project overview
├── LICENSE.md                         # Licensing terms
├── docker-compose.yml                 # Development compose config
├── docker-compose.prod.yml            # Production compose config
├── Dockerfile                         # Main application container
├── requirements.txt                   # Python dependencies
│
├── config/
│   ├── base.yaml                      # Base configuration template
│   ├── development.yaml               # Development overrides
│   ├── production.yaml                # Production overrides
│   ├── apex.yaml                      # APEX lane strategy config
│   ├── strategic.yaml                 # Strategic lane strategy config
│   └── .env.example                   # Environment template
│
├── src/
│   ├── __init__.py
│   ├── main.py                        # Application entry point
│   ├── settings.py                    # Configuration management
│   │
│   ├── brokers/
│   │   ├── __init__.py
│   │   ├── abstract.py                # Base broker interface
│   │   ├── alpaca.py                  # Alpaca broker implementation
│   │   ├── ibkr.py                    # IBKR TWS broker implementation
│   │   ├── paper.py                   # Paper trading simulation
│   │   └── factory.py                 # Broker factory pattern
│   │
│   ├── agents/
│   │   ├── __init__.py
│   │   ├── technical_agent.py         # Technical analysis agent
│   │   ├── fundamental_agent.py       # Fundamental analysis agent
│   │   ├── macro_agent.py             # Macro regime agent
│   │   ├── risk_agent.py              # Risk assessment agent
│   │   ├── execution_agent.py         # Order execution agent
│   │   ├── monitoring_agent.py        # Position monitoring agent
│   │   ├── llm_voter.py               # LLM consensus mechanism
│   │   └── orchestrator.py            # Agent coordination
│   │
│   ├── data/
│   │   ├── __init__.py
│   │   ├── fetchers.py                # Data fetching logic
│   │   ├── cache.py                   # Caching layer (Pre-Fetch V3.0)
│   │   ├── normalizer.py              # Data normalization
│   │   └── validators.py              # Data validation
│   │
│   ├── signals/
│   │   ├── __init__.py
│   │   ├── technical.py               # 30+ technical indicators
│   │   ├── fundamental.py             # Fundamental signals
│   │   ├── macro.py                   # Macro regime signals
│   │   ├── confluence.py              # Confluence scoring logic
│   │   └── detectors.py               # Signal detection logic
│   │
│   ├── strategies/
│   │   ├── __init__.py
│   │   ├── base.py                    # Base strategy class
│   │   ├── iron_condor.py             # Iron Condor strategy
│   │   ├── credit_spread.py           # Credit Spread strategy
│   │   └── position_sizing.py         # Position sizing logic
│   │
│   ├── orders/
│   │   ├── __init__.py
│   │   ├── builder.py                 # Multi-leg order builder
│   │   ├── validator.py               # Order validation
│   │   ├── executor.py                # Order execution logic
│   │   └── tracking.py                # Order status tracking
│   │
│   ├── trading/
│   │   ├── __init__.py
│   │   ├── engine.py                  # Main trading engine
│   │   ├── lanes.py                   # Two-lane routing logic
│   │   ├── exits.py                   # Exit condition logic
│   │   └── state.py                   # Trading state management
│   │
│   ├── database/
│   │   ├── __init__.py
│   │   ├── models.py                  # SQLAlchemy ORM models
│   │   ├── session.py                 # Database session management
│   │   └── migrations.py              # Schema migrations
│   │
│   ├── api/
│   │   ├── __init__.py
│   │   ├── routes.py                  # HTTP routes
│   │   └── schemas.py                 # Request/response schemas
│   │
│   └── utils/
│       ├── __init__.py
│       ├── logger.py                  # Logging configuration
│       ├── exceptions.py              # Custom exceptions
│       └── helpers.py                 # Utility functions
│
├── tests/
│   ├── __init__.py
│   ├── test_agents.py                 # Agent unit tests
│   ├── test_strategies.py             # Strategy backtests
│   ├── test_orders.py                 # Order building tests
│   ├── test_signals.py                # Signal detection tests
│   └── test_brokers.py                # Broker integration tests
│
├── notebooks/
│   ├── backtesting.ipynb              # Backtest analysis
│   ├── performance_analysis.ipynb     # Performance metrics
│   └── signal_exploration.ipynb       # Signal investigation
│
└── docs/
    ├── API.md                         # API reference
    ├── CONFIGURATION.md               # Configuration guide
    ├── TROUBLESHOOTING.md             # Troubleshooting guide
    └── EXAMPLES.md                    # Usage examples
    </div>

    <h3>2.6 Component Interactions</h3>

    <p>The components described above do not operate in isolation. Instead, they work through a carefully orchestrated sequence of interactions. Here's how a typical trade flows through the system:</p>

    <h4>1. Continuous Pre-Fetching (Background Process)</h4>
    <p>The system continuously fetches market data at optimized intervals, maintaining three cache layers (L1: 30 seconds, L2: 3 minutes, L3: 1 hour). This happens continuously throughout market hours regardless of whether a trade signal has appeared.</p>

    <h4>2. Signal Detection Trigger</h4>
    <p>When market conditions meet specific technical, fundamental, or macro criteria, the signal detection engine flags a potential opportunity. Multiple distinct signals can trigger simultaneously (e.g., technical oversold condition + earnings announcement + favorable macro regime).</p>

    <h4>3. Confluence Scoring</h4>
    <p>The system aggregates all detected signals into a single confluence score (0-10.0 range). A signal scoring 4.2 from technical analysis combined with 1.5 from earnings + 1.8 from macro + 2.1 from LLM consensus yields a total of 9.6, representing high confidence.</p>

    <h4>4. LLM Consensus Mechanism</h4>
    <p>All five LLM families independently evaluate the same opportunity without seeing each other's reasoning. They vote on whether to execute. The system captures their reasoning and areas of disagreement, which inform the confluence score.</p>

    <h4>5. Two-Lane Routing</h4>
    <p>Based on confluence score and configured risk tolerance, the opportunity routes to either the Strategic lane (very conservative, scores 8.5+) or APEX lane (opportunistic, scores 6.0+). If the score falls below the lane's threshold, the opportunity is logged but not executed.</p>

    <h4>6. Order Building</h4>
    <p>Once routing is confirmed, the order builder constructs the actual multi-leg order. For an iron condor, this involves: identifying optimal call strike pair, identifying optimal put strike pair, determining credit to collect, setting risk limit, and formatting the order in broker-specific syntax.</p>

    <h4>7. Risk Verification</h4>
    <p>Before any order reaches the broker, the risk agent validates: account has sufficient margin, position doesn't exceed account-level limits, trade duration aligns with volatility assumptions, and exit logic is properly configured.</p>

    <h4>8. Order Execution</h4>
    <p>The order transmits to the configured broker (Alpaca, IBKR, or paper trading). The system captures confirmation of order fill, entry price, and exact trade timestamp.</p>

    <h4>9. Position Monitoring</h4>
    <p>Once positions are open, the monitoring agent continuously evaluates exit conditions: 50% profit target reached, 2x per-side stop loss breached, time-based exit approaching (2:30 PM on expiration day). When conditions are met, exit orders automatically execute.</p>

    <h4>10. Audit Logging & Performance Tracking</h4>
    <p>Every step of this process—signal detection, confluence score, LLM votes, routing decision, order execution, position monitoring, and exit—is logged to the database. This audit trail enables post-trade analysis, continuous system improvement, and regulatory compliance.</p>

</div>

<!-- CHAPTER 3: WHAT'S NEW IN V98.1 - PART 1 -->
<div class="chapter">
    <h2>Chapter 3: What's New in V98.1</h2>

    <h3>3.1 Premium Selling Focus: Iron Condors & Credit Spreads</h3>

    <p>Version 98.1 represents a complete philosophical and architectural reorientation toward premium selling strategies, primarily iron condors and credit spreads. This shift is not based on theory or speculation—it emerges directly from empirical evidence comparing historical performance across multiple strategy types on the same system, same market conditions, and same trading capital.</p>

    <h4>Historical Problem: Call Buying Performance</h4>

    <p>In previous versions, the Nexus system invested substantial computational resources in identifying high-probability directional moves and purchasing call options to capture leveraged upside from those moves. The logic was straightforward: if the system could predict direction with better-than-random accuracy, leveraged options would generate outsized returns. However, this theoretical advantage failed to materialize in practice.</p>

    <div class="info-box warning">
        <strong>V96.1 Call Buying Reality Check</strong>

        <p>Two years of historical data (2022-2024) on call buying strategies:</p>
        <ul>
            <li>Total Return: -$5,458</li>
            <li>Win Rate: 13%</li>
            <li>Average Winning Trade: +$147</li>
            <li>Average Losing Trade: -$285</li>
            <li>Longest Losing Streak: 23 consecutive trades</li>
            <li>Profit Factor: 0.43</li>
        </ul>

        <p>This was not a temporary drawdown or statistical anomaly. The system identified directional opportunities with approximately 45-50% accuracy—better than random—yet still generated consistent losses. The fundamental problem: theta decay overwhelms directional accuracy in purchased options.</p>
    </div>

    <p>The mathematics are unforgiving. A purchased call option begins losing value the moment you own it. If the underlying is completely flat, the option loses value daily due to theta decay (time decay). If the underlying moves 1% in the correct direction, the option gains value. But because theta decay accelerates as expiration approaches, you need increasingly large directional moves to overcome this decay the closer you get to expiration. The net result: even with 50% directional accuracy, purchased options become a wealth destruction mechanism over time.</p>

    <h4>Why This Matters: The Greeks Perspective</h4>

    <p>For a purchased call, your profit/loss depends on three Greeks: Delta (directional exposure), Theta (daily time decay), and Vega (volatility exposure). Specifically:</p>

    <p><strong>Daily P&L ≈ Delta × Price Move - Theta - Vega × Volatility Change</strong></p>

    <p>If you purchase a call and the system correctly predicts direction (Delta is positive), but theta decay (-Theta) and volatility contraction (-Vega) happen faster than the underlying moves, you still lose money. This is not a system failure—this is the fundamental economics of options.</p>

    <p>Meanwhile, the counterparties (option sellers) face an inverse equation. They benefit from theta decay and volatility contraction while managing directional risk through strikes far away from current price. This asymmetry—where the seller profits from the passage of time and the buyer loses from it—is why institutional options traders predominantly sell premium rather than buy it.</p>

    <h4>The Solution: Iron Condor & Credit Spread Strategies</h4>

    <p>V98.1 inverts this asymmetry by positioning Nexus as the premium seller rather than the premium buyer. Instead of purchasing a call option and hoping for a large upward move, the system now sells both an out-of-the-money call spread and an out-of-the-money put spread on the same underlying, collecting premium from both sides and keeping that premium if the underlying remains between the sold strikes at expiration.</p>

    <p>The iron condor strategy operates through these mechanics:</p>

    <ul>
        <li><strong>Sell Out-of-the-Money (OTM) Call Spread:</strong> Sell a call at Strike A, buy a call at Strike B (higher), collect credit C1</li>
        <li><strong>Sell Out-of-the-Money (OTM) Put Spread:</strong> Sell a put at Strike D, buy a put at Strike E (lower), collect credit C2</li>
        <li><strong>Total Credit Collected:</strong> C1 + C2</li>
        <li><strong>Maximum Risk:</strong> (Strike A - Strike E) × 100 - Total Credit (if underlying moves beyond either sold strike)</li>
        <li><strong>Exit Condition 1:</strong> If underlying reaches 50% of maximum profit, automatically close (capture profits early)</li>
        <li><strong>Exit Condition 2:</strong> If underlying penetrates 2x per-side stop loss, exit immediately (cut losses)</li>
        <li><strong>Exit Condition 3:</strong> At 2:30 PM on expiration day, close all positions regardless</li>
    </ul>

    <p>The profit potential is high precisely because of this structure. The strategy profits if the underlying moves significantly up, significantly down, or stays flat—three out of three possible directional outcomes. The strategy only loses if the underlying moves beyond one of the sold strikes, which happens rarely when strikes are properly selected based on implied volatility and expected move calculations.</p>

    <h4>Historical Comparison: Call Buying vs. Premium Selling</h4>

    <table>
        <tr>
            <th>Metric</th>
            <th>Call Buying</th>
            <th>Iron Condor</th>
            <th>Credit Spread</th>
        </tr>
        <tr>
            <td><strong>Total Return (2022-2024)</strong></td>
            <td>-$5,458</td>
            <td>+$10,444</td>
            <td>+$5,457</td>
        </tr>
        <tr>
            <td><strong>Win Rate</strong></td>
            <td>13%</td>
            <td>90.1%</td>
            <td>100%</td>
        </tr>
        <tr>
            <td><strong>Average Winning Trade</strong></td>
            <td>+$147</td>
            <td>+$187</td>
            <td>+$156</td>
        </tr>
        <tr>
            <td><strong>Average Losing Trade</strong></td>
            <td>-$285</td>
            <td>-$284</td>
            <td>N/A (no losses)</td>
        </tr>
        <tr>
            <td><strong>Profit Factor</strong></td>
            <td>0.43</td>
            <td>2.85</td>
            <td>Infinite*</td>
        </tr>
        <tr>
            <td><strong>Best Consecutive Wins</strong></td>
            <td>3 trades</td>
            <td>17 trades</td>
            <td>18 trades (perfect)</td>
        </tr>
        <tr>
            <td><strong>Worst Consecutive Losses</strong></td>
            <td>23 trades</td>
            <td>2 trades</td>
            <td>0 trades</td>
        </tr>
        <tr>
            <td><strong>Total Trades</strong></td>
            <td>247</td>
            <td>56</td>
            <td>18</td>
        </tr>
        <tr>
            <td><strong>Sharpe Ratio</strong></td>
            <td>-0.42</td>
            <td>2.18</td>
            <td>3.14</td>
        </tr>
    </table>

    <p><em>* Profit Factor = (Gross Profit / Gross Loss). For credit spreads with zero losses, this ratio is technically infinite. In practical terms, it means the strategy is perfectly profitable on the backtested sample.</em></p>

    <h4>The Mathematical Explanation</h4>

    <p>Why does premium selling work so dramatically better than premium buying? The answer lies in probability and payoff asymmetry:</p>

    <p><strong>Iron Condor Probability Distribution:</strong> An iron condor profits in three scenarios: underlying goes significantly up (short put spread expires worthless), significantly down (short call spread expires worthless), or stays within range (both spreads expire worthless). The strategy only loses if the underlying penetrates one of the sold strikes, which occurs rarely.</p>

    <p><strong>Specific Example (SPY Iron Condor from backtests):</strong> Sell SPY 560 Call / Buy SPY 570 Call + Sell SPY 480 Put / Buy SPY 470 Put for $2.12 credit (2024-01-16 setup). Maximum profit: $212. Maximum loss: $788. Risk/reward: 3.7:1 in favor of profit. SPY at the time was $470, implying the underlying would need to move more than 18.6% up or -4.3% down to hit a sold strike. With only 5 days to expiration, such a large move is probabilistically unlikely. Result: +$212 profit.</p>

    <p><strong>Call Buying Probability Distribution:</strong> A purchased call profits only if the underlying moves significantly upward. If the underlying is completely flat, the call loses value daily due to theta decay. If the underlying moves down, the call loses value. The strategy profits in only one scenario (significant upward move), loses in two scenarios (flat or down), and requires the upward move to overcome theta decay to be profitable. This is inherently a poor probability game—betting on one outcome when two out of three outcomes are losses.</p>

    <h3>3.2 Walk-Forward Optimization: +181% Performance Improvement</h3>

    <p>While premium selling addresses the fundamental strategic problem, V98.1 further improves performance through advanced walk-forward optimization. This optimization process analyzed 24 months of historical SPY data, split into overlapping training and testing windows, to identify optimal parameter sets for different market regimes.</p>

    <h4>Optimization Results</h4>

    <p>The walk-forward process tested over 1,800 distinct parameter combinations across the following dimensions:</p>

    <ul>
        <li><strong>Delta Targets:</strong> 0.10, 0.12, 0.15, 0.20, 0.25, 0.30 (strike selection based on delta)</li>
        <li><strong>Wing Spread:</strong> 5, 10, 15, 20, 25 points (distance between short and long strikes)</li>
        <li><strong>Days-to-Expiration:</strong> 5, 7, 10, 14, 21 days (trade duration)</li>
        <li><strong>Entry Time Window:</strong> 09:15 UTC, 09:30 UTC, 09:35 UTC, 09:45 UTC, 10:00 UTC, 10:30 UTC (entry timing)</li>
        <li><strong>Entry Days:</strong> All weekdays, Monday-Wednesday only, Tuesday-Thursday only (day-of-week selection)</li>
    </ul>

    <h4>Optimal Parameter Set Discovered</h4>

    <table>
        <tr>
            <th>Parameter</th>
            <th>Baseline (V96.1)</th>
            <th>Optimized (V98.1)</th>
            <th>Rationale</th>
        </tr>
        <tr>
            <td>Delta Target (Puts)</td>
            <td>0.10-0.12</td>
            <td>0.25</td>
            <td>Further OTM strikes missed opportunities; 0.25 delta balances defense with credit</td>
        </tr>
        <tr>
            <td>Delta Target (Calls)</td>
            <td>0.12-0.15</td>
            <td>0.25</td>
            <td>Symmetric strikes improve Greeks distribution and capital efficiency</td>
        </tr>
        <tr>
            <td>Wing Spread</td>
            <td>20 points</td>
            <td>10 points</td>
            <td>Tighter wings reduce max loss while maintaining adequate credit collection</td>
        </tr>
        <tr>
            <td>Days-to-Expiration</td>
            <td>5-7 days</td>
            <td>7 days</td>
            <td>Sweet spot between theta acceleration and time decay risks</td>
        </tr>
        <tr>
            <td>Entry Window</td>
            <td>09:15-10:30 UTC</td>
            <td>09:35 UTC (exact)</td>
            <td>Avoids gap risk from overnight and provides optimal IV crush timing</td>
        </tr>
        <tr>
            <td>Entry Days</td>
            <td>All weekdays</td>
            <td>Monday & Wednesday</td>
            <td>Historical data shows Monday-Wednesday setups have 18% higher win rates</td>
        </tr>
    </table>

    <h4>Performance Improvement Quantified</h4>

    <p>Comparing the optimized parameter set against the baseline from V96.1 on the same 2024 out-of-sample data:</p>

    <table>
        <tr>
            <th>Metric</th>
            <th>Baseline (V96.1)</th>
            <th>Optimized (V98.1)</th>
            <th>Improvement</th>
        </tr>
        <tr>
            <td>Total Return</td>
            <td>$2,188</td>
            <td>$6,160</td>
            <td>+181.6%</td>
        </tr>
        <tr>
            <td>Win Rate</td>
            <td>87.3%</td>
            <td>90.1%</td>
            <td>+2.8 percentage points</td>
        </tr>
        <tr>
            <td>Average Winning Trade</td>
            <td>$165</td>
            <td>$187</td>
            <td>+13.3%</td>
        </tr>
        <tr>
            <td>Average Losing Trade</td>
            <td>-$312</td>
            <td>-$284</td>
            <td>-8.9% (smaller losses)</td>
        </tr>
        <tr>
            <td>Risk-Adjusted Return (Sharpe)</td>
            <td>1.44</td>
            <td>2.18</td>
            <td>+51.4%</td>
        </tr>
        <tr>
            <td>Maximum Drawdown</td>
            <td>-$1,847</td>
            <td>-$1,203</td>
            <td>-34.9% (smaller DD)</td>
        </tr>
        <tr>
            <td>Consecutive Losing Streak</td>
            <td>4 trades</td>
            <td>2 trades</td>
            <td>-50% (fewer losses)</td>
        </tr>
    </table>

    <h4>The Aggressive Selective Optimization Process</h4>

    <p>V98.1 implements "Aggressive Selective Optimization," a process that only applies optimized parameters to trades meeting specific high-confidence criteria:</p>

    <ul>
        <li><strong>Rule 1:</strong> Use optimized parameters only when confluence score exceeds 7.5 (high-confidence setups)</li>
        <li><strong>Rule 2:</strong> If confluence score is 6.0-7.5, use baseline parameters (more conservative)</li>
        <li><strong>Rule 3:</strong> If confluence score is below 6.0, skip trade (insufficient conviction)</li>
        <li><strong>Rule 4:</strong> Always use Monday/Wednesday entry days; skip other weekdays unless confluence score exceeds 8.5</li>
    </ul>

    <p>This selective approach prevents over-fitting to historical data while capturing the genuine performance improvement from the optimized parameter set.</p>

    <h4>Gatekeeper IC Availability Bonus</h4>

    <p>An additional feature in the optimization system provides bonus scoring when iron condor conditions are particularly attractive:</p>

    <p><strong>Base Bonus (if IV Rank above 50%):</strong> +0.10 confluence points</p>

    <p><strong>Flat Day Bonus (if expected move &lt; 0.5% of stock price):</strong> +0.15 confluence points</p>

    <p><strong>Credit Bonus (if IC credit &gt; 2% of wing width):</strong> +0.08 confluence points</p>

    <p>These bonuses encourage the system to prioritize iron condor setups when market conditions are favorable, mathematically increasing expected returns.</p>

</div>


<!-- PART III HEADER -->
<div class="part-header">
    <div class="part-header-content">
        <h2>PART III</h2>
        <p>User Interface Guide & Dashboard Analytics</p>
    </div>
</div>

<!-- CHAPTER 8: MISSION CONTROL -->
<div class="chapter">
    <h2>Chapter 8: Mission Control — Autopilot Engine</h2>

    <p>Mission Control represents the operational nerve center of the Nexus Investing system. This unified dashboard provides real-time visibility into system status, market conditions, portfolio performance, and active positions. Unlike traditional trading platforms that present information passively, Mission Control actively orchestrates the complete trading lifecycle through the Autopilot Engine—an autonomous system capable of executing complete trading cycles from signal detection through position management without human intervention.</p>

    <h3>8.1 Overview: The Nerve Center</h3>

    <p>Mission Control serves as the single unified interface for all trading operations. Every market data point, signal detection event, confluence calculation, position management decision, and trade execution flows through Mission Control. The dashboard is designed for professional traders accustomed to multi-monitor setups, but optimized for responsive viewing on tablets and mobile devices for traders monitoring positions while away from their primary workstation.</p>

    <p>The core philosophy underlying Mission Control's design is radical transparency. Every automated decision must be explicable. When the system executes a trade, the reasoning is captured: what signals triggered it, which LLM models validated it, what confluence score was calculated, what risk checks were performed. When a position exits, the exact condition that triggered the exit is logged. This transparency enables human oversight and continuous improvement while building confidence in the automated system.</p>

    <h3>8.2 Engine Status Panel</h3>

    <p>The Engine Status Panel occupies the top section of Mission Control and displays four critical indicators:</p>

    <h4>Regime Indicator</h4>
    <p>Displays current market regime classification: Trending Up (green), Trending Down (red), or Consolidation (yellow). This classification is computed by analyzing multiple timeframe moving averages, MACD divergence, and ADX strength. When the market is in an uptrend, the system prioritizes call-selling opportunities while remaining cautious about put-selling. In a downtrend, the priority reverses. During consolidation, both call and put selling are equally attractive. The regime indicator updates every 5 minutes or whenever a significant volatility event occurs.</p>

    <h4>Running Status</h4>
    <p>Indicates whether the Autopilot Engine is actively running, paused, or in standby mode. Green means the engine is fully operational and monitoring for trade opportunities. Yellow indicates paused state (e.g., during major economic events or market halts). Red indicates the engine has automatically shutdown due to circuit breaker activation or critical system error. This status changes only when humans explicitly change it or when automated safeguards trigger.</p>

    <h4>Active Positions Count</h4>
    <p>Displays the total number of currently open positions across all strategies and underlyings. This number ranges from 0 (no active trades) to the configured maximum position limit (typically 3-5 concurrent iron condors). Each position listing includes the underlying symbol, strategy type (iron condor, credit spread), entry price, entry time, current P&L, and next exit decision point. Clicking any position opens detailed position management controls.</p>

    <h4>Buying Power</h4>
    <p>Displays available margin/buying power in the trading account. This directly constrains position sizing—the system will not initiate a new trade if the required margin would exceed available buying power. The buying power display includes three metrics: total account equity, required margin for all open positions, and available margin for new trades. As positions approach maximum loss, the required margin increases, which constrains future position sizing and serves as an automatic risk limit.</p>

    <h3>8.3 Market Health Indicator Panel</h3>

    <p>Market Health displays three critical macro indicators that influence trading decisions:</p>

    <h4>VIX (Volatility Index)</h4>
    <p>The VIX represents implied volatility of the S&P 500 and directly impacts options premium. When VIX is below 12, implied volatility is compressed and options premium is low—the system reduces position size to compensate for low premium collection. When VIX is between 15-25 (the optimal zone), premium is attractive and position sizing normalizes. When VIX exceeds 30, implied volatility is elevated and premium collection is exceptional—the system may increase position sizing. VIX above 40 typically triggers circuit breakers and temporarily halts new position initiation. The VIX display updates every 15 seconds and shows trend direction (up arrow = volatility rising, down arrow = volatility falling).</p>

    <h4>SPY Trend</h4>
    <p>Displays the current price trend of the S&P 500 ETF (SPY), the primary underlying for many iron condor trades. Shows the most recent 5-minute candle (OHLC), the daily trend (up or down), and key technical levels (daily high, daily low, 50-day MA, 200-day MA). When SPY is near all-time highs, the system becomes more cautious about call-selling (narrower call spreads, higher strike placement). When SPY is near all-time lows, the system becomes more cautious about put-selling. This trend information updates every 60 seconds.</p>

    <h4>Market Breadth Metrics</h4>
    <p>Displays advancing vs. declining stocks, bullish percent index (BPI), and put/call ratio. When breadth is positive (more advancing than declining), it suggests healthy bull momentum and supports call-selling strategies. When breadth is negative, it suggests distribution and favors put-selling. These metrics inform confluence scoring and help validate trade direction selections. Breadth data updates every 10 minutes from the data feed.</p>

    <h3>8.4 Portfolio Summary Metrics</h3>

    <p>The Portfolio Summary section displays aggregate portfolio metrics:</p>

    <h4>Total Equity</h4>
    <p>The current value of the trading account, calculated as (Initial Capital + Accumulated Profit/Loss). This number changes continuously as positions move. When positions are exited, the profit or loss is immediately reflected in total equity. This is the ultimate performance metric for the trading account.</p>

    <h4>Net Liquidation Value</h4>
    <p>Similar to total equity but includes the market value of all open positions. If you have an open iron condor position worth $284 (loss relative to collection), net liquidation value reflects this unrealized loss. This number fluctuates continuously during market hours as open positions gain and lose value.</p>

    <h4>Daily P&L</h4>
    <p>The cumulative profit or loss for the current calendar day. This resets at market close (4:00 PM UTC) each day. Daily P&L is broken down into two components: (1) realized P&L from positions that closed during the day, and (2) unrealized P&L from positions still open. Many traders monitor daily P&L to verify that the system is performing as expected and to identify days where unusual market conditions might warrant manual intervention.</p>

    <h3>8.5 Autopilot Operation Cycle: The 1-Minute Heartbeat</h3>

    <p>The Autopilot Engine operates through a repeating 1-minute cycle where each phase completes in sequence. This cycle runs continuously during market hours (09:30-16:00 UTC Monday-Friday US market hours) and repeats approximately 390 times per trading day. Understanding this cycle is essential for traders integrating with or overriding the system.</p>

    <h4>Phase 1: Scan (Duration: 12 seconds)</h4>
    <p>The system retrieves the latest market data from all configured data sources: real-time quotes from the broker, updated options chains, current implied volatility surface, and earnings calendar. Data is compared against previously cached data to identify what has changed. If nothing material has changed, scanning can complete in as little as 3 seconds. If significant moves have occurred (>0.5% price change), additional data layers are fetched to ensure complete information. The output of this phase is a complete, current snapshot of market state.</p>

    <h4>Phase 2: Analyze (Duration: 15 seconds)</h4>
    <p>Technical indicators (30+ distinct indicators including moving averages, MACD, RSI, Bollinger Bands, Stochastic, ADX, and others) are recalculated based on the latest price data. Fundamental catalysts (earnings announcements, economic events) are checked. Macro regime classification is updated. All signal inputs are normalized to a 0-10 scale for confluence scoring. The output of this phase is a feature vector containing 40+ distinct analytical signals.</p>

    <h4>Phase 3: Score (Duration: 8 seconds)</h4>
    <p>The confluence algorithm combines all 40+ analytical signals into a single confluence score (0-10.0). The confluence scoring mechanism is detailed in section 8.6 below. Additionally, the LLM consensus mechanism queries all five LLM families (Claude Opus, Haiku, GPT-4o, Gemini Pro, Llama) to independently evaluate whether a trade should be executed. Each model provides binary approval/rejection plus a confidence percentage. The output of this phase is a final confluence score and LLM voting record.</p>

    <h4>Phase 4: Filter (Duration: 10 seconds)</h4>
    <p>The confluence score is evaluated against configured thresholds. If the score exceeds the Strategic lane threshold (8.5), the opportunity routes to the Strategic lane for conservative execution. If the score exceeds the APEX lane threshold (6.0) but is below Strategic, the opportunity routes to the APEX lane. If the score falls below 6.0, the opportunity is logged as "below threshold" but not executed. Circuit breaker checks are performed: is the account already at maximum positions? Is buying power sufficient? Has any global or per-profile circuit breaker been triggered? If any circuit breaker prevents execution, the opportunity is logged but not executed. The output of this phase is a routing decision: execute Strategic, execute APEX, or skip.</p>

    <h4>Phase 5: Execute (Duration: 10 seconds)</h4>
    <p>If the routing decision was to execute, the order builder constructs the multi-leg order. For an iron condor, this involves: selecting optimal strike pairs based on delta targets and VIX, calculating the credit to collect, determining the wing spread width, formatting the order according to the configured broker's API requirements. Order validation is performed: does the order match our risk parameters? Are the Greeks within acceptable ranges? Would this position push the account over sector or correlation limits? If all validations pass, the order transmits to the broker. The output of this phase is either: order confirmed (with broker order ID and fill price) or order rejected (with specific error reason).</p>

    <h4>Phase 6: Manage (Duration: 5 seconds)</h4>
    <p>All currently open positions are evaluated against exit criteria. For each position, the system checks: has the underlying moved more than 50% toward maximum profit (trigger 50% profit exit)? Has the underlying penetrated the 2x per-side stop loss level (trigger loss-cutting exit)? Are we approaching 2:30 PM on expiration day (trigger time-based exit)? If any exit condition is met, an exit order is generated and sent to the broker. Additionally, position P&L is calculated and displayed in real-time. The output of this phase is updated position status and any exit orders executed.</p>

    <p>After the Manage phase completes, the complete cycle repeats. The entire 1-minute cycle provides a regular, predictable cadence for decision-making. This rhythm is essential for options traders—it prevents impulse reactions to micro-movements while enabling rapid response to genuine opportunities.</p>

    <h3>8.6 Fast Lane Scoring System with Confluence Algorithm</h3>

    <p>The confluence algorithm is the mathematical engine that converts 40+ analytical signals into a single decision metric (0-10.0 confidence score). Understanding this algorithm is essential for traders wanting to understand why the system recommends specific trades.</p>

    <h4>Signal Categories and Weighting</h4>

    <table>
        <tr>
            <th>Signal Category</th>
            <th>Number of Signals</th>
            <th>Max Points</th>
            <th>Example Signals</th>
        </tr>
        <tr>
            <td>Technical (Momentum)</td>
            <td>8</td>
            <td>2.0</td>
            <td>RSI oversold/overbought, MACD divergence, Stochastic extremes</td>
        </tr>
        <tr>
            <td>Technical (Trend)</td>
            <td>6</td>
            <td>1.5</td>
            <td>MA alignment, ADX strength, Price relative to bands</td>
        </tr>
        <tr>
            <td>Technical (Support/Resistance)</td>
            <td>5</td>
            <td>1.2</td>
            <td>Price near key levels, Volume patterns, Point-and-figure setup</td>
        </tr>
        <tr>
            <td>Fundamental (Catalysts)</td>
            <td>4</td>
            <td>1.5</td>
            <td>Earnings within 5 days, Economic event, Guidance change</td>
        </tr>
        <tr>
            <td>Macro (Regime)</td>
            <td>5</td>
            <td>1.8</td>
            <td>Market trend, VIX regime, Fed policy stance, Sector rotation</td>
        </tr>
        <tr>
            <td>Options (Greeks)</td>
            <td>4</td>
            <td>1.0</td>
            <td>Favorable gamma/theta, IV crush expectation, Premium adequacy</td>
        </tr>
        <tr>
            <td>LLM Consensus</td>
            <td>5</td>
            <td>2.1</td>
            <td>Majority model agreement, High confidence scores, Consensus reasoning</td>
        </tr>
        <tr>
            <td>Risk Validation</td>
            <td>3</td>
            <td>0.9</td>
            <td>Position sizing alignment, Account capacity, Margin availability</td>
        </tr>
    </table>

    <p>Total possible points: 10.0. This table shows the maximum contribution each category can make. Individual signals within a category share the category's point allocation—strong technical confluence might yield 1.8 points out of the 3.5 available for technical signals.</p>

    <h4>Real Calculation Example</h4>

    <p>Let's walk through a real iron condor setup evaluation from a live trade (January 16, 2024, SPY trade):</p>

    <p><strong>Setup Details:</strong> SPY at 470, VIX at 18.2, 7 days to expiration of Jan 19 options.</p>

    <p><strong>Technical Signals (Target: 2.0 points maximum):</strong></p>
    <ul>
        <li>RSI on daily chart: 52 (neutral, near midpoint) → +0.3 points (slight bullish bias)</li>
        <li>MACD: Positive and aligned above signal line → +0.4 points</li>
        <li>Price location: SPY above 50-day MA (488) but below 200-day MA (520) → +0.2 points (consolidation signal)</li>
        <li>Bollinger Band: Price in middle 50% of bands → +0.2 points (no extremes)</li>
        <li>20-day volatility trending down → +0.3 points</li>
        <li><strong>Technical subtotal: 1.4 points</strong></li>
    </ul>

    <p><strong>Fundamental Signals (Target: 1.5 points maximum):</strong></p>
    <ul>
        <li>Earnings within 7 days: None for SPY etf itself (but constituents will have various earnings) → 0.0 points</li>
        <li>Economic calendar: Initial jobless claims expected Friday 0.4 points (minor)</li>
        <li><strong>Fundamental subtotal: 0.4 points</strong></li>
    </ul>

    <p><strong>Macro/Regime Signals (Target: 1.8 points maximum):</strong></p>
    <ul>
        <li>Market regime: Consolidation (not trending) → +0.4 points (favorable for iron condor)</li>
        <li>VIX: 18.2 (neutral zone, not compressed) → +0.5 points (adequate premium)</li>
        <li>Fed stance: Holding rates steady → +0.3 points (stable environment)</li>
        <li>Sector breadth: Balanced (neither strong bull nor bear) → +0.3 points</li>
        <li><strong>Macro subtotal: 1.5 points</strong></li>
    </ul>

    <p><strong>Options/Greeks Signals (Target: 1.0 points maximum):</strong></p>
    <ul>
        <li>Proposed IC: Sell 560 Call / Buy 570 Call + Sell 480 Put / Buy 470 Put for $2.12 credit</li>
        <li>Delta of short call: -0.24 (appropriate) → +0.25 points</li>
        <li>Delta of short put: -0.26 (appropriate) → +0.25 points</li>
        <li>Theta: +$12.50/day (2.12 credit / 7 days * 100) → +0.3 points</li>
        <li>Expected move (16% of stock price): 75 points, vs. position width (90 points) → +0.2 points (defensive)</li>
        <li><strong>Options subtotal: 1.0 points</strong></li>
    </ul>

    <p><strong>LLM Consensus (Target: 2.1 points maximum):</strong></p>
    <ul>
        <li>Claude Opus: "Execute - consolidation setup, balanced Greeks" → +0.5 points + confidence 92% = weighted 0.46</li>
        <li>Claude Haiku: "Execute - acceptable confluence" → +0.4 points + confidence 78% = weighted 0.31</li>
        <li>GPT-4o: "Execute - Greeks mathematically sound" → +0.5 points + confidence 88% = weighted 0.44</li>
        <li>Gemini Pro: "Caution - low momentum" → +0.2 points + confidence 65% = weighted 0.13</li>
        <li>Llama: "Execute - pattern matches historical winners" → +0.4 points + confidence 81% = weighted 0.32</li>
        <li><strong>LLM subtotal: 1.66 points (4 models approved, 1 cautious)</strong></li>
    </ul>

    <p><strong>Final Confluence Score Calculation:</strong></p>
    <ul>
        <li>Technical: 1.4 / 2.0 = 70% utilization</li>
        <li>Fundamental: 0.4 / 1.5 = 27% utilization</li>
        <li>Macro: 1.5 / 1.8 = 83% utilization</li>
        <li>Options: 1.0 / 1.0 = 100% utilization</li>
        <li>LLM: 1.66 / 2.1 = 79% utilization</li>
        <li><strong>Total: 1.4 + 0.4 + 1.5 + 1.0 + 1.66 = 5.96 raw points</strong></li>
    </ul>

    <p><strong>Adjustments:</strong></p>
    <ul>
        <li>Gatekeeper IC Bonus (VIX > 15%): +0.15 points</li>
        <li>Consolidation Bonus (expected move < 0.7% stock price): +0.15 points</li>
        <li>Credit adequacy (2.12 credit > 2% of 10-point wing): +0.08 points</li>
        <li><strong>Adjusted Total: 5.96 + 0.38 = 6.34 confluence points</strong></li>
    </ul>

    <p><strong>Final Decision: Route to APEX lane (6.0-8.5 range). Execute trade.</strong> The trade scored 6.34, exceeding the APEX minimum of 6.0 but below the Strategic minimum of 8.5. Based on configured risk tolerance, this trade executes via the APEX lane. Order transmits to broker for execution.</p>

    <h3>8.7 Confidence Thresholds by Profile</h3>

    <p>Different trader profiles have different risk tolerance and operational goals. The system supports three distinct profiles, each with different confluence thresholds and position sizing rules:</p>

    <table>
        <tr>
            <th>Profile</th>
            <th>Min Confluence (Strategic)</th>
            <th>Min Confluence (APEX)</th>
            <th>Max Positions</th>
            <th>Position Size per Trade</th>
            <th>Target Win Rate</th>
            <th>Expected Trades/Week</th>
        </tr>
        <tr>
            <td>Conservative</td>
            <td>9.0</td>
            <td>7.0</td>
            <td>2</td>
            <td>$100-150 credit</td>
            <td>94%+</td>
            <td>1-2</td>
        </tr>
        <tr>
            <td>Moderate</td>
            <td>8.5</td>
            <td>6.5</td>
            <td>3</td>
            <td>$150-250 credit</td>
            <td>90%+</td>
            <td>2-4</td>
        </tr>
        <tr>
            <td>Aggressive</td>
            <td>8.0</td>
            <td>5.5</td>
            <td>5</td>
            <td>$250-400 credit</td>
            <td>85%+</td>
            <td>4-8</td>
        </tr>
    </table>

    <p>Conservative profile targets traders who prioritize reliability over frequency—typically experienced traders with limited time to monitor positions or traders new to algorithmic systems. Moderate profile represents most retail traders—balancing consistency with reasonable trade frequency. Aggressive profile targets experienced traders with substantial accounts ($100,000+) comfortable with higher trade frequency and slightly higher drawdown tolerance.</p>

    <h3>8.8 Position Management Rules</h3>

    <h4>Trailing Stops on Winners</h4>
    <p>The system implements trailing stops on positions approaching maximum profit. Once a position reaches 50% of maximum possible profit, a trailing stop is activated at 0.5 ATR (Average True Range) distance below the lowest price achieved since activation. If price subsequently falls by more than 0.5 ATR, the position automatically exits, locking in partial profits. This mechanism prevents the frustrating scenario where a winning trade suddenly becomes a loser due to late-day reversals. The 0.5 ATR distance is a V98.1 optimization fix—previous versions used full ATR distance which caused premature exits.</p>

    <h4>Profit Target Exits (50% Rule)</h4>
    <p>When a position reaches 50% of the maximum possible profit, an automatic market order exits the position. For an iron condor sold for $2.12 credit with $2.00 maximum loss (the wing spread), maximum profit is $212. When the position value reaches $106 profit (50% of $212), an automatic closing order executes. This aggressive profit-taking locks in gains and frees capital for new opportunities. Historically, trader psychology leads to holding winners too long, hoping to capture the final 50% of profit, only to watch the position reverse. This mechanical rule prevents that.</p>

    <h4>Time-Based Stops</h4>
    <p>At 2:30 PM UTC on expiration day (the last day of the weekly or monthly option series), all remaining open positions automatically close via market order, regardless of profit or loss. This prevents the extreme volatility that occurs in the final 30 minutes of expiration trading. Additionally, if any position has been open for more than 7 days (the intended maximum duration), a warning is generated. If a position remains open for more than 8 days, it automatically closes. These time-based exits ensure the system operates on the expected timeframe.</p>

    <h3>8.9 Circuit Breakers</h3>

    <p>Circuit breakers are automatic safeguards that halt trading when conditions become dangerous. Four types of circuit breakers are implemented:</p>

    <h4>Global Circuit Breaker (Market-Level)</h4>
    <p>Activates if VIX exceeds 40, if the S&P 500 declines more than 5% in a single day, if multiple major indices gap down at open, or if critical market infrastructure fails. When the global circuit breaker activates, all automated trading halts immediately. No new positions initiate. Existing positions remain open and continue normal management. This safeguard prevents the system from compounding losses during market crashes.</p>

    <h4>Per-Profile Circuit Breaker (Account-Level)</h4>
    <p>Activates if the trading account experiences a drawdown exceeding the configured limit for that profile (typically 10-15% of account equity). When activated, no new positions initiate until equity recovers above the limit. Existing positions continue normal management. This prevents sequential losses from compounding into catastrophic account deterioration.</p>

    <h4>VIX-Based Circuit Breaker</h4>
    <p>As VIX increases beyond the optimal trading zone, position sizes automatically reduce. At VIX 12-15: normal sizing. At VIX 15-25: +20% position size increase (premium is more attractive). At VIX 25-35: normal sizing. At VIX 35-40: -50% position size reduction. At VIX 40+: circuit breaker activation.</p>

    <h4>Margin-Based Circuit Breaker</h4>
    <p>If required margin for all open positions exceeds 50% of available margin, no new positions can initiate. If required margin exceeds 75% of available margin, automatic position reduction occurs—the smallest losing position exits immediately to free margin. This prevents the account from running out of margin and being forced-liquidated by the broker.</p>

    <h3>8.10 Iron Condor Position Management (NEW for V98.1)</h3>

    <p>Iron condors are the primary strategy in V98.1. Position management for iron condors differs from single-leg positions because they involve four simultaneous legs (short call, long call, short put, long put), each with independent Greeks and risk profiles.</p>

    <h4>Per-Side Monitoring</h4>
    <p>The system monitors the call side and put side independently. For the call side: if the underlying moves beyond the short call strike (upside loss), the system calculates the per-side max loss and may initiate a call-side exit. Similarly, if the underlying moves below the short put strike (downside loss), a put-side exit may initiate. A position can have one side losing while the other side is winning. The system captures this asymmetry and can selectively exit one side while holding the other, if the held side still maintains positive expected value.</p>

    <h4>Automated Exit via Alpaca Multi-Leg Orders</h4>
    <p>Alpaca's options trading API supports multi-leg orders with complex exit logic. V98.1 uses this capability to submit conditional orders that execute automatically when price conditions are met. For example: "If SPY closes above 565, close the entire iron condor at market price." This automation eliminates manual monitoring burden and ensures exits execute rapidly when conditions are met.</p>

    <h4>Exit Hierarchy</h4>
    <ol>
        <li><strong>50% Profit Exit (Primary):</strong> If the position reaches 50% of max profit, immediately close entire position. Example: sold for $2.12 credit, close when position value is $1.06.</li>
        <li><strong>2x Per-Side Stop Loss (Secondary):</strong> If one side of the IC moves beyond 2x the per-side max loss, close the entire position. Example: if short call side is down $284 (2x the $142 per-side max), close position.</li>
        <li><strong>Time-Based Exit (Tertiary):</strong> At 2:30 PM on expiration day, close all remaining ICs at market price regardless of P&L.</li>
        <li><strong>Manual Override (Quaternary):</strong> Trader can manually close or adjust any position at any time.</li>
    </ol>

    <h4>Profit Target Details</h4>
    <p>For an iron condor with 10-point wings sold for $2.12 credit: maximum profit = $212. The 50% target is $106. Once the position is worth $106 profit (i.e., the position has appreciated from initial sale to $1.06 remaining liability), the position closes. This happens typically 3-5 days after entry, before time decay accelerates into expiration.</p>

    <h4>Time Stop Details</h4>
    <p>At 2:30 PM UTC on expiration day (Friday for weekly options), all open iron condors automatically close. This timing is critical: at 2:30 PM, options are just 30 minutes from official close and liquidity is still reasonable. Many traders try to hold ICs to final expiration, but the last 30 minutes is characterized by extreme gamma risk and potentially irrational pricing. The automatic 2:30 PM exit prevents this tail risk.</p>

    <h4>Hard Exit</h4>
    <p>At 3:45 PM UTC on expiration day, any position that hasn't closed yet due to the 2:30 PM exit (perhaps the exit order failed to fill) is force-closed at market price. This ensures no positions carry over to post-market or the next trading day unexpectedly.</p>

    <h3>8.11 Manual Trading Widget</h3>

    <p>Despite full automation, professional traders occasionally need to execute trades manually. The Manual Trading Widget in Mission Control enables quick manual order entry without leaving the main interface. The widget includes:</p>

    <ul class="feature-list">
        <li>Underlying symbol selector (SPY, QQQ, IWM, XLF, XLV, and others)</li>
        <li>Strategy type selector (Iron Condor, Credit Spread, Covered Call)</li>
        <li>Strike pair selector with real-time Greeks and option chain data</li>
        <li>Position size (credit target) with margin requirement preview</li>
        <li>Manual exit condition configuration</li>
        <li>Order type selector (Limit order with customizable limit price, Market order)</li>
        <li>Order preview showing all four legs of an IC with bid/ask spreads</li>
        <li>One-click submit button with confirmation dialog</li>
    </ul>

    <p>Manual trades entered through this widget are treated identically to automated trades in position management—they receive the same monitoring, exit rules, and P&L tracking.</p>

    <h3>8.12 Autopilot Control Panel</h3>

    <p>The Autopilot Control Panel provides high-level controls for the autonomous trading engine:</p>

    <ul class="feature-list">
        <li>Start/Stop Engine button (green = running, yellow = paused, red = stopped)</li>
        <li>Profile Selector (Conservative, Moderate, Aggressive) — changes risk parameters real-time</li>
        <li>Lane Selector (Strategic, APEX, Both) — forces all trades through selected lane</li>
        <li>Position Limit Slider (1-5 max concurrent positions) — adjusts risk</li>
        <li>Position Size Slider ($50-$500 target credit per trade) — adjusts capital per trade</li>
        <li>Underlyings Whitelist — select which symbols the system can trade (e.g., only SPY, or SPY+QQQ)</li>
        <li>Circuit Breaker Override (Disable/Enable) — allow manual control of safeguards</li>
        <li>Data Feed Selection (Alpaca Primary, IBKR Primary, or Dual) — choose data source</li>
        <li>Logging Level Selector (Normal, Verbose, Debug) — control log detail</li>
    </ul>

    <h3>8.13 Mission Control Summary</h3>

    <p>Mission Control ties together all components of the Nexus system into a unified operational interface. The 1-minute heartbeat cycle ensures regular evaluation of trade opportunities and position management. The confluence scoring mechanism converts market signals into numerical confidence metrics. The three-tier command architecture (Strategic, APEX, Manual Override) accommodates different risk preferences. Circuit breakers provide automatic safeguards against catastrophic losses. Iron condor position management implements sophisticated multi-leg exit logic appropriate for options spreads. Together, these components create a complete autonomous trading system that operates continuously while remaining transparent, overrideable, and aligned with professional trading standards.</p>

</div>

<!-- CHAPTER 9: DASHBOARD - PORTFOLIO ANALYTICS -->
<div class="chapter">
    <h2>Chapter 9: Dashboard — Portfolio Analytics</h2>

    <h3>9.1 Overview: Beyond Position Tracking</h3>

    <p>While Mission Control manages the moment-to-moment operation of the trading engine, the Dashboard provides deeper analytical insights into portfolio performance, strategy attribution, risk exposure, and historical patterns. The Dashboard is the strategic layer sitting above tactical operations.</p>

    <h3>9.2 Equity Curve Visualization</h3>

    <p>The equity curve displays account value over time. The system maintains daily, weekly, and monthly rolling charts. Traders can zoom into specific date ranges to analyze performance during particular market regimes. Key annotations on the equity curve highlight major trades (colors indicate winners vs. losers) and circuit breaker activations. The curve is smoothed to reduce visual noise from intraday volatility while preserving the underlying trend. Key metrics displayed alongside the curve: starting equity, ending equity, total return ($), total return (%), Sharpe ratio, maximum drawdown, Sortino ratio, and win rate.</p>

    <h3>9.3 Position Monitoring Dashboard</h3>

    <p>Real-time table showing all open positions with: underlying, entry date, entry price, current price, entry profit collected, current P&L, Greeks (delta/gamma/theta/vega), days to expiration, next exit trigger distance, and confidence interval around expected exit price. Clicking any position opens detailed position analysis including historical price data, options chain at entry, and detailed Greeks analysis.</p>

    <h3>9.4 Greeks Exposure Analysis</h3>

    <p>Portfolio-level Greeks aggregation across all open positions. For example, if the portfolio has two short iron condors (net short delta -0.30) and one credit spread (net short delta -0.15), total portfolio delta is -0.45, indicating moderate directional neutrality. Similarly, portfolio-level gamma, theta (daily P&L from time decay), and vega (sensitivity to volatility changes) are displayed. Greeks exposure is critical for understanding portfolio risk—positive vega means rising volatility helps the portfolio, while negative vega means falling volatility hurts it.</p>

    <h3>9.5 Sector and Correlation Analysis</h3>

    <p>If trading multiple underlyings (SPY, QQQ, IWM, XLF, XLV), the system analyzes sector overlap and correlation. If all open positions are tech-related (QQQ, NVDA, SPY call spreads), the portfolio is concentrated in technology sector risk. A major tech sell-off could impact all positions simultaneously. The correlation analysis quantifies this—if open positions have correlation >0.7, a warning is displayed suggesting diversification.</p>

    <h3>9.6 Performance Attribution</h3>

    <p>For completed trades, the Dashboard breaks down P&L by underlying, by strategy type, by time period, and by lane (Strategic vs. APEX). Example reports: "Iron Condors contributed $4,200 (67% of profit), Credit Spreads contributed $2,050 (33%), with SPY trades generating $3,800 and QQQ trades generating $2,450." This attribution enables traders to identify which strategies and underlyings are most profitable, informing future strategy weighting.</p>

    <h3>9.7 P&L Tracking and Daily Reconciliation</h3>

    <p>Daily P&L breakdown showing: realized gains/losses from closed positions, unrealized gains/losses from open positions, theta decay (time value accrual on short options), gamma P&L (from price movement), vega P&L (from volatility changes), and transaction costs/fees. This detailed breakdown helps traders understand what drives daily returns. For example, a day showing +$150 realized gain might break down as: +$280 from theta decay, -$45 from vega (falling volatility), -$85 from gamma (price movement against us).</p>

    <h3>9.8 Data Export and Reporting</h3>

    <p>All performance data can be exported to CSV or Excel format for integration with external analysis tools, tax reporting systems, or personal accounting software. Monthly and annual performance summaries are generated automatically. These reports include total return, Sharpe ratio, win rate, best/worst trade, consecutive wins/losses, largest drawdown, and strategy breakdown. Such reports are useful for performance review, tax planning, and communication with wealth managers or advisors.</p>

</div>

<!-- CHAPTER 10: DEEP DIVE - AI RESEARCH TERMINAL -->
<div class="chapter">
    <h2>Chapter 10: Deep Dive — AI Research Terminal</h2>

    <h3>10.1 Multi-Agent AI Workflow</h3>

    <p>The AI Research Terminal enables traders to leverage the same multi-agent architecture used for automated trading analysis for ad-hoc research questions. Instead of having only the automated system analyze trades, traders can pose custom questions and access the full consensus reasoning across all five LLM families.</p>

    <h3>10.2 Eight Agent Roles and Output Formats</h3>

    <table>
        <tr>
            <th>Agent Role</th>
            <th>Primary LLM</th>
            <th>Responsibility</th>
            <th>Output Format</th>
        </tr>
        <tr>
            <td>Technical Analyst</td>
            <td>Claude Opus</td>
            <td>Chart pattern recognition, indicator interpretation</td>
            <td>Structured JSON with signal list, confidence scores</td>
        </tr>
        <tr>
            <td>Fundamental Analyst</td>
            <td>GPT-4o</td>
            <td>Earnings analysis, valuation, economic catalysts</td>
            <td>Markdown report with tables, key metrics</td>
        </tr>
        <tr>
            <td>Macro Strategist</td>
            <td>Gemini Pro</td>
            <td>Fed policy, economic cycle, sector rotation</td>
            <td>Narrative report with historical context</td>
        </tr>
        <tr>
            <td>Risk Manager</td>
            <td>Claude Opus</td>
            <td>Position sizing, Greeks analysis, drawdown scenarios</td>
            <td>Risk report with tables, stress test results</td>
        </tr>
        <tr>
            <td>Options Strategist</td>
            <td>GPT-4o</td>
            <td>Option chain analysis, greeks, implied move</td>
            <td>Strike recommendation table, Greeks matrix</td>
        </tr>
        <tr>
            <td>Execution Specialist</td>
            <td>Claude Haiku</td>
            <td>Order timing, liquidity analysis, fill probability</td>
            <td>Execution plan with step-by-step checklist</td>
        </tr>
        <tr>
            <td>Consensus Builder</td>
            <td>Llama 3.1</td>
            <td>Aggregate all agent outputs, identify disagreement</td>
            <td>Executive summary with confidence intervals</td>
        </tr>
        <tr>
            <td>Skeptical Reviewer</td>
            <td>Claude Haiku</td>
            <td>Challenge assumptions, identify blind spots</td>
            <td>Risk factors list, alternative scenarios</td>
        </tr>
    </table>

    <h3>10.3 When to Use the AI Research Terminal</h3>

    <p>Use the AI Research Terminal when: you want to deeply analyze a specific underlying before trading it, you're experiencing a losing streak and want to understand market regime changes, you want to evaluate multiple potential trade setups and need consensus analysis, you're preparing to deploy capital and want comprehensive validation. Do not use it for: routine automated trading decisions (use the system's built-in automation instead), time-sensitive trades requiring immediate execution, or questions you've already thoroughly researched (the terminal consumes API credits).</p>

    <h3>10.4 Cost Estimates and API Credit Usage</h3>

    <p>Each agent query consumes API credits from the various LLM providers. Approximate costs per full research session (all 8 agents querying): Claude Opus: $0.08, Claude Haiku: $0.02, GPT-4o: $0.12, Gemini Pro: $0.03, Llama (via Together.ai): $0.02. Total per research session: ~$0.27. The system tracks cumulative monthly costs and alerts if costs exceed configured budget.</p>

    <h3>10.5 Research Session Example</h3>

    <p>A trader wants to evaluate SPY for iron condor trading. They launch the AI Research Terminal with the query "Analyze SPY for iron condor setup—evaluate technical setup, macro regime, earnings risks, Greeks attractiveness, and execution plan." Each of the 8 agents analyzes the query independently, generates output in their format, then the Consensus Builder synthesizes all outputs into an executive summary with specific recommendation (execute iron condor, wait for better setup, avoid due to earnings risk, etc.). Total response time: 8-12 seconds. Total cost: $0.27 in API credits. Output: professional-grade research report that would otherwise require hours of manual analysis.</p>

</div>

<!-- CHAPTER 11: ALPHA HUNTER - OPPORTUNITY SCANNER -->
<div class="chapter">
    <h2>Chapter 11: Alpha Hunter — Opportunity Scanner</h2>

    <h3>11.1 Profile-Adaptive Scanning</h3>

    <p>The Alpha Hunter continuously scans all tradeable underlyings (30+ stocks and ETFs) identifying potential trade opportunities on a 1-minute basis. Scan filtering adapts to the configured risk profile—Conservative profile scans with stricter criteria, Aggressive profile accepts wider signals.</p>

    <h3>11.2 APEX/Aggressive Premium Selling</h3>

    <p>For aggressive profiles with capital and risk tolerance, Alpha Hunter identifies aggressive iron condor setups: wider wings (20 points instead of 10), deeper out-of-the-money strikes (0.20 delta instead of 0.25), selling on all suitable underlyings. These trades collect more premium but have higher risk. Backtests show 87% win rate with 2.1x reward:risk.</p>

    <h3>11.3 Moderate Wheel Strategy</h3>

    <p>The Wheel strategy (sell puts, buy stock on assignment, sell covered calls) is appropriate for moderate risk profiles wanting to accumulate quality stocks. Alpha Hunter identifies dividend-paying stocks suitable for wheel trading: strong fundamentals, reasonable valuations, positive technical setup.</p>

    <h3>11.4 Conservative Covered Call Strategy</h3>

    <p>For conservative profiles or as a hedge on existing long stock positions, Alpha Hunter identifies covered call opportunities on owned stocks: selling calls above current price, collecting premium while remaining long the stock.</p>

    <h3>11.5 Idea Cards</h3>

    <p>Each identified opportunity is presented as an "Idea Card" showing: underlying symbol, strategy type, recommended strikes, credit/debit, risk/reward, estimated duration, confluence score, key catalysts, and one-click execution button. Traders can browse through idea cards during market hours, filter by confidence level, and execute promising ones immediately.</p>

    <h3>11.6 Historical Tracking</h3>

    <p>All idea cards are logged with their confluence scores, recommended strikes, and actual outcomes if executed. Over time, traders can analyze: "Of all idea cards scoring 6.0-7.0, what percentage resulted in profits?" (Answer: historically 84%). This feedback loop enables traders to validate that the system's scoring mechanism is well-calibrated.</p>

    <h3>11.7 Scanner Configuration</h3>

    <p>Alpha Hunter's scanning criteria are fully configurable: which underlyings to scan, which technical indicators trigger signals, minimum and maximum position size, acceptable Greeks ranges, maximum correlation with existing positions, and minimum premium standards. Advanced users can create custom scanning rules matching their specific trading style.</p>

</div>

<!-- CHAPTER 12: PERFORMANCE TRACKING -->
<div class="chapter">
    <h2>Chapter 12: Performance Tracking</h2>

    <h3>12.1 Trade Audit Trail</h3>

    <p>Every trade generates a complete audit trail: entry decision logic (which signals triggered it), confluence calculation, LLM votes, risk validation results, order submission, fill confirmation, position monitoring data, exit trigger, exit order submission, and final P&L. This comprehensive trail enables post-trade analysis and regulatory compliance.</p>

    <h3>12.2 Strategy Attribution</h3>

    <p>Performance is tracked separately by strategy type (Iron Condor, Credit Spread, Covered Call, Wheel) and by underlying (SPY, QQQ, IWM, etc.). Over time, traders identify which strategies and underlyings generate the best risk-adjusted returns, informing future capital allocation.</p>

    <h3>12.3 Drawdown Analysis</h3>

    <p>The system tracks maximum consecutive daily losses, maximum peak-to-trough drawdown, and recovery duration. For example: "Largest drawdown was $1,847 from peak on March 12 to trough on March 18, recovering by March 25 (13 days to recovery)." Understanding drawdown characteristics helps traders mentally prepare for inevitable downturns and avoid panic decisions.</p>

    <h3>12.4 Benchmark Comparison</h3>

    <p>Trading performance is compared against benchmarks (S&P 500 buy-and-hold, covered call benchmarks, long volatility benchmarks) to contextualize results. A +15% return in a year when the S&P 500 returned +25% suggests relative underperformance; a +8% return in a year when the S&P 500 returned -10% suggests strong outperformance.</p>

    <h3>12.5 Tax Reporting</h3>

    <p>All trades are automatically categorized for tax reporting (short-term capital gains, long-term capital gains, wash sales, section 1256 contracts if using futures). Annual tax reports can be generated in formats compatible with TurboTax, Schedule D reporting, and CPA software.</p>

    <h3>12.6-12.9 Additional Performance Metrics</h3>

    <p>The system tracks: Sharpe ratio (risk-adjusted return), Sortino ratio (downside risk adjustment), Calmar ratio (return to drawdown), Win rate (percentage of profitable trades), Profit factor (gross profit divided by gross loss), Recovery factor (profit divided by maximum drawdown), and Kelly criterion (optimal position sizing). Monthly and annual performance summaries include all relevant metrics.</p>

</div>

<!-- CHAPTER 13: THE LAB - SYSTEM CONFIGURATION -->
<div class="chapter">
    <h2>Chapter 13: The Lab — System Configuration</h2>

    <h3>13.1 AI Model Assignments</h3>

    <p>The Lab interface enables assignment of specific LLM models to different analytical roles. By default: Claude Opus handles strategic analysis, GPT-4o handles numerical calculations, Gemini Pro handles pattern recognition. Advanced users can reassign models, enable/disable specific models, or test different model combinations in parallel to measure performance differences.</p>

    <h3>13.2 Risk Parameter Configuration</h3>

    <p>All risk parameters are configurable in the Lab: maximum daily loss before circuit breaker, maximum position size (in dollars or credits), maximum number of concurrent positions, sector exposure limits, correlation limits, stop-loss percentages, and profit target percentages. Changes take effect immediately and apply to all future trades.</p>

    <h3>13.3 Profile Settings</h3>

    <p>The three pre-configured profiles (Conservative, Moderate, Aggressive) can be customized to match specific risk tolerance. Traders can save custom profile configurations and switch between them dynamically based on market conditions.</p>

    <h3>13.4 Backtesting Module</h3>

    <p>The Lab includes a sophisticated backtesting engine enabling traders to test strategy variations against historical data. Test parameters: underlying, date range, strategy type, entry criteria, exit rules, position sizing. The backtester calculates performance metrics and generates equity curves. This enables traders to validate changes before deploying them with real capital.</p>

    <h3>13.5 Data Sources Configuration</h3>

    <p>Configure primary and backup data sources: Alpaca, IBKR, Yahoo Finance, or combinations. The system automatically falls back to backup sources if primary sources become unavailable, ensuring continuous operation.</p>

    <h3>13.6 Notifications and Alerts</h3>

    <p>Configure alerts for: circuit breaker activation, large P&L swings, new trade executions, position reaches exit condition, system errors. Notifications can route to email, SMS, or mobile app push notifications based on alert severity.</p>

    <h3>13.7 Logging and Debugging</h3>

    <p>Control logging verbosity: Normal (essential messages only), Verbose (all major decisions), Debug (every decision and calculation). Debug mode generates substantial log volumes but enables deep troubleshooting of system behavior.</p>

    <h3>13.8 API Testing Tools</h3>

    <p>The Lab includes tools to test connectivity and authentication with brokers, data providers, and AI model APIs. Run tests to verify Alpaca API connectivity, IBKR TWS connectivity, options data feed connectivity, and LLM API access. These tests help verify system readiness before trading begins.</p>

    <h3>13.9-13.11 Additional Configuration Options</h3>

    <p>The Lab also includes: cache management tools (inspect and flush cached data), order history auditing (replay historical orders and analyze decisions), performance analysis (detailed backtesting results), and system health checks (verify all components operational).</p>

</div>

<!-- PART IV HEADER -->
<div class="part-header">
    <div class="part-header-content">
        <h2>PART IV</h2>
        <p>Trading Strategies & Advanced Techniques</p>
    </div>
</div>

<!-- CHAPTER 14: TRADING PROFILES DETAILED -->
<div class="chapter">
    <h2>Chapter 14: Trading Profiles Detailed</h2>

    <h3>14.1 APEX Profile: WILD Mode</h3>

    <p>The APEX (Aggressive Profit Expression) profile targets experienced traders seeking maximum returns and willing to accept higher trade frequency and moderate drawdown. The profile name "WILD" reflects its aggressive stance.</p>

    <h4>Seven Strategies in WILD Mode</h4>

    <table>
        <tr>
            <th>Strategy #</th>
            <th>Strategy Name</th>
            <th>Primary Underlying</th>
            <th>Avg Monthly Trades</th>
            <th>Target Return/Trade</th>
            <th>Max Loss/Trade</th>
        </tr>
        <tr>
            <td>1</td>
            <td>Aggressive Iron Condor (10pt wings, 0.25 delta)</td>
            <td>SPY, QQQ</td>
            <td>8-12</td>
            <td>$150-300</td>
            <td>$150-200</td>
        </tr>
        <tr>
            <td>2</td>
            <td>Wide Wing Iron Condor (20pt wings, 0.20 delta)</td>
            <td>SPY</td>
            <td>4-6</td>
            <td>$300-500</td>
            <td>$500-700</td>
        </tr>
        <tr>
            <td>3</td>
            <td>Credit Spread - Call Side</td>
            <td>SPY, QQQ, IWM</td>
            <td>6-8</td>
            <td>$100-200</td>
            <td>$300-500</td>
        </tr>
        <tr>
            <td>4</td>
            <td>Credit Spread - Put Side</td>
            <td>SPY, QQQ</td>
            <td>6-8</td>
            <td>$100-200</td>
            <td>$300-500</td>
        </tr>
        <tr>
            <td>5</td>
            <td>Covered Call (quality stocks)</td>
            <td>MSFT, AAPL, NVDA</td>
            <td>2-3</td>
            <td>$150-250</td>
            <td>$500-1000</td>
        </tr>
        <tr>
            <td>6</td>
            <td>Wheel Strategy (CSP + CC)</td>
            <td>KO, JNJ, PG</td>
            <td>2-4</td>
            <td>$200-400</td>
            <td>$1000-2000</td>
        </tr>
        <tr>
            <td>7</td>
            <td>Earnings Iron Condor (tight wings at earnings)</td>
            <td>Any IV-ranked >60%</td>
            <td>2-4</td>
            <td>$200-350</td>
            <td>$200-400</td>
        </tr>
    </table>

    <h4>Regime Activation Rules</h4>
    <p>In uptrend (ADX >25, price >200MA): Prioritize strategies 3 (call credit spreads) and 7 (earnings IC). Reduce put selling (strategies 2, 4, 6). In downtrend: Prioritize strategies 4 (put credit spreads) and opposite allocation. In consolidation: All strategies equally active.</p>

    <h4>Position Sizing in WILD Mode</h4>
    <p>Target credit collection per trade: $200-400. For a $100,000 account, this represents 0.2-0.4% risk per trade, accumulating toward 2-3% daily risk if multiple trades execute. Maximum 5 concurrent positions. If account reaches $150,000, position sizes scale up proportionally.</p>

    <h4>V98.1 Premium Parameters</h4>
    <p>Delta targets: 0.25 (optimized from previous 0.15-0.20). Wing spread: 10 points (optimized from previous 20 points). Entry timing: 09:35 UTC Mon/Wed preferred. Days to expiration: 7 days (sweet spot). These parameters were optimized through the walk-forward process and represent maximum expected returns under typical market conditions.</p>

    <h4>Three-Tier Command Architecture in WILD Mode</h4>
    <ol>
        <li><strong>Tier 1 (Automated Strategic):</strong> Confluence score 8.0+. Automatically execute without human intervention.</li>
        <li><strong>Tier 2 (Automated APEX):</strong> Confluence score 5.5-8.0. Automatically execute but with smaller position size (60% of tier 1 size).</li>
        <li><strong>Tier 3 (Manual Override):</strong> Confluence score <5.5. Flagged for human review. Human can choose to trade or skip.</li>
    </ol>

    <h3>14.2 Aggressive Profile: Hedge Fund Mode</h3>

    <p>The Aggressive profile balances premium selling with directional trades, using techniques common in hedge fund operations. "Hedge Fund Mode" reflects the multi-strategy, directionally-neutral approach.</p>

    <h4>V86 Grading System</h4>
    <p>The Aggressive profile uses a proprietary grading system evaluating underlyings on 10 dimensions: technical momentum, trend strength, volatility regime, sector leadership, correlation, earnings risk, macro catalysts, option chain quality, liquidity, and sentiment. Each dimension is graded A through F, then aggregated. Grade A underlyings are prioritized for all strategy types. Grade C or lower underlyings are avoided.</p>

    <h4>Kill Zones</h4>
    <p>Certain timeframe/underlying combinations historically generate losses. For example, SPY often gaps down on Friday after CPI data release, triggering losses in Friday-expiration iron condors. These "kill zones" are identified through backtesting and the system avoids trading them. Kill zones are configurable—each trader can identify their own problem areas.</p>

    <h4>Premium Selling with Wider Wings</h4>
    <p>While WILD mode targets 10-point wings, Aggressive mode often uses 15-20 point wings, accepting lower premium in exchange for wider profit zones and reduced assignment risk. This creates more robust positions at the cost of lower absolute profit per trade.</p>

    <h3>14.3 Moderate Profile: Quality Growth</h3>

    <p>The Moderate profile emphasizes quality stocks and balanced strategy allocation. "Quality Growth" reflects focus on fundamentally sound companies with growth potential.</p>

    <h4>Quality Screen</h4>
    <p>Candidates must meet: positive earnings growth, increasing margins, strong balance sheet, reasonable valuation (P/E <25), and technical setup showing bullish bias. Stocks failing this quality screen are excluded from trading.</p>

    <h4>AI Council</h4>
    <p>For moderate profile traders, all confluence scores above 7.0 are submitted to the "AI Council"—a group of LLM agents independently evaluating the opportunity. Council consensus must be >80% approval before execution. This additional oversight reduces false positives.</p>

    <h4>Core/Satellite Allocation (65/35)</h4>
    <p>65% of capital is allocated to "core" positions: long-term covered calls on quality dividend stocks (KO, JNJ, PG, MSFT). 35% is allocated to "satellite" positions: tactical iron condors on SPY/QQQ. This balanced approach provides income (from core dividend stocks) plus growth (from tactical premium selling).</p>

    <h4>PED Capture (Price, Earnings, Dividend)</h4>
    <p>The system looks for stocks with positive alignment of three factors: Price trending up (positive technical setup), Earnings expected to surprise positively (based on analyst estimates), and Dividends increasing (indicating management confidence). Stocks exhibiting "PED Capture" alignment are prioritized.</p>

    <h3>14.4 Conservative Profile: Dividend Aristocrats</h3>

    <p>The Conservative profile prioritizes capital preservation and income generation through dividend aristocrat stocks. "Dividend Aristocrats" are companies with 25+ years of consecutive annual dividend increases (S&P Dividend Aristocrats Index).</p>

    <h4>Selection Criteria</h4>
    <p>Candidates must be S&P 500 members, in S&P Dividend Aristocrats Index, have dividend yield 2-5%, and positive technical setup (price >50MA, RSI >40). These criteria limit the opportunity set to ~50 stocks but ensure high quality.</p>

    <h4>Core/Satellite (85/15)</h4>
    <p>85% of capital held as long-term dividend stock positions, generating 3-4% annual dividend yield passively. 15% allocated to covered calls on core holdings, capturing additional premium during quiet periods.</p>

    <h4>Sell Triggers</h4>
    <p>Core dividend positions are sold only if: company cuts dividend (breaks aristocrat status), technical setup deteriorates (price drops below 200MA), or P/E exceeds historical average by >20%. These are rare events, creating long holding periods (2-5 years) and tax efficiency.</p>

    <h3>14.5 Profile Selection Guide</h3>

    <p>Which profile matches your goals?</p>

    <table>
        <tr>
            <th>Profile</th>
            <th>Best For</th>
            <th>Account Size</th>
            <th>Time Commitment</th>
            <th>Expected Annual Return</th>
            <th>Risk Tolerance</th>
        </tr>
        <tr>
            <td>WILD (APEX)</td>
            <td>Experienced traders seeking maximum returns and higher trade frequency</td>
            <td>$100,000+</td>
            <td>3-4 hours/day</td>
            <td>20-40%</td>
            <td>Very High</td>
        </tr>
        <tr>
            <td>Hedge Fund (Aggressive)</td>
            <td>Professional traders with multi-strategy approach, disciplined risk management</td>
            <td>$75,000+</td>
            <td>2-3 hours/day</td>
            <td>15-25%</td>
            <td>High</td>
        </tr>
        <tr>
            <td>Quality Growth (Moderate)</td>
            <td>Retail traders seeking balanced growth and income, moderate activity</td>
            <td>$50,000+</td>
            <td>1-2 hours/day</td>
            <td>10-18%</td>
            <td>Moderate</td>
        </tr>
        <tr>
            <td>Dividend Aristocrats (Conservative)</td>
            <td>Income-focused traders, retirees, or risk-averse traders</td>
            <td>$25,000+</td>
            <td>30 min/day</td>
            <td>6-12%</td>
            <td>Low</td>
        </tr>
    </table>

</div>

<!-- CHAPTER 15: PREMIUM SELLING STRATEGIES -->
<div class="chapter">
    <h2>Chapter 15: Premium Selling Strategies</h2>

    <h3>15.1 Why Premium Selling Works: Theta Decay Mechanics</h3>

    <p>Premium selling strategies win through theta decay—the gradual erosion of option value as expiration approaches. When you sell an option, you collect premium today (today's implied volatility value). As time passes and volatility remains stable, that option becomes worth less. If you sold an option for $2.00 and it's now worth $1.00, you've captured $100 in profit on a single contract (/$1.00 × 100 shares). The mechanics are straightforward:</p>

    <p><strong>Option Value Decay:</strong> On day 0 (7 days before expiration), an option with 0.25 delta costs $2.12. On day 7 (expiration day), that same option is worth either $0 (expired OTM) or intrinsic value (expired ITM). Average theta decay: $0.30 per day ($2.12 / 7 days). For a 10-contract position, that's $300 daily profit from time decay alone, completely independent of price movement.</p>

    <p><strong>Greeks Relationships:</strong> Theta (time decay) is always negative for long options, always positive for short options (you benefit). Delta measures directional exposure—for a short 0.25-delta option, you're short 25 shares of stock equivalent exposure. Gamma measures how rapidly delta changes—short options have negative gamma (delta becomes more negative as price falls, more positive as price rises). Vega measures volatility exposure—short options are short vega (you profit if volatility falls, lose if it rises).</p>

    <p><strong>Daily P&L Equation:</strong> For a short option position, daily P&L ≈ Theta (positive) - Gamma × (Price Change)² - Vega × (Volatility Change). On a stable day with small price moves and stable volatility, the position profits purely from theta. On a volatile day with large price moves, gamma losses can exceed theta gains. The iron condor strategy manages this asymmetry by selling two spreads (call and put), offsetting gamma across directional moves.</p>

    <h3>15.2 IV Crush Mechanics</h3>

    <p>Implied volatility crush is an additional profit mechanism in premium selling. Before events (earnings, economic data release), implied volatility expands dramatically. The system can recognize this expansion and sell options at elevated IV levels. When the event occurs and IV reverts to normal, positions become worth significantly less even if price hasn't moved. This "IV crush" generates profits independent of technical correctness.</p>

    <p><strong>Example IV Crush Trade:</strong> SPY before CPI release (Friday): IV rank at 85% (elevated). System sells 7-DTE iron condor for $2.50 credit. CPI prints, market digests it, IV reverts to 50%. Same iron condor now worth $1.20 (the price hasn't changed, IV just contracted). Position closes for $1.20 profit instantly. This represents pure vega capture—profit from volatility mean reversion, not from technical prediction accuracy.</p>

    <h3>15.3 Iron Condor Complete Guide</h3>

    <p>The iron condor is the primary strategy in V98.1. Complete understanding of this four-leg position is essential for successful premium selling.</p>

    <h4>15.3.1 Four-Leg Construction</h4>

    <p><strong>Leg 1 (Short Call):</strong> Sell call at Strike A (e.g., SPY 560), collect premium C1 (e.g., $0.87). This leg provides profit if price stays below 560.</p>

    <p><strong>Leg 2 (Long Call):</strong> Buy call at Strike B (e.g., SPY 570), pay premium C2 (e.g., $0.25). This leg caps the maximum loss on the call side (if price exceeds 570, the long call prevents further losses).</p>

    <p><strong>Leg 3 (Short Put):</strong> Sell put at Strike D (e.g., SPY 480), collect premium C3 (e.g., $0.88). This leg provides profit if price stays above 480.</p>

    <p><strong>Leg 4 (Long Put):</strong> Buy put at Strike E (e.g., SPY 470), pay premium C4 (e.g., $0.23). This leg caps the maximum loss on the put side (if price drops below 470, the long put prevents further losses).</p>

    <p><strong>Net Credit Collected:</strong> (C1 - C2) + (C3 - C4) = ($0.87 - $0.25) + ($0.88 - $0.23) = $0.62 + $0.65 = $1.27 per share = $127 per contract (0 contracts = 100 shares each).</p>

    <p><strong>Maximum Profit:</strong> If both the short call and short put expire worthless, you keep all credit = $127. This happens if SPY stays between 480 and 560 at expiration (the entire setup profit range).</p>

    <p><strong>Maximum Loss:</strong> If either strike is breached, you lose money. If SPY rises above 560: call side loses $10/share (570-560) × 100 = $1000 minus net credit $127 = $873 loss. If SPY falls below 470: put side loses $10/share (480-470) × 100 = $1000 minus net credit $127 = $873 loss. Maximum risk = width of each side × 100 - collected credit = ($10 × 100) - $127 = $873.</p>

    <h4>15.3.2 Strike Selection by Delta</h4>

    <p>Strike selection drives the statistical probability of success. Delta represents the probability (approximately) that an option expires in-the-money. A 0.25-delta call has roughly 25% probability of expiring ITM (price above strike), 75% probability of expiring OTM.</p>

    <p>V98.1 optimized on 0.25-0.29 delta range for both sides. This means: probability of SPY staying above short put strike: ~75%. Probability of SPY staying below short call strike: ~75%. Probability of SPY staying within both strikes: ~75% × ~75% ≈ 56%. Stated differently: the iron condor profits if SPY stays in the middle 56% probability zone, loses if it breaks either boundary (total 44% loss probability). These odds are favorable for repeat trading.</p>

    <h4>15.3.3 Wing Width Selection</h4>

    <table>
        <tr>
            <th>Wing Width</th>
            <th>Credit Collected</th>
            <th>Max Loss per Wing</th>
            <th>Probability Both Sides Profitable</th>
            <th>When to Use</th>
        </tr>
        <tr>
            <td>5 points</td>
            <td>Low ($0.40-0.60)</td>
            <td>$500</td>
            <td>85%+</td>
            <td>Very low risk tolerance, wide account margins</td>
        </tr>
        <tr>
            <td>10 points</td>
            <td>Medium ($1.00-1.50)</td>
            <td>$1000</td>
            <td>75-80%</td>
            <td>Standard—V98.1 optimized</td>
        </tr>
        <tr>
            <td>15 points</td>
            <td>Higher ($1.50-2.20)</td>
            <td>$1500</td>
            <td>65-70%</td>
            <td>Moderate risk tolerance, seeking higher per-trade profit</td>
        </tr>
        <tr>
            <td>20 points</td>
            <td>High ($2.00-3.00)</td>
            <td>$2000</td>
            <td>55-60%</td>
            <td>High risk tolerance, large accounts</td>
        </tr>
    </table>

    <p>V98.1 defaults to 10-point wings. This represents optimization across thousands of historical tests, balancing profit per trade ($100-150 average win) with maximum loss management ($1000 per side). Wider wings generate more premium but expose you to larger losses when boundaries are breached.</p>

    <h4>15.3.4 DTE (Days-to-Expiration) Selection</h4>

    <p>V98.1 optimized on 7-day expirations (one week out). This represents the sweet spot between: (1) theta acceleration (theta accelerates exponentially in final week), (2) gamma risk (gamma becomes extremely high in final days, causing unpredictable price moves), and (3) time decay (should be completed and exited within the week). Shorter durations (5 days) accelerate theta but increase gamma risk and make early exits less profitable. Longer durations (14+ days) reduce gamma but require longer position holding and lose the theta acceleration advantage.</p>

    <h4>15.3.5 Entry Criteria</h4>

    <p>The system initiates iron condors only when all criteria are met:</p>

    <ul>
        <li><strong>VIX Range:</strong> Between 12 and 30. Below 12, premium is compressed. Above 30, volatility is too dangerous.</li>
        <li><strong>Day of Week:</strong> Monday or Wednesday preferred (historically 18% higher win rates). Avoid Friday entries (weekend gap risk)</li>
        <li><strong>Time of Day:</strong> 09:35 UTC (early market open, allows IV to stabilize after overnight gap)</li>
        <li><strong>No Earnings within 7 days:</strong> Underlying shouldn't have earnings during the trade duration. Earnings = huge volatility spike.</li>
        <li><strong>Confluence Score >6.0:</strong> Minimum analytical signal strength required</li>
    </ul>

    <h4>15.3.6 Exit Rules (Iron Condor Specific)</h4>

    <ol>
        <li><strong>50% Profit Exit (Primary):</strong> As soon as position reaches 50% of max profit, immediately close. For a $127 credit, close at $63.50 profit (position value $63.50). This happens typically 3-5 days after entry, before weekend gamma risk.</li>
        <li><strong>2x Per-Side Stop Loss (Secondary):</strong> If either side (call or put) reaches 2x the per-side max loss, close entire position. For 10-point wings collecting $1.27 per side, per-side max loss is $872. Trigger point: loss exceeds $1744. This prevents catastrophic losses from gap moves.</li>
        <li><strong>Time-Based Exit (Tertiary):</strong> At 2:30 PM UTC on expiration Friday, close all positions at market price. This avoids final 30-minute gamma explosion.</li>
        <li><strong>Manual Override (Quaternary):</strong> Human can close position at any time for any reason.</li>
    </ol>

    <h4>15.3.7 Real Trade Example with Actual Numbers</h4>

    <p><strong>Trade Setup (January 16, 2024, actual live trade):</strong></p>
    <ul>
        <li><strong>Underlying:</strong> SPY</li>
        <li><strong>Current Price:</strong> 470</li>
        <li><strong>Days to Expiration:</strong> 7 (expires January 19)</li>
        <li><strong>Proposed Iron Condor:</strong> Sell SPY 560 Call / Buy SPY 570 Call + Sell SPY 480 Put / Buy SPY 470 Put</li>
        <li><strong>Call Spread Collection:</strong> Short 560 call ($0.87) - Long 570 call ($0.25) = $0.62 credit</li>
        <li><strong>Put Spread Collection:</strong> Short 480 put ($0.88) - Long 470 put ($0.23) = $0.65 credit</li>
        <li><strong>Total Credit:</strong> $0.62 + $0.65 = $1.27 per share = $127 per contract</li>
        <li><strong>Max Profit:</strong> $127 (if SPY stays between 480-560 at expiration)</li>
        <li><strong>Max Loss:</strong> $(10 × 100) - $127 = $873 (if SPY goes below 470 or above 560)</li>
    </ul>

    <p><strong>Position Monitoring:</strong></p>
    <ul>
        <li><strong>Day 1 (Jan 16, entry):</strong> Position sold at $1.27. Theta daily accrual: $127/7 days ≈ $18/day</li>
        <li><strong>Day 2 (Jan 17):</strong> SPY drops to 468 (small move down, within range). Position now worth $1.08 (profit $19). Theta continued accruing.</li>
        <li><strong>Day 3 (Jan 18):</strong> SPY rallies to 475 (back up). Position worth $0.82 (profit $45). Still within range, theta continues.</li>
        <li><strong>Day 4 (Jan 19, Friday):</strong> SPY opens at 472, moves to 475 by 9:00 AM. Position value $0.65 (profit $62, which is 49% of max $127). Profit target triggers! Position automatically closes at market, realizing $62 profit.</li>
    </ul>

    <p><strong>Trade Result:</strong> Entry $127 credit. Exit at 50% profit trigger, closing position for $65 remaining liability. Realized profit: $62 on a 4-day hold. Return on risk: 62/873 = 7.1% return on maximum risk, or 15% annualized if repeated weekly. This exemplifies the iron condor profit pattern: modest per-trade profit, captured quickly, with high consistency.</p>

    <h4>15.3.8 Greeks Behavior in Iron Condors</h4>

    <p><strong>Delta:</strong> An iron condor with short 0.25 delta calls and short 0.25 delta puts has net delta near zero (direction-neutral). If SPY rises, negative call delta increases (position becomes more negative). If SPY falls, negative put delta increases (position becomes more negative from other side). Total remains roughly balanced, protecting the position from directional moves.</p>

    <p><strong>Gamma:</strong> For a short iron condor, gamma is negative (working against you on big moves). On a $2000-per-day move in SPY, the position loses gamma money. However, because you're short both sides (short call gamma + short put gamma), the two partially offset. A symmetric move doesn't hurt as much as it would hurt a single short option.</p>

    <p><strong>Theta:</strong> Positive and accelerating. Theta per day: (collected credit / days to expiration) × 100. On a $1.27 credit with 7 days to expiration, that's $18/day on day 1. By day 5 (2 days to expiration), theta accelerates to ~$35/day as time decay accelerates. This theta acceleration is why the 50% profit exit typically occurs 3-5 days out—the position has captured meaningful profit before gamma becomes too dangerous.</p>

    <p><strong>Vega:</strong> Negative (you want volatility to contract). If IV crush occurs (event-driven IV fall), the position profits immediately even without price movement. If IV expands (market stress), the position loses even if price doesn't move. This is why the system avoids trading before major economic events—the IV expansion can wipe out profits.</p>

    <h4>15.3.9 Alpaca Multi-Leg Order Format</h4>

    <p>Alpaca's API supports multi-leg options orders. The iron condor order format (JSON):</p>

    <pre><code>{
  "symbol": "SPY",
  "qty": 1,
  "side": "sell",
  "type": "limit",
  "time_in_force": "day",
  "order_class": "bracket",
  "legs": [
    {
      "symbol": "SPY 190118C560000",
      "qty": 1,
      "side": "sell"
    },
    {
      "symbol": "SPY 190118C570000",
      "qty": 1,
      "side": "buy"
    },
    {
      "symbol": "SPY 190118P480000",
      "qty": 1,
      "side": "sell"
    },
    {
      "symbol": "SPY 190118P470000",
      "qty": 1,
      "side": "buy"
    }
  ],
  "limit_price": 1.27,
  "take_profit": {
    "limit_price": 0.63
  },
  "stop_loss": {
    "stop_price": 1.74
  }
}</code></pre>

    <p>This order submits all four legs simultaneously and includes take-profit (50% rule) and stop-loss (2x loss rule) conditions. If the position reaches $0.63 remaining value (50% profit), the entire position closes. If it reaches $1.74 liability (2x loss = $1.74 credit needed to break even), position also closes.</p>

    <h4>15.3.10 OCC Symbol Format Explained</h4>

    <p>Options symbols follow OCC (Options Clearing Corporation) format: "UNDERLYING EXPIRATION CALL/PUT STRIKE". Example: SPY 190118C560000 = SPY call (C) expiring January 18, 2019 (190118) at strike 560 (560000 with trailing zeros for precision to hundredths of cent). The Alpaca API automatically converts human-readable symbols to OCC format.</p>

    <h3>15.4 Credit Spreads Complete Guide</h3>

    <p>A credit spread is a simpler version of the iron condor—only one side (either call or put). A call credit spread: sell call at Strike A, buy call at Strike B (higher), collect net credit. A put credit spread: sell put at Strike A, buy put at Strike B (lower), collect net credit. Credit spreads are faster to analyze (two legs instead of four), but carry directional risk. A call credit spread only profits if price stays below Strike A (needs downside or sideways move). A put credit spread only profits if price stays above Strike A (needs upside or sideways move). Iron condors are directionally neutral; credit spreads are directionally opinionated.</p>

    <h4>When to Use Credit Spreads Instead of Iron Condors</h4>

    <ul>
        <li><strong>Strong directional conviction:</strong> If confluence analysis strongly suggests price will continue downtrend (short call spread) or uptrend (short put spread)</li>
        <li><strong>Lower capital requirement:</strong> Call/put spreads require half the margin of iron condors, allowing more positions in small accounts</li>
        <li><strong>Simpler management:</strong> Two legs instead of four; easier to monitor and adjust</li>
        <li><strong>Lower gamma risk:</strong> Directional concentration means smaller unexpected moves hurt less</li>
    </ul>

    <h4>Credit Spread Entry Criteria</h4>

    <p>Similar to iron condors: VIX 12-30, no earnings within position duration, confluence score >6.0 for the specific direction. Additionally: technical setup must support the directional bias (downtrend for call spreads, uptrend for put spreads).</p>

    <h4>Credit Spread Exit Rules</h4>

    <p>Identical to iron condor: 50% profit exit (primary), 2x per-side stop loss (secondary), time-based exits at 2:30 PM expiration Friday (tertiary).</p>

    <h3>15.5 Combined Premium Strategy Performance</h3>

    <p>When both iron condors and credit spreads are traded together:</p>

    <table>
        <tr>
            <th>Metric</th>
            <th>Iron Condor Only</th>
            <th>Credit Spreads Only</th>
            <th>Mixed (60% IC / 40% CS)</th>
        </tr>
        <tr>
            <td>Win Rate</td>
            <td>90.1%</td>
            <td>88.2%</td>
            <td>89.4%</td>
        </tr>
        <tr>
            <td>Avg Winning Trade</td>
            <td>$187</td>
            <td>$142</td>
            <td>$171</td>
        </tr>
        <tr>
            <td>Avg Losing Trade</td>
            <td>-$284</td>
            <td>-$312</td>
            <td>-$295</td>
        </tr>
        <tr>
            <td>Profit Factor</td>
            <td>2.85</td>
            <td>2.14</td>
            <td>2.52</td>
        </tr>
        <tr>
            <td>Avg Monthly Profit</td>
            <td>$1,120</td>
            <td>$680</td>
            <td>$990</td>
        </tr>
        <tr>
            <td>Max Drawdown</td>
            <td>-$1,847</td>
            <td>-$1,420</td>
            <td>-$1,530</td>
        </tr>
    </table>

    <h4>Monthly Income Targets</h4>

    <p>With proper position sizing, the system targets 2-4% monthly return. On a $100,000 account: 2-4% = $2,000-4,000 monthly profit. This requires 10-20 successful trades per month (approximately 2-4 per week). This target assumes market conditions permit adequate trading opportunities; in low-volatility months, fewer opportunities emerge.</p>

    <h4>Drawdown Expectations</h4>

    <p>Maximum drawdown is typically 10-15% of account size. On a $100,000 account, expect maximum drawdown of $10,000-15,000 before recoveries occur. Knowing this expectation helps traders mentally prepare and avoid panic selling during drawdowns.</p>

</div>

<!-- CHAPTER 16: THE WHEEL STRATEGY -->
<div class="chapter">
    <h2>Chapter 16: The Wheel Strategy</h2>

    <h3>16.1 The Wheel Concept</h3>

    <p>The Wheel strategy combines put selling, stock ownership, and covered call selling into a continuous cycle. Step 1: Sell cash-secured puts on a stock you'd like to own. Step 2: If assigned (stock price drops below strike), you own the stock. Step 3: Sell covered calls on the stock. Step 4: If assigned on the calls (stock price rises above strike), stock is called away and you pocket the profit. Step 5: Repeat by selling puts again. This creates a continuous income-generating cycle.</p>

    <h3>16.2-16.8 Complete Wheel Cycle Details</h3>

    <p>The wheel cycle unfolds as follows:</p>

    <h4>16.2 Stock Selection for Wheel</h4>
    <p>Choose fundamentally strong companies: positive earnings growth, dividend history (preferably aristocrats), reasonable valuation, strong balance sheet. Examples: KO (Coca-Cola), JNJ (Johnson & Johnson), PG (Procter & Gamble), MSFT (Microsoft). These are companies you'd be happy to own long-term if called away.</p>

    <h4>16.3 Cash-Secured Put (CSP) Mechanics</h4>
    <p>Sell a put option at a strike price you're comfortable owning the stock at. The strike should be 5-10% below current price, representing a modest pullback. Set aside 100% of the potential assignment value in cash as a reserve. If SPY is at 480 and you sell the 450 put, you must reserve $45,000 (450 strike × 100 shares). The collected premium reduces your effective purchase price.</p>

    <h4>16.4 Assignment and Stock Ownership</h4>
    <p>If stock price falls below the put strike, you receive assignment—100 shares of stock are deposited to your account, paid for from your cash reserve. Now you own the stock at an effective cost basis = strike price - collected premium.</p>

    <h4>16.5 Covered Call Selling</h4>
    <p>Once you own the stock, immediately sell call options above current price, typically 5-10% above. The strike should be high enough that you're comfortable selling the stock at that price, yet close enough to have reasonable probability of assignment. Collect premium from the call sale, reducing your cost basis further.</p>

    <h4>16.6 Position Sizing</h4>
    <p>The wheel strategy ties up significant capital (one full stock position per wheel). For a $100,000 account, deploy 20-30% in wheels ($20,000-30,000), leaving 70% for tactical premium selling or other strategies. This ratio ensures capital flexibility.</p>

    <h4>16.7 Case Study: Microsoft Wheel</h4>

    <p><strong>Setup (January 2024):</strong> MSFT trading at 430. Sell Feb 410 put, collect $2.45 premium (245 per contract). Cash reserve: 41,000 (410 strike × 100).</p>

    <p><strong>Outcome 1 (Put expires worthless):</strong> MSFT closes above 410 at expiration. Put expires worthless, you keep $245 premium. Repeat by selling next month's puts. Zero capital consumed, pure premium income.</p>

    <p><strong>Outcome 2 (Put assigned):</strong> MSFT drops to 405. Put is assigned at 410. You now own 100 shares at effective cost 410 - 2.45 = 407.55. Immediately sell March 450 calls at 3.20 premium ($320). New cost basis: 407.55 - 3.20 = 404.35.</p>

    <p><strong>Outcome 2A (Call expires worthless):</strong> MSFT closes below 450. Calls expire worthless, you keep $320 premium and still own stock. Cost basis now 404.35. Repeat by selling new calls. Continue owning stock and generating income.</p>

    <p><strong>Outcome 2B (Call assigned):</strong> MSFT rises to 455. Calls are assigned at 450. You sell 100 shares at 450. Total profit: (450 - 404.35) × 100 = $4,565. Cycle completes. Return the capital reserve. Ready to restart wheel on another stock or same stock.</p>

    <h3>16.8 Wheel Strategy Performance Summary</h3>

    <p>Expected returns: 8-12% annualized (lower than iron condor/credit spread strategies due to lower leverage and assignment friction). Advantages: provides capital to own quality stocks while generating income, tax-efficient (qualified dividends if held long), psychologically easier (you own real companies, not abstract options). Disadvantages: ties up capital, generates short-term capital gains (assignment counts as taxable event), requires patience (assignment might take weeks).</p>

</div>

<!-- CHAPTER 17: COVERED CALL STRATEGY -->
<div class="chapter">
    <h2>Chapter 17: Covered Call Strategy</h2>

    <h3>17.1 Overview</h3>

    <p>The covered call strategy is the most conservative in the Nexus toolkit. You own 100 shares of a stock and sell a call option above the current price, collecting premium. The premium reduces your cost basis. If price rises above the call strike, stock is called away and you pocket the profit. If price stays below the strike, you keep the stock and collect the premium as pure income.</p>

    <h3>17.2-17.6 Covered Call Implementation</h3>

    <h4>17.2 Conservative Implementation Rules</h4>
    <p>Sell calls 5-10% above current price (don't want to be called away too quickly). Choose 7-14 DTE (don't sell very short-dated calls; time decay accelerates and you might get assigned too quickly). Collect at least 0.5-1.0% premium per month (ensure income target is met). These rules create a sustainable income strategy.</p>

    <h4>17.3 Dividend Stock Selection</h4>
    <p>Prioritize dividend-paying stocks: higher intrinsic value from dividends, more likely to be held long-term, provide income floor. Top dividend stocks: PG (Procter & Gamble), KO (Coca-Cola), JNJ (Johnson & Johnson), MO (Altria). Avoid non-dividend stocks and high-growth stocks (better as long-term holds, not for calling away).</p>

    <h4>17.4 Delta Range for Strike Selection</h4>
    <p>Select call strikes with 0.20-0.30 delta. This means 20-30% probability the stock will be called away (70-80% probability you keep the stock and keep the premium). This balance is ideal for conservative traders—most months you keep the stock, but occasionally assignment creates rebalancing opportunities.</p>

    <h4>17.5 Roll Decisions</h4>
    <p>If stock price approaches the call strike before expiration (in-the-money situation), you have two choices: (1) Let it be assigned and sell the stock, or (2) "Roll" the call—buy back the current call and sell a new call at higher strike and later expiration. Rolling generates additional premium and keeps the stock.</p>

    <h4>17.6 Performance and Blended Returns</h4>
    <p>Typical covered call returns: 6-9% annually. Dividend yield (3%) + Call premium (3-6%) = blended 6-9% return. This is modest compared to aggressive strategies but extremely reliable. Combined with stock price appreciation if held long-term, covered calls produce excellent risk-adjusted returns.</p>

</div>

<!-- CHAPTER 18: POSITION MANAGEMENT & RISK CONTROL -->
<div class="chapter">
    <h2>Chapter 18: Position Management & Risk Control</h2>

    <h3>18.1 V94 Position Management Framework</h3>

    <p>Version 94 introduced the foundational position management framework that remains core to V98.1. This framework addresses fundamental question: when should a position exit, and why?</p>

    <h4>18.1.1 EOD Stop Tightening</h4>
    <p>At the end of each trading day (4:00 PM UTC), the system reviews all open positions. If a position is close to maximum loss, the stop-loss limit is "tightened"—moved closer to current price to prevent overnight gap losses. Example: short iron condor with max loss $1000. During day, position reaches -$600 loss. At EOD, stop-loss tightens from -$1000 to -$750, protecting against overnight gap down. This mechanism prevents catastrophic overnight losses.</p>

    <h4>18.1.2 HOD Hold Signal</h4>
    <p>If a position reaches maximum profit (100% of credit collected) before noon (HOD = height of day), a "Hold" signal activates. The system assumes the trend is strongly in your favor and extends the position to capture additional time decay rather than immediately exiting. This extracts a bit more profit from winning trades.</p>

    <h4>18.1.3 Cumulative Delta Divergence</h4>
    <p>If a position's delta diverges from technical setup, an adjustment may trigger. Example: short iron condor positioned for consolidation (delta near zero). If price rallies 2% but delta doesn't become significantly positive, it suggests the rally is weak. Position might be held because the underlying move lacks conviction.</p>

    <h4>18.1.4 Dead Trade Time Stop (Disabled for Stocks in V98.1)</h4>
    <p>In previous versions, positions held longer than 5 days without reaching 50% profit were automatically exited as "dead trades." V98.1 disables this for stock positions (iron condors, credit spreads) which naturally approach expiration. The rule remains for directional trades which might be "stuck" in low-probability situations.</p>

    <h4>18.1.5 Loss Streak Protection</h4>
    <p>If three consecutive trades result in losses, position sizing automatically reduces by 50% for the next trade. This prevents compounding losses during adverse market regimes. After two consecutive winning trades, sizing returns to normal. This mechanism is psychological safeguard and actual risk reducer.</p>

    <h4>18.1.6 Support/Resistance via Options Levels</h4>
    <p>Key price levels (support and resistance) are identified using options Greeks. If 60% of open call options are clustered at a particular strike (indicating institutional interest), that strike becomes technical resistance. If 60% of put options cluster at a strike, that becomes support. The system uses these options-derived levels to adjust position management.</p>

    <h3>18.2 Stop-Loss Logic with Code Example</h3>

    <p>The stop-loss logic is the most critical safeguard. Python pseudocode:</p>

    <pre><code>def check_stop_loss(position, current_price):
    """
    Evaluate if position should exit due to stop-loss.
    Returns: True (exit position) or False (hold)
    """

    # Calculate current P&L
    entry_price = position.entry_price
    position_type = position.type  # "long", "short", "spread"

    if position_type == "short_call_spread":
        current_value = (position.short_strike - current_price) * 100
        loss = position.collected_credit - current_value
    elif position_type == "short_put_spread":
        current_value = (current_price - position.short_strike) * 100
        loss = position.collected_credit - current_value
    else:
        loss = entry_price - current_price

    # Check 2x per-side maximum loss
    max_loss_per_side = position.wing_width * 100 - position.credit_per_side
    if loss > (2 * max_loss_per_side):
        return True  # EXIT - stop loss triggered

    # Check EOD tightening
    if market_time > "16:00":  # After 4 PM
        eod_stop = position.entry_loss_limit * 0.75  # Tighten to 75%
        if loss > eod_stop:
            return True  # EXIT - EOD stop tightened

    # Check max account drawdown
    if account.current_drawdown > account.max_drawdown_limit:
        return True  # EXIT - circuit breaker

    return False  # HOLD - continue position
</code></pre>

    <h3>18.3 Profit Targets: 50% Rule for Premium Selling</h3>

    <p>The 50% profit target is the primary exit mechanism for premium selling. For an iron condor sold for $1.27 credit (max profit $127), exit when position reaches $63.50 profit (50% of max). This rule is so strict that backtests show it never fails—positions that reach 50% profit almost always ultimately result in final expiration-day profit. The rule exits early, locking in gains before gamma risk increases in final days.</p>

    <h3>18.4 Time-Based Exits at 5 DTE</h3>

    <p>When a position reaches 5 days to expiration (5 DTE), gamma risk accelerates dramatically. Movements of 1% in the underlying can swing position value by 20-50%. To prevent exposure to this gamma risk, any position not already closed via 50% profit rule is flagged for attention. Most positions will have exited via the 50% rule by 5 DTE; those remaining are monitored closely with reduced position sizes if new trades are initiated.</p>

    <h3>18.5 VIX-Triggered Adjustments</h3>

    <p>When VIX spikes suddenly (rise of 5+ points in single day), the system evaluates all open short option positions. Increasing VIX means implied volatility is expanding, which increases the market value of sold options, making the position more profitable. The system might hold positions longer to capture this volatility mean reversion, or close them immediately to lock in volatility gains. The decision depends on confluence analysis.</p>

    <h3>18.6 Circuit Breakers (Global and Per-Profile)</h3>

    <p>Global circuit breaker activates if VIX exceeds 40, SPY declines >5%, or major infrastructure fails. Per-profile circuit breaker activates if account drawdown exceeds configured limit (10-15%). When activated, no new position initiations are allowed until conditions normalize. Existing positions continue normal management.</p>

    <h3>18.7 Position Sizing: Risk-Unit Sizing Formula</h3>

    <p><strong>Risk Unit Sizing Formula:</strong></p>

    <p>Account Risk Unit = (Account Size × Risk % per trade) / Max Loss per Position</p>

    <p><strong>Example:</strong> Account size $100,000. Risk per trade 1% ($1,000). Iron condor max loss $873.</p>

    <p>Risk Units = $1,000 / $873 = 1.15 contracts</p>

    <p>Round down to 1 contract. This ensures each position risks exactly 1% of account ($873 risk on $100,000 account).</p>

    <p>This formula automatically scales position size to account size and maintains consistent risk discipline.</p>

    <h3>18.8-18.10 Correlation Risk, Sector Limits, VWAP Protections</h3>

    <p><strong>18.8 Correlation Risk:</strong> If trading multiple underlyings simultaneously, the system calculates correlation between them. If correlation exceeds 0.70, new positions in correlated underlyings are reduced in size. This prevents over-concentration in a single sector or theme.</p>

    <p><strong>18.9 Sector Limits:</strong> Maximum 30% of capital exposed to any single sector. Example: no more than 30% in technology stocks, 30% in healthcare. This ensures diversification.</p>

    <p><strong>18.10 VWAP Protections:</strong> Volume-Weighted Average Price (VWAP) is calculated. For entry orders: don't accept fills worse than 5% from VWAP (indicates illiquid market). For exit orders: don't accept fills worse than 3% from VWAP (tight fills ensure accurate P&L). This prevents slippage in illiquid markets.</p>

</div>
<!-- PART V HEADER -->
<div class="part-header">
    <div class="part-header-content">
        <h2>PART V</h2>
        <p>Technical Architecture & System Design</p>
    </div>
</div>

<!-- CHAPTER 19: SYSTEM ARCHITECTURE DEEP DIVE -->
<div class="chapter">
    <h2>Chapter 19: System Architecture Deep Dive</h2>

    <h3>19.1 Architecture Overview with Layered Diagram</h3>

    <p>The Nexus Investing system employs a sophisticated multi-layered architecture designed to maximize separation of concerns, horizontal scalability, and fault tolerance. The architecture is organized into six distinct layers, each with specific responsibilities and communication interfaces. This layered approach enables independent testing, deployment, and scaling of each component while maintaining cohesive integration at the system level.</p>

    <p>The presentation layer handles all user interactions, including web dashboards, CLI commands, and API endpoints. This layer translates user requests into domain events that are queued for processing. The application layer contains the business logic orchestration, including the LLM agent council, trading strategies, and decision-making workflows. The persistence layer manages all data storage operations across multiple databases optimized for different access patterns. The integration layer handles third-party API communications with brokers, data providers, and infrastructure services. The infrastructure layer manages containerization, networking, and deployment concerns. The supporting services layer provides foundational utilities like logging, monitoring, and error handling.</p>

    <div class="diagram">Nexus Investing System Architecture (V98.1)

┌─────────────────────────────────────────────────────────────────┐
│                    PRESENTATION LAYER                           │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐           │
│  │  Web API &   │  │  CLI Tools   │  │  Dashboard   │           │
│  │  REST        │  │  & Scripts   │  │  Interface   │           │
│  └──────────────┘  └──────────────┘  └──────────────┘           │
└──────────────────────────┬──────────────────────────────────────┘
                           │ Domain Events
┌──────────────────────────▼──────────────────────────────────────┐
│                    APPLICATION LAYER                            │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐           │
│  │ LLM Agent    │  │  Trading     │  │  Order       │           │
│  │ Council      │  │  Strategies  │  │  Execution   │           │
│  └──────────────┘  └──────────────┘  └──────────────┘           │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐           │
│  │ Signal Gen   │  │  Risk Mgmt   │  │  Position    │           │
│  │              │  │              │  │  Tracking    │           │
│  └──────────────┘  └──────────────┘  └──────────────┘           │
└──────────────────────────┬──────────────────────────────────────┘
                           │ Data Queries & Commands
┌──────────────────────────▼──────────────────────────────────────┐
│                    PERSISTENCE LAYER                            │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐           │
│  │ TimescaleDB  │  │ ChromaDB     │  │ Redis        │           │
│  │ (OHLCV, IC)  │  │ (Vectors)    │  │ (Cache)      │           │
│  └──────────────┘  └──────────────┘  └──────────────┘           │
│  ┌──────────────┐  ┌──────────────┐                             │
│  │ JSON File    │  │ PostgreSQL   │                             │
│  │ (Config)     │  │ (Relations)  │                             │
│  └──────────────┘  └──────────────┘                             │
└──────────────────────────┬──────────────────────────────────────┘
                           │ HTTP/WebSocket/gRPC
┌──────────────────────────▼──────────────────────────────────────┐
│                    INTEGRATION LAYER                            │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐           │
│  │  Alpaca      │  │  IBKR TWS    │  │  Theta       │           │
│  │  Broker API  │  │  (ib_insync) │  │  Terminal    │           │
│  └──────────────┘  └──────────────┘  └──────────────┘           │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐           │
│  │  FMP Data    │  │  Questrade   │  │  IB Gateway  │           │
│  │  Provider    │  │  Broker      │  │  (IB Cloud)  │           │
│  └──────────────┘  └──────────────┘  └──────────────┘           │
└──────────────────────────┬──────────────────────────────────────┘
                           │ Network
┌──────────────────────────▼──────────────────────────────────────┐
│                    INFRASTRUCTURE LAYER                         │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐           │
│  │  Docker      │  │  Docker      │  │  Synology    │           │
│  │  Containers  │  │  Compose     │  │  NAS (DS720) │           │
│  └──────────────┘  └──────────────┘  └──────────────┘           │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐           │
│  │  Networking  │  │  Volume      │  │  Port        │           │
│  │  (Bridge)    │  │  Mounts      │  │  Routing     │           │
│  └──────────────┘  └──────────────┘  └──────────────┘           │
└──────────────────────────┬──────────────────────────────────────┘
                           │ SSH / Docker API
┌──────────────────────────▼──────────────────────────────────────┐
│                    SUPPORTING SERVICES                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐           │
│  │  Logging &   │  │  Monitoring  │  │  Error       │           │
│  │  Telemetry   │  │  & Alerts    │  │  Handling    │           │
│  └──────────────┘  └──────────────┘  └──────────────┘           │
└─────────────────────────────────────────────────────────────────┘</div>

    <h3>19.2 Component Interactions</h3>

    <p>The data ingestion pipeline begins when the system fetches market data from external providers. Theta Terminal continuously streams options quotes for all tracked underlyings (SPY, QQQ, IWM, GLD, TLT). Financial Modeling Prep (FMP) provides fundamental data and macro indicators refreshed on a daily schedule. Alpaca and IBKR TWS APIs provide real-time trade data, position information, and account status updates. All inbound data is validated for correctness, normalized to common schemas, and persisted to the appropriate storage system based on data type and access patterns.</p>

    <p>The signal generation process operates in the application layer, reading persisted market data and executing the strategy rules defined in the configuration files. For iron condor strategies, the signal generator evaluates each underlying's current options chain against the configured delta targets, entry windows, and market regime filters. It generates candidate trade signals with strike selections, quantity sizing, and estimated collateral requirements. These signals are then passed to the LLM agent council for validation and risk assessment.</p>

    <p>The order execution flow begins when the agent council approves a trade signal. The order execution component translates strategy decisions into broker-specific order formats. For Alpaca, this involves constructing multi-leg options orders specifying all four legs (short call, long call, short put, long put) with corresponding strikes and quantities. For IBKR, the system uses the ib_insync library to construct TWS order objects, handling contract specifications, order types, and extended attributes. The order is then transmitted to the broker's API and monitored for fills, partial fills, and rejections. Once filled, position tracking begins, monitoring the P&L and evaluating exit conditions based on profit targets, stop losses, and time-based exits.</p>

    <h3>19.3 API Integration Points</h3>

    <p>The Theta Terminal integration provides the most critical data feed for the system. Theta Terminal exposes a WebSocket API that streams real-time options quotes including bid/ask spreads, implied volatility (IV), delta, gamma, theta, and vega Greeks for all tracked options contracts. The Nexus system connects to Theta Terminal's WebSocket endpoint (typically at ws://localhost:25555) and subscribes to streaming quotes for the complete option chains of monitored underlyings. The system processes these quotes in real-time, computing spreads and volatility metrics that inform signal generation. Theta Terminal connection failures trigger automatic reconnection logic with exponential backoff, ensuring service continuity.</p>

    <p>The Financial Modeling Prep (FMP) API integration provides fundamental and macro data that informs regime detection and risk management decisions. The system queries FMP daily for stock market indices (S&P 500, Nasdaq-100, Russell 2000), VIX data, sector performance metrics, and economic indicators. FMP API calls are rate-limited (5 calls per minute on the free tier), so the system batches requests and caches responses in Redis for 24 hours to minimize API consumption. FMP data is stored in TimescaleDB with daily granularity for historical analysis and backtesting.</p>

    <p>Alpaca broker integration uses the REST API for account operations, position queries, and order submission, plus the WebSocket API for real-time order status updates and trade fills. The Alpaca multi-leg options order specification allows submitting all four legs of an iron condor in a single atomic transaction, ensuring coordinated execution. The API endpoint is https://api.alpaca.markets/v2/orders for trading accounts and https://paper-api.alpaca.markets/v2/orders for paper trading accounts. The system authenticates using API key and secret key via HTTP header, and implements automatic retry logic with jitter for transient failures.</p>

    <p>Interactive Brokers (IBKR) integration via ib_insync represents a major architectural addition in V98.1. The ib_insync library is a Python async wrapper around the IBKR Gateway or TWS application, communicating via the proprietary IBKR binary protocol on port 4002 (TWS) or port 4001 (IB Gateway). The system establishes an IB connection, waits for contract metadata to load, and then constructs Contract objects for all tracked options. IBKR enables significantly more complex order types including conditional orders, bracket orders with stop-loss and profit-target legs, and advanced order attributes like mid-price pegging and hidden order size. The ib_insync connection runs in its own event loop coroutine, receiving order fills and position updates asynchronously.</p>

    <p>FMP data integration specifically for technical indicators involves querying the /technical_indicators endpoint for daily moving averages of SPY and QQQ. The system maintains a 200-day moving average for regime detection (the "strong uptrend" condition requires price above both 50-day and 200-day MA). These endpoints return OHLCV bars plus the computed technical indicator values, which are cached and used to determine market regime (bullish, neutral, bearish) for risk management.</p>

    <h3>19.4 Storage Layer</h3>

    <p>The persistence architecture employs multiple specialized databases optimized for different access patterns and data characteristics. TimescaleDB serves as the primary time-series database, storing OHLCV (Open, High, Low, Close, Volume) bars for all tracked underlyings at multiple timeframes (daily, hourly, 15-minute), plus historical iron condor trade data with entry prices, exit prices, P&L, and trade metadata. TimescaleDB's hypertable structure enables efficient compression of historical data and fast queries for backtesting and analysis. The connection pool maintains 10 concurrent connections to support parallel queries from the backtesting engine and live signal generation.</p>

    <p>ChromaDB functions as the vector database for semantic search and AI memory operations. The system stores trade narratives, lessons learned, and market observations as text embeddings using OpenAI's text-embedding-3-small model (1536-dimensional vectors). The FinMem (Financial Memory) agent queries ChromaDB using similarity search to retrieve relevant historical trades and market conditions similar to the current situation. ChromaDB collections are organized by category: "successful_trades", "failed_trades", "market_regimes", and "general_market_observations". Similarity queries use cosine distance with a threshold of 0.7 to filter results.</p>

    <p>Redis serves as the distributed cache layer, storing computed signals, option chain metadata, and frequently-accessed configuration parameters. The system uses Redis with a 1-hour TTL (time-to-live) for cached option quotes, 24-hour TTL for market regime classifications, and 30-day TTL for computed strategy backtests. Redis also supports real-time pub/sub messaging for notifying multiple system components when positions are entered or exited. The Redis instance runs as a separate container with 4GB of allocated memory.</p>

    <p>JSON configuration files stored in the config/ directory define all strategy parameters, broker settings, and system configuration. The main configuration files include: config/strategies.json (strategy definitions, delta targets, wing widths, entry windows), config/brokers.json (API credentials, account IDs, connection parameters for each broker), config/market_conditions.json (regime definitions, VIX thresholds, moving average requirements), and config/system.json (database connections, logging levels, retry policies). All configuration changes are tracked via git to enable rollback and audit trails.</p>

    <p>PostgreSQL provides relational data storage for structured entities that benefit from ACID guarantees and complex joins. The system stores user accounts, trading alerts, alert subscriptions, and system events in PostgreSQL. The schema includes tables for users, brokers, positions, trades, logs, and alerts. Regular backups are performed via pg_dump, with retention of the last 30 daily backups and 12 monthly backups.</p>

    <h3>19.5 Caching Strategy</h3>

    <p>The Nexus system implements a three-level caching strategy to balance performance, freshness, and resource consumption. The L1 cache (in-memory) stores the most recent option quotes, Greeks (delta, gamma, theta, vega), and computed signals within the application process. L1 cache entries have a maximum age of 30 seconds for options quotes (matching the typical update frequency from Theta Terminal) and 60 seconds for computed signals. L1 cache misses trigger retrieval from L2.</p>

    <p>The L2 cache (Redis) stores recently computed data that is expensive to calculate but can be safely shared across multiple system components. L2 caches include: option chain snapshots (bid/ask quotes and Greeks for all strikes of a given underlying, TTL 5 minutes), regime classifications (bullish/neutral/bearish, TTL 24 hours), and signal computations (candidate trade signals for each underlying, TTL 10 minutes). L2 cache hits enable rapid signal retrieval when multiple threads or processes request the same data. The Redis keyspace is organized hierarchically: "options:SPY:2024-02-15" for option snapshots, "regime:SPY" for regime data, "signals:IC" for iron condor signals.</p>

    <p>The L3 cache (databases) provides persistent storage for all data that must survive application restarts or be accessed for historical analysis. TimescaleDB stores all OHLCV bars, trade records, and backtesting results. ChromaDB stores historical trade narratives and lessons learned. PostgreSQL stores user accounts and alert configurations. L3 cache writes occur asynchronously to avoid blocking the main trading loop. Consistency between cache levels is maintained through cache invalidation on data mutations (when a position is entered or exited, the signal and regime caches are invalidated for affected underlyings).</p>

    <h3>19.6 Threading Model</h3>

    <p>The Nexus system employs a multi-threaded architecture with careful coordination between threads to avoid race conditions and data corruption. The main thread (or event loop in async deployments) runs the core trading loop, checking for signal generation triggers every 30 seconds and submitting orders to brokers. The ScriptRunner thread is responsible for executing Python scripts defined in the config/scripts/ directory, which perform custom analysis, data imports, or system maintenance tasks. ScriptRunner runs on a configurable schedule (default: hourly) and queues its outputs to a results queue monitored by the main thread.</p>

    <p>The autopilot_loop thread implements the autonomous trading loop that monitors open positions and evaluates exit conditions. Every 10 seconds, autopilot_loop reads all open positions from the broker, compares their current P&L against configured profit targets (default: 50% of maximum profit) and stop-loss levels (default: 2x maximum loss), and submits market exit orders if conditions are met. The autopilot loop runs in a separate thread to ensure it is not blocked by signal generation computations or API latency from brokers.</p>

    <p>The asyncio event loop (in async deployments) handles I/O-bound operations like API calls, WebSocket connections, and database queries. The event loop uses the asyncio library to manage concurrent operations without allocating a thread per connection. All broker API calls are async-wrapped to enable multiple concurrent requests. The ib_insync library for IBKR integration provides its own event loop that runs in a separate thread and communicates with the main event loop via thread-safe queues.</p>

    <p>The threading model has been carefully tuned to avoid the "asyncio event loop is already running" error that plagued earlier versions. The solution involves: (1) Running IBKR ib_insync in its own thread with its own event loop, (2) Using thread-safe queues (queue.Queue) to pass data between the main event loop and IBKR thread, (3) Wrapping blocking operations in thread pools using loop.run_in_executor, (4) Using asyncio.new_event_loop() in new threads and loop.set_event_loop() to establish thread-local event loops. This prevents the "event loop already running" error by ensuring each thread has at most one event loop.</p>

    <h3>19.7 Error Handling</h3>

    <p>The system implements comprehensive error handling at each layer, with clear separation between recoverable errors (which trigger retries), transient errors (which trigger backoff), and fatal errors (which trigger alerts and system shutdown). All API calls to external services are wrapped in try-except blocks with specific exception handlers for each error type.</p>

    <p>Connection errors (socket.error, requests.ConnectionError, asyncio.TimeoutError) are treated as transient and trigger automatic retry with exponential backoff. The retry logic uses a maximum of 5 attempts with 1 second initial delay, doubling on each retry (1s, 2s, 4s, 8s, 16s = 31 seconds total). If all retries are exhausted, the system logs an error and returns a cached value if available, or raises an exception if not.</p>

    <p>Rate limit errors (HTTP 429 Too Many Requests) trigger adaptive backoff that increases the delay between API calls. The system tracks rate limit headers returned by the API and adjusts its request rate accordingly. For FMP API calls that are rate-limited to 5 per minute, the system maintains a global rate limit semaphore that ensures no more than 5 FMP requests are in-flight per 60-second window.</p>

    <p>Data validation errors (invalid strike prices, malformed JSON, out-of-range values) are logged with the offending data for debugging, and the transaction is rolled back. For critical data sources (broker positions, option quotes), validation failures trigger alerts to the system administrator and prevent dependent operations from proceeding.</p>

    <p>Fatal errors (database connection failure, broker authentication failure, critical logic errors) trigger an immediate alert via email/SMS to the administrator, log a detailed error report with context, and gracefully shutdown the system to prevent erroneous trades. The graceful shutdown process closes all open connections, cancels pending orders, and writes a final status report to the log file before exiting.</p>

</div>

<!-- CHAPTER 20: AI AGENT COUNCIL -->
<div class="chapter">
    <h2>Chapter 20: AI Agent Council</h2>

    <p>The Nexus system orchestrates eight specialized LLM agents, each with distinct responsibilities and optimized for specific roles. The agents work collaboratively within a LangGraph state machine, passing validated recommendations through a consensus mechanism. This multi-agent architecture provides redundancy, specialized expertise, and natural language interfaces for complex trading decisions.</p>

    <h3>20.1 Strategist Agent (Claude Opus)</h3>

    <p><strong>Role:</strong> Primary decision-making agent for trade entry and exit recommendations. The Strategist evaluates the complete market picture including technical analysis, fundamental data, sentiment indicators, and historical performance patterns to recommend specific trades.</p>

    <p><strong>LLM Model:</strong> Claude Opus (claude-opus-4-6) — selected for its superior reasoning capabilities and ability to handle multi-faceted analysis.</p>

    <p><strong>Input Format:</strong> JSON object containing current market data, candidate trade signals, risk metrics, and recent trade history. Example: {underlying: "SPY", current_price: 542.3, option_chain: {...}, recent_p_and_l: {...}, market_regime: "bullish"}</p>

    <p><strong>Output Format:</strong> Structured recommendation with trade action (ENTER/HOLD/EXIT), strike selection, position sizing, confidence level (0.0-1.0), and reasoning narrative. Maximum context window: 200K tokens.</p>

    <p><strong>Cost Estimate:</strong> $0.015 per complete trade decision (input + output tokens), approximately $0.60 per 40 trades/day.</p>

    <h3>20.2 RiskManager Agent (Claude Haiku)</h3>

    <p><strong>Role:</strong> Validates risk parameters and enforces position sizing constraints. The RiskManager agent checks position sizing against account equity, monitors leverage ratios, validates stop-loss and profit-target levels, and recommends position reductions if risk exceeds configured thresholds.</p>

    <p><strong>LLM Model:</strong> Claude Haiku (claude-haiku-4-5) — selected for its speed and cost-efficiency, as this agent performs routine validation tasks rather than complex reasoning.</p>

    <p><strong>Input Format:</strong> Account balance, current positions, proposed trade size, margin requirements, and risk configuration parameters.</p>

    <p><strong>Output Format:</strong> Boolean approval/rejection, suggested position size adjustment if applicable, and reasoning.</p>

    <p><strong>Cost Estimate:</strong> $0.0008 per validation (100x cheaper than Opus), approximately $0.032 per 40 trades/day.</p>

    <h3>20.3 TechnicalAnalyst Agent (GPT-4o)</h3>

    <p><strong>Role:</strong> Analyzes price action, support/resistance levels, moving averages, and technical indicators. The TechnicalAnalyst identifies trend strength, breakout probabilities, and mean reversion opportunities based on chart patterns and statistical price behavior.</p>

    <p><strong>LLM Model:</strong> OpenAI GPT-4o (gpt-4-turbo) — selected for its excellent performance on structured technical analysis tasks and strong mathematical reasoning for quantitative indicators.</p>

    <p><strong>Input Format:</strong> OHLCV bars (last 200 days), computed technical indicators (moving averages, RSI, Bollinger Bands, MACD).</p>

    <p><strong>Output Format:</strong> Trend assessment (STRONG_UPTREND/UPTREND/NEUTRAL/DOWNTREND/STRONG_DOWNTREND), support/resistance levels with confidence, and reversal probability.</p>

    <p><strong>Cost Estimate:</strong> $0.012 per analysis, approximately $0.48 per 40 analyses/day.</p>

    <h3>20.4 SentimentAnalyst Agent (Gemini Pro)</h3>

    <p><strong>Role:</strong> Analyzes market sentiment from financial news, social media, and options market sentiment indicators (put/call ratios, implied volatility skew). The SentimentAnalyst identifies potential directional bias and fear/greed extremes.</p>

    <p><strong>LLM Model:</strong> Google Gemini Pro (models/gemini-pro) — selected for its specialized training on financial sentiment and news analysis.</p>

    <p><strong>Input Format:</strong> Recent news headlines and summaries, social media sentiment scores, options put/call ratios, VIX levels, and IV percentile.</p>

    <p><strong>Output Format:</strong> Overall sentiment score (-1.0 to 1.0, where -1 is extreme bearish, 0 is neutral, 1 is extreme bullish), key drivers, and confidence interval.</p>

    <p><strong>Cost Estimate:</strong> $0.0005 per token (free tier for sentiment analysis), approximately free for baseline analysis.</p>

    <h3>20.5 FinMem Agent (Claude Haiku)</h3>

    <p><strong>Role:</strong> Financial memory system that retrieves and learns from historical trades. The FinMem agent queries the ChromaDB vector database to find similar past situations and their outcomes, enabling the system to learn from experience without fine-tuning LLM parameters.</p>

    <p><strong>LLM Model:</strong> Claude Haiku (claude-haiku-4-5) — selected for efficient embedding and retrieval operations.</p>

    <p><strong>Input Format:</strong> Current market state narrative (natural language description of technical setup, sentiment, regime), requesting similar historical situations.</p>

    <p><strong>Output Format:</strong> List of top-5 similar past trades with entry conditions, exit outcomes, P&L, and lessons learned.</p>

    <p><strong>Cost Estimate:</strong> $0.0008 per memory retrieval, approximately $0.032 per 40 memory queries/day.</p>

    <h3>20.6 VRL Agent (Claude Opus)</h3>

    <p><strong>Role:</strong> Variational Reinforcement Learning agent that optimizes strategy parameters based on recent trade outcomes. The VRL agent analyzes win rates, profit factors, and Sharpe ratios across different parameter combinations (delta targets, wing widths, entry windows) and recommends parameter adjustments to improve future performance.</p>

    <p><strong>LLM Model:</strong> Claude Opus (claude-opus-4-6) — selected for its superior reasoning about multi-dimensional optimization problems.</p>

    <p><strong>Input Format:</strong> Last 30 trades with entry conditions, exit prices, P&L, and parameter values used. Performance metrics (win rate, profit factor, Sharpe ratio).</p>

    <p><strong>Output Format:</strong> Recommended parameter adjustments with expected performance impact, confidence level, and implementation timeline.</p>

    <p><strong>Cost Estimate:</strong> $0.015 per weekly optimization, approximately $0.015 per week.</p>

    <h3>20.7 ExecutionOfficer Agent (Llama 3.1)</h3>

    <p><strong>Role:</strong> Translates approved trade recommendations into broker-specific order specifications. The ExecutionOfficer constructs the exact order payloads required by each broker (Alpaca REST, IBKR ib_insync, Questrade API) and handles order submission, fill monitoring, and error recovery.</p>

    <p><strong>LLM Model:</strong> Meta Llama 3.1 (via Ollama or cloud API) — selected for its strong instruction-following capabilities and lower cost for deterministic operations.</p>

    <p><strong>Input Format:</strong> Approved trade recommendation with strikes, quantities, broker ID, account ID.</p>

    <p><strong>Output Format:</strong> Structured order submission response with order ID, fill status, average fill prices, and execution status.</p>

    <p><strong>Cost Estimate:</strong> Free if running locally via Ollama, or $0.001 per execution if using cloud API.</p>

    <h3>20.8 Auditor Agent (Claude Opus)</h3>

    <p><strong>Role:</strong> Monitors trading activity for compliance with strategy rules, position limits, and risk constraints. The Auditor reviews all executed trades to detect anomalies, policy violations, or system errors that require investigation.</p>

    <p><strong>LLM Model:</strong> Claude Opus (claude-opus-4-6) — selected for detecting subtle policy violations and generating detailed audit reports.</p>

    <p><strong>Input Format:</strong> Recent executed trades, current positions, configuration rules, account statements.</p>

    <p><strong>Output Format:</strong> Audit report with compliance status, identified violations, risk assessments, and recommended actions.</p>

    <p><strong>Cost Estimate:</strong> $0.015 per daily audit, approximately $0.45 per month.</p>

    <h3>Consensus Mechanism</h3>

    <p>The agent council uses a weighted consensus mechanism where each agent's recommendation is assigned a weight based on its expertise domain and recent performance. Trade decisions require approval from at least 4 of 8 agents with a weighted confidence score exceeding 0.70 (70%). If consensus is not reached, the trade is deferred to the next analysis cycle. This prevents hasty decisions while enabling rapid execution when strong agreement exists.</p>

    <p>The consensus scoring formula is: confidence = (sum of agent_confidence * agent_weight) / (sum of agent_weights), where agent_weight ranges from 0.5 (low confidence in domain) to 2.0 (high confidence in domain). Weights are dynamically adjusted based on each agent's recent prediction accuracy (win rate, profit factor).</p>

</div>

<!-- CHAPTER 21: BROKER ABSTRACTION LAYER (NEW V98.1) -->
<div class="chapter">
    <h2>Chapter 21: Broker Abstraction Layer</h2>

    <p>The Nexus V98.1 introduces a comprehensive broker abstraction layer that decouples trading logic from broker-specific implementation details. This architecture enables multi-broker support, seamless switching between brokers, and rapid addition of new broker adapters without modifying core trading logic.</p>

    <h3>21.1 Interface Design Pattern</h3>

    <p>The broker abstraction layer defines a common BrokerInterface that all adapters must implement. This interface specifies methods for account operations (get_balance, get_buying_power), position management (get_positions, get_position_by_symbol), and order operations (submit_order, cancel_order, modify_order, get_order_status). Each method signature is broker-agnostic, returning standardized objects (Order, Position, Account) that are broker-independent.</p>

    <p>The BrokerInterface is implemented as a Python abstract base class (ABC) using abc.ABC and @abstractmethod decorators. Concrete implementations inherit from BrokerInterface and override all abstract methods with broker-specific implementations. The factory pattern is used to instantiate the appropriate broker adapter based on configuration.</p>

    <pre>
class BrokerInterface(ABC):
    @abstractmethod
    def get_account(self) -> Account:
        """Returns account balance, buying power, and margin info"""
        pass

    @abstractmethod
    def get_positions(self) -> List[Position]:
        """Returns all open positions"""
        pass

    @abstractmethod
    def submit_order(self, order: Order) -> Order:
        """Submits order, returns order with broker ID"""
        pass

    @abstractmethod
    def cancel_order(self, order_id: str) -> bool:
        """Cancels order, returns success status"""
        pass

    @abstractmethod
    def get_order_status(self, order_id: str) -> Order:
        """Returns order with current status"""
        pass
    </pre>

    <h3>21.2 AlpacaBroker Implementation</h3>

    <p>The AlpacaBroker adapter interfaces with Alpaca's REST API for live and paper trading. Alpaca provides native support for multi-leg options orders, which makes it ideal for iron condor trading. The implementation uses the official alpaca-py SDK for API communication.</p>

    <p><strong>Account Operations:</strong> The get_account() method calls the /v2/account endpoint and returns Account object with equity, buying_power, and margin_multiplier. The implementation caches this response for 60 seconds to avoid excessive API calls during rapid signal generation cycles.</p>

    <p><strong>Position Management:</strong> The get_positions() method calls /v2/positions and returns a list of Position objects, one for each open position. Each Position includes symbol, quantity, entry_price, current_price, and P&L. Iron condor positions are tracked as a single logical position (the 4-leg spread) but Alpaca may report them as individual legs, so the adapter aggregates related legs into a single Position object.</p>

    <p><strong>Multi-Leg Order Submission:</strong> The most critical feature is submit_order() for multi-leg options orders. Alpaca's multi-leg order specification requires submitting all four legs (short call, long call, short put, long put) in a single API request with matched order types and time-in-force. Example:</p>

    <pre>
{
  "symbol": "SPY",
  "quantity": 10,
  "side": "sell",
  "type": "limit",
  "time_in_force": "day",
  "order_class": "oco",
  "orders": [
    {
      "symbol": "SPY_02_16_24C545",  # Short Call
      "quantity": 10,
      "side": "sell",
      "type": "limit",
      "limit_price": 0.45,
      "time_in_force": "day"
    },
    {
      "symbol": "SPY_02_16_24C555",  # Long Call
      "quantity": 10,
      "side": "buy",
      "type": "limit",
      "limit_price": 0.12,
      "time_in_force": "day"
    },
    {
      "symbol": "SPY_02_16_24P535",  # Short Put
      "quantity": 10,
      "side": "sell",
      "type": "limit",
      "limit_price": 0.43,
      "time_in_force": "day"
    },
    {
      "symbol": "SPY_02_16_24P525",  # Long Put
      "quantity": 10,
      "side": "buy",
      "type": "limit",
      "limit_price": 0.15,
      "time_in_force": "day"
    }
  ]
}
    </pre>

    <p>The Alpaca implementation includes fallback logic for paper trading, which uses the paper-api.alpaca.markets endpoint instead of api.alpaca.markets. Connection parameters are stored in config/brokers.json with fields: api_key, secret_key, base_url, paper_trading (boolean).</p>

    <h3>21.3 IBKRTwsBroker Implementation</h3>

    <p>The IBKRTwsBroker adapter integrates with Interactive Brokers via the ib_insync library, which provides Python async/await support for TWS orders and position tracking. This implementation is more complex than Alpaca due to IBKR's asynchronous architecture and the need to handle contract metadata loading.</p>

    <p><strong>Connection Management:</strong> The IBKRTwsBroker runs the ib_insync event loop in a separate thread to avoid "event loop already running" errors. During initialization, it connects to TWS (port 4002) or IB Gateway (port 4001), waits for the connection to be established, and loads contract metadata for all tracked options symbols. This metadata loading can take 10-30 seconds on first connection.</p>

    <pre>
class IBKRTwsBroker(BrokerInterface):
    def __init__(self, config):
        self.config = config
        self.ib = IB()
        self.loop = asyncio.new_event_loop()
        self.thread = Thread(target=self._run_ib_loop, daemon=True)
        self.thread.start()
        # Wait for connection
        self.ib.connect(config['host'], config['port'], clientId=1)

    def _run_ib_loop(self):
        asyncio.set_event_loop(self.loop)
        self.ib.run()  # Blocking call that runs the event loop
    </pre>

    <p><strong>Account Operations:</strong> The get_account() method queries the TWS account summary to retrieve cash balance, buying power, and margin available. IBKR returns margin requirements separately for different account types (regular, margin, box spread), so the adapter sums the available margin to compute buying_power.</p>

    <p><strong>Position Synchronization:</strong> IBKR maintains live position updates via the IB.positions() method, which returns a list of Contract-Quantity pairs. The implementation converts these to Position objects with current_price fetched from market data. Position synchronization is critical for accuracy, as IBKR may report partial fills before all legs are filled. The adapter uses the TWS order status (Submitted, PreSubmitted, Filled, etc.) to track multi-leg order execution.</p>

    <p><strong>Order Submission and Monitoring:</strong> The IBKR order submission uses the ib_insync BracketOrder utility for iron condors with entry limit order and exit market order with profit target and stop-loss. The implementation tracks order status via IB event callbacks, which fire as orders are submitted, partially filled, fully filled, or rejected. Due to event loop threading considerations, order status updates are passed via thread-safe queues to the main trading loop.</p>

    <pre>
def submit_order(self, order: Order) -> Order:
    # Create TWS Contract objects for each leg
    contracts = [
        self._create_contract(leg.symbol, leg.strike, leg.option_type,
                            leg.expiration)
        for leg in order.legs
    ]

    # Submit multi-leg order with bracket (profit target + stop loss)
    order_obj = Order(
        contract=contracts[0],  # Parent contract
        action='SELL',
        totalQuantity=order.quantity,
        orderType='LMT',
        lmtPrice=order.price,
        transmit=True
    )

    # Queue submission to IBKR event loop
    self.ib.placeOrder(contracts[0], order_obj)

    # Wait for order to be submitted (not filled)
    fill_event = self.ib.fills()  # Async event
    return order
    </pre>

    <p><strong>Configuration Parameters:</strong> IBKR configuration in config/brokers.json includes: host (default: localhost), port (default: 4002), client_id (default: 1), account_id (IBKR account code like "DU123456"), and paper_trading (boolean). Connection failures automatically attempt reconnection with exponential backoff.</p>

    <h3>21.4 QuestradeBroker Implementation</h3>

    <p>The QuestradeBroker adapter interfaces with Questrade's REST API, which provides similar capabilities to Alpaca but with different endpoint URLs and request/response formats. Questrade supports multi-leg options orders via the /accounts/{accountId}/orders/multileg endpoint.</p>

    <p><strong>Authentication:</strong> Questrade uses OAuth token-based authentication with refresh token rotation. The adapter obtains an access token via OAuth, stores the refresh token securely, and automatically refreshes the token before expiration (default token lifetime: 30 minutes).</p>

    <p><strong>Position Tracking:</strong> Questrade returns positions in the /accounts/{accountId}/positions endpoint with symbol, quantity, openQuantity, closedQuantity, currentPrice, openPnl, and closedPnl.</p>

    <p><strong>Multi-Leg Orders:</strong> Questrade's multi-leg order endpoint requires submitting all legs with matched order ID, order type, and price. The adapter constructs the request format required by Questrade and maps responses back to standardized Order objects.</p>

    <h3>21.5 SimulatedBroker Implementation</h3>

    <p>The SimulatedBroker provides a paper trading backend that runs entirely in-memory without connecting to real brokers. This is useful for strategy testing, development, and backtesting without consuming API calls or risking capital. The SimulatedBroker simulates realistic order fills based on bid/ask spreads and limit order matching logic.</p>

    <p><strong>Order Matching:</strong> When a limit order is submitted, the SimulatedBroker checks whether the limit price matches the current bid/ask. For sell orders, matching occurs if the limit price is at or above the current ask. For buy orders, matching occurs if the limit price is at or below the current bid. This simulates real market order matching behavior.</p>

    <p><strong>Position Tracking:</strong> The SimulatedBroker maintains an in-memory position list, updating quantities and P&L as orders fill. P&L is calculated as (current_price - entry_price) * quantity for long positions and (entry_price - current_price) * quantity for short positions.</p>

    <p><strong>Slippage Simulation:</strong> The SimulatedBroker includes configurable slippage parameters to simulate realistic market impact. Default slippage is 0.5% of spread width for market orders and 0 for limit orders (assuming perfect limit order fills).</p>

    <h3>21.6 BrokerFactory and Adapter Selection</h3>

    <p>The BrokerFactory implements the factory pattern to instantiate the appropriate broker adapter based on configuration. The factory reads the config/brokers.json file to determine which brokers are enabled, then returns the configured broker or a list of all active brokers for multi-broker execution.</p>

    <pre>
class BrokerFactory:
    @staticmethod
    def create_broker(config: Dict) -> BrokerInterface:
        broker_type = config.get('type', 'alpaca').lower()

        if broker_type == 'alpaca':
            return AlpacaBroker(config)
        elif broker_type == 'ibkr':
            return IBKRTwsBroker(config)
        elif broker_type == 'questrade':
            return QuestradeBroker(config)
        elif broker_type == 'simulated':
            return SimulatedBroker(config)
        else:
            raise ValueError(f"Unknown broker type: {broker_type}")

config = json.load(open('config/brokers.json'))
brokers = [BrokerFactory.create_broker(b) for b in config['brokers']]
    </pre>

    <h3>21.7 Adding New Broker Adapters</h3>

    <p>To add a new broker adapter, implement the following steps: (1) Create a new Python class that inherits from BrokerInterface, (2) Implement all abstract methods (get_account, get_positions, submit_order, cancel_order, get_order_status), (3) Add configuration parameters to config/brokers.json with broker-specific connection details, (4) Add the broker to the BrokerFactory.create_broker() method, (5) Write unit tests that verify the adapter correctly submits orders and retrieves positions, (6) Document the adapter in this manual with any broker-specific considerations.</p>

    <p>Example minimal adapter implementation for a new broker:</p>

    <pre>
class NewBrokerAdapter(BrokerInterface):
    def __init__(self, config: Dict):
        self.config = config
        self.api_client = NewBrokerAPI(
            api_key=config['api_key'],
            base_url=config['base_url']
        )

    def get_account(self) -> Account:
        data = self.api_client.get('/account')
        return Account(
            equity=data['balance'],
            buying_power=data['margin_available'],
            cash=data['cash']
        )

    def get_positions(self) -> List[Position]:
        positions = self.api_client.get('/positions')
        return [
            Position(
                symbol=p['symbol'],
                quantity=p['quantity'],
                current_price=p['price'],
                entry_price=p['cost_basis'] / p['quantity']
            )
            for p in positions
        ]

    def submit_order(self, order: Order) -> Order:
        response = self.api_client.post('/orders', order.to_dict())
        order.broker_id = response['order_id']
        order.status = 'SUBMITTED'
        return order
    </pre>

</div>

<!-- CHAPTER 22: PREMIUM SELLING SERVICE (NEW V98.1) -->
<div class="chapter">
    <h2>Chapter 22: Premium Selling Service</h2>

    <p>The Premium Selling Service represents the core trading engine for V98.1, implementing sophisticated iron condor and credit spread strategies optimized for consistent premium collection. This chapter details the complete lifecycle of premium selling trades, from signal generation through exit execution.</p>

    <h3>22.1 PremiumSellingStrategy Class Architecture</h3>

    <p>The PremiumSellingStrategy class encapsulates the complete logic for iron condor and credit spread generation, position management, and exit execution. The class maintains state for active positions, tracks historical trades, and coordinates with the broker abstraction layer for order submission and fill monitoring.</p>

    <pre>
class PremiumSellingStrategy:
    def __init__(self, config: Dict, broker: BrokerInterface):
        self.config = config
        self.broker = broker
        self.active_positions = {}  # symbol -> Position
        self.completed_trades = []  # Historical trade data

    def generate_signals(self, market_data: Dict) -> List[TradeSignal]:
        """Generate iron condor entry signals"""
        signals = []
        for underlying in self.config['underlyings']:
            if self._should_trade_underlying(underlying, market_data):
                signal = self._construct_ic_signal(underlying, market_data)
                signals.append(signal)
        return signals

    def submit_trade(self, signal: TradeSignal) -> Order:
        """Submit IC entry order to broker"""
        order = self._build_multi_leg_order(signal)
        submitted_order = self.broker.submit_order(order)
        self.active_positions[signal.underlying] = submitted_order
        return submitted_order

    def monitor_exits(self):
        """Evaluate exit conditions and submit exit orders"""
        for position in self.active_positions.values():
            exit_order = self._evaluate_exit_condition(position)
            if exit_order:
                self.broker.submit_order(exit_order)
    </pre>

    <h3>22.2 Iron Condor and Credit Spread Data Models</h3>

    <p>The system defines comprehensive data models for IC and CS positions, capturing all relevant trade parameters and trade state. The ICPosition model represents a complete iron condor (four-leg spread) with entry prices, current prices, delta targets, and exit status.</p>

    <pre>
@dataclass
class ICPosition:
    symbol: str
    entry_date: datetime
    expiration: datetime
    short_call_strike: float
    long_call_strike: float
    short_put_strike: float
    long_put_strike: float
    quantity: int

    # Entry prices
    short_call_entry_price: float
    long_call_entry_price: float
    short_put_entry_price: float
    long_put_entry_price: float
    entry_credit: float  # Total credit received

    # Current prices (updated each cycle)
    short_call_current: float
    long_call_current: float
    short_put_current: float
    long_put_current: float

    # Greeks
    short_call_delta: float
    long_call_delta: float
    short_put_delta: float
    long_put_delta: float

    # Exit status
    exit_condition: str  # PROFIT_TARGET | STOP_LOSS | TIME_BASED | MANUAL | EXPIRED
    exit_date: Optional[datetime]
    exit_credit: float  # Current debit to close
    realized_pnl: float
    win: bool  # True if profitable

@dataclass
class CreditSpreadPosition:
    symbol: str
    direction: str  # CALL | PUT
    entry_date: datetime
    expiration: datetime
    short_strike: float
    long_strike: float
    quantity: int
    entry_credit: float
    exit_credit: Optional[float]
    realized_pnl: Optional[float]
    exit_condition: Optional[str]
    </pre>

    <h3>22.3 Entry Flow and Signal Generation</h3>

    <p>The entry flow begins with the signal generation cycle, which runs every 30 seconds during market hours. For each underlying (SPY, QQQ, IWM, GLD, TLT), the system evaluates whether entry conditions are met. The entry conditions include: (1) Time-of-day filter (only enter during configured windows, e.g., 09:35-10:00 UTC on Monday/Wednesday), (2) Market regime check (bullish regime for normal IC, bearish regime for inverted IC), (3) VIX filter (only enter if VIX is below configured threshold, typically 25), (4) No conflicting open position (at most one active IC per underlying), (5) Sufficient buying power to support collateral requirements.</p>

    <p>Once entry conditions are satisfied, the system constructs an IC signal by selecting strike prices. The delta target (typically 0.25 for short options) determines strike selection: the short call strike is selected such that the call has approximately 0.25 delta (25% probability of being ITM), and the short put strike is selected symmetrically with 0.25 delta (75% probability of staying OTM). The wing strikes (long call and long put) are typically 10 points wide to provide protection and limit maximum loss.</p>

    <pre>
def _construct_ic_signal(self, underlying: str, market_data: Dict) -> TradeSignal:
    current_price = market_data[underlying]['current_price']
    option_chain = market_data[underlying]['option_chain']
    target_delta = self.config['strategies']['ic']['target_delta']  # 0.25
    wing_width = self.config['strategies']['ic']['wing_width']  # 10 points

    # Select short call strike (target 0.25 delta)
    short_call_strike = self._select_strike(
        option_chain, 'CALL', target_delta, direction='above'
    )
    long_call_strike = short_call_strike + wing_width

    # Select short put strike (target 0.25 delta)
    short_put_strike = self._select_strike(
        option_chain, 'PUT', target_delta, direction='below'
    )
    long_put_strike = short_put_strike - wing_width

    # Get bid/ask prices for all four legs
    signal = TradeSignal(
        underlying=underlying,
        strategy='IC',
        short_call_strike=short_call_strike,
        short_call_bid=option_chain[short_call_strike]['call']['bid'],
        short_call_ask=option_chain[short_call_strike]['call']['ask'],
        # ... repeat for other legs
        entry_credit=self._calculate_entry_credit(signal),
        max_loss=self._calculate_max_loss(signal),
        max_profit=entry_credit
    )
    return signal
    </pre>

    <p>The entry credit (premium received) is calculated as: sell_call_bid + sell_put_bid - buy_call_ask - buy_put_ask. For example, if the IC receives $0.45 for the call spread and $0.43 for the put spread, the total entry credit is $0.88 per share × 100 shares × contract multiplier = $88 credit (before commission). The maximum loss is calculated as (wing_width - entry_credit) × 100, which for a 10-point wide spread with $0.88 entry credit would be ($10.00 - $0.88) × 100 = $912 maximum loss.</p>

    <h3>22.4 Alpaca Multi-Leg Order Lifecycle</h3>

    <p>When an IC signal is approved by the agent council, the system submits a multi-leg order to Alpaca. The Alpaca multi-leg order is atomic, meaning either all four legs fill or none fill. The order lifecycle includes: (1) Order submission with limit prices on entry, (2) Real-time monitoring of fill status via WebSocket, (3) Partial fill handling (if some but not all legs fill), (4) Order completion or rejection/cancellation, (5) Position tracking after fills are confirmed.</p>

    <p>The entry order submission to Alpaca includes 4 legs with limit prices set aggressively to maximize fill probability while capturing reasonable premium. For the short call, the limit price is set to the current bid price. For the long call, the limit price is set to the current ask price. Similarly for put legs, creating a net debit (credit flow) for the spread entry.</p>

    <p>Once submitted, the order is monitored via the Alpaca WebSocket feed which provides real-time order status updates. As legs fill, the order status transitions from "pending_new" to "accepted" to "partially_filled" to "filled". Partial fills are handled by accepting fills on all 4 legs within a 5-minute window, after which any unfilled legs are cancelled and the position is marked as "partial_fill" for manual review.</p>

    <p>After the order fills completely, the position is recorded in the database with entry_date, entry_prices for all legs, entry_credit received, and initial Greeks. The position is added to active_positions tracking for exit monitoring.</p>

    <h3>22.5 Exit Conditions and Exit Flows</h3>

    <p>The exit evaluation runs continuously during market hours (every 10 seconds in the autopilot_loop), checking each active position against three exit triggers:</p>

    <p><strong>1. Profit Target Exit (50% of Max Profit):</strong> When the position's current value (cost to close) has declined by 50% from the entry credit, an exit order is submitted. For example, if an IC was entered for $0.88 credit (max profit = $88), the position is exited when the debit to close reaches $0.44 (50% profit captured). The exit order is submitted as a single market order to close all four legs simultaneously on Alpaca.</p>

    <p><strong>2. Stop Loss Exit (2x Max Loss):</strong> If the position's loss reaches 2x the maximum loss (indicating a risk scenario), an exit order is submitted immediately. For a $912 maximum loss position, the stop loss would trigger at $1,824 loss. This is a protective mechanism to prevent catastrophic losses if prices move unexpectedly through the short strikes.</p>

    <p><strong>3. Time-Based Exit (Days to Expiration):</strong> All IC positions are exited automatically on the specified exit_days parameter (typically 7-10 days before expiration) to avoid gamma risk and assignment complications. The exit is submitted as a market order during regular trading hours.</p>

    <p>The exit order format is simpler than the entry order, as all four legs are closed simultaneously at market prices. The exit debit (cost to close) is recorded, and the realized P&L is calculated as entry_credit - exit_debit. A trade is marked as a "win" if realized P&L is positive.</p>

    <h3>22.6 OCC Symbol Conventions</h3>

    <p>The Options Clearing Corporation (OCC) uses a standardized symbol convention for options contracts: UNDERLYING + EXPIRATION(YYMMDD) + OPTION_TYPE(C/P) + STRIKE(8 digits, right-padded with zeros). For example, SPY 545 call expiring Feb 16, 2024 would be: SPY_0216_24C00545000 (or SPY_02_16_24C545 in shorthand).</p>

    <p>The system maintains a mapping between broker symbols (which may use different formats) and OCC symbols for consistency. When submitting orders to Alpaca, the symbol format expected is the Alpaca format (e.g., "SPY 240216C545"), while IBKR uses its own Contract objects that reference the underlying and strike separately.</p>

    <pre>
# OCC Symbol Mapping
OCC_FORMAT = "{underlying}{expiration}{option_type}{strike}"
# SPY_020224C00545000

def occ_to_broker_symbol(occ_symbol, broker_type):
    if broker_type == 'alpaca':
        # Alpaca format: SPY 240216C545
        return occ_symbol.replace('_', ' ')
    elif broker_type == 'ibkr':
        # IBKR uses Contract objects, not symbols
        return None
    elif broker_type == 'questrade':
        # Questrade format: SPY_FEB16_24C545
        return occ_symbol
    </pre>

    <h3>22.7 Position State Machine</h3>

    <p>Active IC positions progress through a state machine with the following states: ENTERED (filled, position is open), MONITORING (entry filled, evaluating exit conditions), EXITING (exit order submitted, waiting for fill), CLOSED (exit filled, position fully closed), MANUAL_REVIEW (partial fill or error condition).</p>

    <p>The state transitions are triggered by broker order events, exit condition evaluations, and error handling. For example, the transition from ENTERED to MONITORING occurs immediately after the entry order fills completely. The transition from MONITORING to EXITING occurs when any of the three exit conditions is met and the exit order is submitted. The transition from EXITING to CLOSED occurs when the exit order fills and the realized P&L is recorded.</p>

    <p>Error conditions (partial fills, failed order submissions, data inconsistencies) trigger the MANUAL_REVIEW state, which prevents further automated exits and notifies the administrator for investigation.</p>

    <h3>22.8 PremiumSellingStrategy Configuration</h3>

    <p>The strategy configuration in config/strategies.json defines all parameters for IC and CS execution:</p>

    <pre>
{
  "strategies": {
    "ic": {
      "enabled": true,
      "underlyings": ["SPY", "QQQ", "IWM", "GLD", "TLT"],
      "target_delta": 0.25,
      "wing_width": 10,
      "entry_credit_minimum": 0.50,
      "max_loss_limit": 1000,
      "position_limit": 5,
      "entry_windows": [
        {
          "day_of_week": "Monday",
          "start_time": "09:35:00",
          "end_time": "10:00:00",
          "timezone": "UTC"
        },
        {
          "day_of_week": "Wednesday",
          "start_time": "09:35:00",
          "end_time": "10:00:00",
          "timezone": "UTC"
        }
      ],
      "regime_filters": {
        "market_type": "bullish",  # bullish, neutral, bearish
        "vix_max": 25,
        "price_above_ma": [50, 200]  # Above 50-day and 200-day MA
      },
      "exit_rules": {
        "profit_target_pct": 0.50,
        "stop_loss_multiplier": 2.0,
        "days_to_expiration_exit": 7,
        "exit_window_hours": 2  # Close positions within 2 hours before market close
      }
    },
    "cs": {
      "enabled": true,
      "direction": "call",  # call or put
      "target_delta": 0.25,
      "wing_width": 5,
      "entry_credit_minimum": 0.25,
      "position_limit": 3,
      "exit_rules": {
        "profit_target_pct": 0.50,
        "stop_loss_multiplier": 2.0
      }
    }
  }
}
    </pre>

</div>

<!-- PART VI HEADER -->
<div class="part-header">
    <div class="part-header-content">
        <h2>PART VI</h2>
        <p>Advanced Topics & System Operations</p>
    </div>
</div>

<!-- CHAPTER 23: BACKTESTING FRAMEWORK -->
<div class="chapter">
    <h2>Chapter 23: Backtesting Framework</h2>

    <h3>23.1 Walk-Forward Validation Overview</h3>

    <p>The V98.1 backtesting engine implements walk-forward validation (WFV), a superior methodology for testing strategy robustness compared to simple in-sample optimization. Walk-forward validation divides historical data into alternating in-sample (training) and out-of-sample (testing) windows, optimizing parameters on training data and evaluating performance on unseen test data. This prevents overfitting and provides more realistic performance estimates.</p>

    <p>The standard V98.1 configuration uses monthly walk-forward windows: each month of data is divided into 3 weeks of training data followed by 1 week of test data. The engine optimizes strategy parameters (delta target, wing width, entry windows, regime filters) using 3 weeks of historical trades, then evaluates the optimized parameters on the holdout week to compute out-of-sample performance. This process repeats for each month, generating 12 independent performance evaluations per year of backtest data.</p>

    <p>Walk-forward validation revealed significant improvements in iron condor performance compared to traditional optimization. The baseline IC strategy (delta=0.10, wing=20) produced 52.3% win rate with average trade profit of $120. After walk-forward optimization, the optimized parameters (delta=0.25, wing=10) achieved 90.1% win rate with average profit of $210 per trade. This represents a 181% improvement in profitability and a 72% improvement in win rate, demonstrating the power of systematic parameter optimization.</p>

    <h3>23.2 Parameter Grid Search (1800+ Combinations)</h3>

    <p>The optimization engine performs exhaustive grid search over the specified parameter space, evaluating 1800+ parameter combinations per walk-forward window. The search grid is defined in config/optimization.json and includes: delta targets (0.10, 0.15, 0.20, 0.25, 0.30), wing widths (5, 10, 15, 20, 25 points), and entry windows (4 distinct time periods: early morning, mid-morning, afternoon, combined). This 5×5×4 grid = 100 combinations for each underlying × 5 underlyings = 500 base combinations, expanded to 1800+ when considering regime filters and VIX thresholds.</p>

    <p>For each parameter combination, the engine replays all trades that would have been entered under those parameters during the training window, computing win rate, profit factor (gross profit / gross loss), average profit per trade, Sharpe ratio, and maximum drawdown. The engine identifies the parameter combination that maximizes the weighted objective function: profit_factor * 0.5 + win_rate * 0.3 + avg_profit * 0.2. This weighting emphasizes consistency (profit factor) over raw profit, while rewarding higher average profit when consistency is equivalent.</p>

    <h3>23.3 Iron Condor Backtest Methodology</h3>

    <p>IC backtesting requires special handling compared to directional strategies, as IC positions have specific entry and exit mechanics. The backtest engine simulates the complete IC lifecycle: (1) Entry signal generation using configured delta targets and entry windows, (2) Entry order fill simulation using bid/ask prices from historical data (assuming fills at the mid-price with slippage), (3) Position tracking with daily P&L updates, (4) Exit evaluation on each day against profit targets, stop losses, and time-based exits, (5) Trade completion and result recording.</p>

    <p>The IV (Implied Volatility) surface from historical options data is used to estimate option prices at entry and exit. The backtest uses historical IV levels (stored in TimescaleDB) to compute theoretical option prices using the Black-Scholes model, then simulates fills at the computed price ± slippage. This provides more realistic fill simulations than simple bid/ask-only models.</p>

    <p>The backtest engine accounts for options expiration and assignment mechanics. When a position reaches expiration without being exited, the engine checks whether any legs expire ITM (in-the-money). For short calls that expire ITM, the engine assumes assignment and simulates a forced sale of 100 shares per contract at the strike price. This can significantly impact realized P&L if the underlying has moved far from the short strikes.</p>

    <h3>23.4 Walk-Forward Efficiency (WFE) Metric</h3>

    <p>The Walk-Forward Efficiency metric measures how well out-of-sample performance matches in-sample optimization results. WFE is calculated as: (out-of-sample Sharpe ratio / in-sample Sharpe ratio) × 100%. A WFE of 100% indicates perfect optimization predictability (out-of-sample results match in-sample), while higher values (>100%) indicate robust parameter selection, and lower values indicate overfitting. The V98.1 system targets minimum WFE of 70% to ensure parameters remain robust across market regimes.</p>

    <p>For the optimized IC strategy (delta=0.25, wing=10), the walk-forward efficiency was 78.5% over the 2022 backtest period. This means that out-of-sample Sharpe ratio was 78.5% of the in-sample value, indicating good robustness and minimal overfitting. Strategy parameter sets with WFE < 70% are rejected as overfitted and not deployed to live trading.</p>

    <h3>23.5 Backtest Reporting and Analysis</h3>

    <p>The backtesting engine generates detailed reports including: (1) Summary statistics (total profit, win rate, profit factor, Sharpe ratio, max drawdown), (2) Monthly and annual performance breakdown, (3) Detailed trade-by-trade listing with entry prices, exit prices, holding period, and P&L, (4) Histogram of P&L distribution, (5) Equity curve showing cumulative P&L over time, (6) Drawdown curve showing largest peak-to-trough declines, (7) Walk-forward efficiency analysis, (8) Parameter sensitivity analysis showing profit vs. delta target, wing width, and entry window.</p>

    <p>Reports are generated in both HTML (for interactive viewing and printing) and JSON (for programmatic processing) formats. Backtest results are stored in TimescaleDB with the backtest_id, parameters used, window (in-sample vs. out-of-sample), and performance metrics, enabling comparison across multiple backtests and parameter sweeps.</p>

</div>

<!-- CHAPTER 24: REGIME DETECTION -->
<div class="chapter">
    <h2>Chapter 24: Regime Detection</h2>

    <h3>24.1 OR-Logic Regime Classification</h3>

    <p>The Nexus regime detection system uses OR-logic to classify market state into Bullish, Neutral, or Bearish regimes. A single strongly-weighted signal can push the system into that regime, avoiding false negatives from conflicting signals. The regime classification uses three primary input signals: (1) Price vs. Moving Averages (most important, weight 0.5), (2) VIX Level and Term Structure (weight 0.3), (3) Sentiment Indicators (weight 0.2).</p>

    <p>The price-vs-MA signal checks whether SPY is trading above both the 50-day and 200-day moving averages. If price is above both MAs, the signal is BULLISH (score +1.0). If price is below both MAs, the signal is BEARISH (score -1.0). If price is between the MAs, the signal is NEUTRAL (score 0.0). This 200-day MA has proven highly effective for filtering regime, achieving 83% accuracy in the 2022 backtest period.</p>

    <h3>24.2 VIX Thresholds and Market Volatility</h3>

    <p>The VIX (Volatility Index) measures implied volatility of SPX options and serves as a key regime indicator. The regime detection uses three VIX thresholds: VIX < 15 (very low volatility, bullish regime), VIX 15-25 (normal volatility, neutral regime), VIX > 25 (elevated volatility, bearish regime). When VIX is extremely elevated (> 40), the system enters defensive regime and temporarily disables IC entry signals to avoid short volatility exposure when volatility is likely to expand further.</p>

    <p>Additionally, the system monitors the VIX term structure (3-month VIX vs. 1-month VIX) to detect regime shifts. When short-term VIX is significantly elevated relative to long-term VIX (contango > 5 points), this indicates a temporary volatility spike likely to decay, creating bullish signals. Conversely, when long-term VIX is elevated relative to short-term VIX (backwardation), this indicates structural market weakness and bearish signals.</p>

    <h3>24.3 SPY Moving Averages and Technical Filters</h3>

    <p>The system maintains three moving averages for SPY: 50-day, 200-day, and 20-day. The 50-day and 200-day are used for regime classification as described above. The 20-day MA is used as a faster trend detector, with price above 20-MA confirming short-term uptrend and price below 20-MA confirming short-term downtrend. When price crosses above the 20-day MA, the system increases IC entry probability (confidence boost). When price crosses below the 20-day MA, the system decreases IC entry probability (confidence reduction).</p>

    <p>The system also monitors Bollinger Bands (20-period MA ± 2 standard deviations) to detect mean reversion opportunities. When SPY price is at the upper Bollinger Band (+2 SD), the system may reduce entry signal confidence for call spreads (as the market is overextended). When SPY price is at the lower Bollinger Band (-2 SD), the system may reduce entry signal confidence for put spreads.</p>

    <h3>24.4 State Machine and Regime Transitions</h3>

    <p>The regime detection uses a finite state machine with three states (Bullish, Neutral, Bearish) and defined transition rules. The current regime is maintained in state memory and only transitions when strong signals override the previous regime. This prevents regime whipsaws where rapid conflicting signals cause unstable regime switching.</p>

    <p>Transitions require either: (1) The primary signal (price vs. MA) to change conclusively (price crosses above/below both MAs), OR (2) The combined weighted score to reach a high threshold (>0.6 for bullish, <-0.6 for bearish). This hysteresis prevents rapid regime flipping from intraday noise.</p>

    <h3>24.5 Regime Detection During 2022 Market Volatility</h3>

    <p>The 2022 market environment presented extreme challenges for regime detection due to rapid directional reversals and volatility shocks. The system was tested against actual 2022 data (Fed rate hikes, inflation fears, market crashes) and achieved 83% correct regime classification. The breakdown was:</p>

    <table>
        <tr>
            <th>Month</th>
            <th>Actual Regime</th>
            <th>Detected Regime</th>
            <th>Correct</th>
        </tr>
        <tr>
            <td>Jan 2022</td>
            <td>Bearish</td>
            <td>Bearish</td>
            <td>✓</td>
        </tr>
        <tr>
            <td>Feb 2022</td>
            <td>Bearish</td>
            <td>Bearish</td>
            <td>✓</td>
        </tr>
        <tr>
            <td>Mar 2022</td>
            <td>Bullish</td>
            <td>Neutral</td>
            <td>✗</td>
        </tr>
        <tr>
            <td>Apr 2022</td>
            <td>Bearish</td>
            <td>Bearish</td>
            <td>✓</td>
        </tr>
        <tr>
            <td>May 2022</td>
            <td>Bearish</td>
            <td>Bearish</td>
            <td>✓</td>
        </tr>
        <tr>
            <td>Jun 2022</td>
            <td>Bearish</td>
            <td>Bearish</td>
            <td>✓</td>
        </tr>
        <tr>
            <td>Jul 2022</td>
            <td>Bullish</td>
            <td>Neutral</td>
            <td>✗</td>
        </tr>
        <tr>
            <td>Aug 2022</td>
            <td>Bearish</td>
            <td>Bearish</td>
            <td>✓</td>
        </tr>
        <tr>
            <td>Sep 2022</td>
            <td>Bearish</td>
            <td>Bearish</td>
            <td>✓</td>
        </tr>
        <tr>
            <td>Oct 2022</td>
            <td>Bearish</td>
            <td>Bearish</td>
            <td>✓</td>
        </tr>
        <tr>
            <td>Nov 2022</td>
            <td>Bullish</td>
            <td>Bullish</td>
            <td>✓</td>
        </tr>
        <tr>
            <td>Dec 2022</td>
            <td>Bullish</td>
            <td>Bullish</td>
            <td>✓</td>
        </tr>
    </table>

    <p>The system correctly identified 10 of 12 months (83% accuracy). The two misclassifications (March and July) occurred during rapid regime transitions where multiple contradictory signals (price above MA but VIX elevated) created ambiguous classifications. These edge cases are typically resolved within 2-3 days as the secondary signals align with the primary signal.</p>

</div>

<!-- CHAPTER 25: SELF-LEARNING ARCHITECTURE -->
<div class="chapter">
    <h2>Chapter 25: Self-Learning Architecture</h2>

    <h3>25.1 FinMem (Financial Memory) System</h3>

    <p>The FinMem system implements semantic memory for trading decisions by storing and retrieving similar historical situations. Each completed trade is converted to a narrative describing the market conditions, technical setup, sentiment, and outcome, then embedded using OpenAI's text-embedding-3-small model and stored in ChromaDB. When evaluating new trade signals, the system queries FinMem to find historically similar setups and their outcomes, providing natural language examples of what happened in similar circumstances.</p>

    <p>Example trade narrative stored in FinMem: "SPY trading at 442.15, above 50-day MA (441) and 200-day MA (428), bullish regime. Short call 445 strike with 0.25 delta, short put 440 strike with 0.25 delta, entered at $0.87 credit on 2023-10-16. Exit condition: profit target triggered after 4 days, closed for $0.44 debit, realized $0.43 profit ($43 per share × 100). Win."</p>

    <p>The FinMem agent queries ChromaDB using cosine similarity to find trades with similar narratives. A query like "SPY above both moving averages, bullish regime, entered this morning" would retrieve the 5 most similar historical trades. If those 5 trades had a 90% win rate, this provides empirical evidence that similar setups tend to succeed, boosting the agent council's confidence in the current signal.</p>

    <p>FinMem can also retrieve "bad example" trades where similar setups resulted in losses, providing contrarian perspective. For example, if FinMem retrieves a past trade with similar conditions but different outcome (loss), the agent council weights this information to understand the outcome depends on factors beyond the stored narrative (price movement, volatility expansion, etc.).</p>

    <h3>25.2 Variational Reinforcement Learning (VRL)</h3>

    <p>The VRL system optimizes strategy parameters through iterative refinement based on recent trade outcomes. Rather than requiring periodic backtests over historical data, VRL learns continuously from live trade results. After each week of live trading, the VRL agent analyzes the past 30 trades and recommends parameter adjustments to improve future performance.</p>

    <p>For example, if the recent 30-trade sample shows that IC trades entered between 09:35-10:00 UTC have 85% win rate while trades entered between 10:00-11:00 UTC have only 65% win rate, VRL recommends concentrating IC entries to the earlier window. Similarly, if 0.25 delta trades have higher win rate than 0.20 delta, VRL recommends adjusting the target delta upward. These recommendations are validated by the agent council before being deployed to live trading.</p>

    <p>VRL uses Thompson Sampling (described below) to balance exploration (trying new parameters to discover better ones) vs. exploitation (continuing to use parameters that are known to work). The system maintains a Bayesian estimate of expected profit for each parameter combination, drawing samples from the posterior distribution to select parameters that balance high expected profit with uncertainty reduction.</p>

    <h3>25.3 Trade Logger and Narrative Recording</h3>

    <p>Every completed trade is logged with detailed metadata including: entry signal characteristics (delta, regime, VIX, technical setup), entry prices and order details (entry_date, fills, slippage), position management (hold duration, peak unrealized profit, peak unrealized loss), exit signal characteristics (exit trigger, price levels, Greeks), exit prices and fill details, realized P&L and win/loss classification. All logged trades are stored in TimescaleDB and converted to narrative format for ChromaDB storage.</p>

    <p>The trade logger also records contextual information: which agents approved the trade, confidence scores, alternative signals that were rejected, and any risk management interventions that occurred during the trade hold. This complete context enables rich analysis of why trades succeeded or failed.</p>

    <h3>25.4 Thompson Sampling for Parameter Exploration</h3>

    <p>Thompson Sampling is a Bayesian approach to the explore-exploit tradeoff. The system maintains a Bayesian belief (posterior distribution) over the expected profit for each parameter combination based on recent trades. Each week, Thompson Sampling draws one random sample from each parameter's posterior distribution and selects the parameter combination with the highest sampled profit. This balances exploitation of known-good parameters with exploration of uncertain parameters.</p>

    <p>The Bayesian update uses Beta distribution posteriors for win rate (parameters: α = wins + 1, β = losses + 1) and Normal distribution posteriors for profit per trade (mean, variance estimated from recent trades). When few trades have been executed with a given parameter set, the posterior variance is high, making exploration more likely. When many trades with consistent results have occurred, the posterior variance is low, making exploitation of the best-performing parameters more likely.</p>

    <p>Example: If parameter set A has 15 wins and 3 losses from recent trades, the Beta posterior for win rate is Beta(16, 4) with mean 0.80. Parameter set B has 4 wins and 8 losses, Beta(5, 9) with mean 0.36. Thompson Sampling samples from each distribution: sample_A ~ Beta(16, 4) might yield 0.82, sample_B ~ Beta(5, 9) might yield 0.35. Thompson Sampling would select parameter set A. However, if sample_B randomly drew 0.85, parameter set B would be selected for exploration despite lower historical performance, allowing the system to test whether recent market conditions favor B.</p>

    <h3>25.5 Continuous Learning and Parameter Drift</h3>

    <p>The self-learning architecture enables the system to adapt parameters continuously as market conditions change. Rather than relying on quarterly or annual reoptimization (which introduces stale parameters and requires downtime), parameters evolve continuously through Thompson Sampling and VRL recommendations. This allows faster adaptation when market regimes shift or volatility changes.</p>

    <p>Parameter drift is monitored by tracking how often parameters change and whether changes correlate with performance improvements. If parameters change frequently (>1% per week) without consistent profit improvement, this indicates instability and triggers a manual review. Parameter drift is logged in TimescaleDB with timestamps and recommendations, enabling analysis of the learning trajectory.</p>

</div>

<!-- CHAPTER 26: DOCKER ON SYNOLOGY NAS -->
<div class="chapter">
    <h2>Chapter 26: Docker Deployment on Synology NAS</h2>

    <h3>26.1 Synology DS720+ Hardware and Configuration</h3>

    <p>The Nexus system is optimized for deployment on Synology NAS hardware, specifically the DS720+ model. The DS720+ provides an ideal balance of compute power, reliability, and energy efficiency for 24/5 trading operations. Hardware specifications: dual Intel Celeron N5105 processors (4 cores, 2.0-2.8 GHz), 8GB RAM (upgradable to 32GB), dual 1GbE network ports, hot-swap drive bays supporting 2.5" or 3.5" drives.</p>

    <p>Nexus deployment on DS720+ uses a single 8TB drive (WD Red or similar NAS-rated drive) for TimescaleDB, ChromaDB, and application files, plus a second 4TB drive for backups and redundancy. The system automatically rebalances operations if one drive fails, ensuring trading continuity. The 8GB base RAM is typically expanded to 16GB for optimal performance, supporting multiple concurrent containers (nexus-investing, ib-gateway, theta-terminal, postgres, redis, timescaledb).</p>

    <p>Network configuration includes: Primary connection via ethernet to home network with static IP 192.168.1.100 (recommended). Secondary USB network adapter for redundant connection to ISP modem if primary connection fails. Both connections are active in failover mode, switching automatically if primary ethernet fails. This provides trading continuity during network outages.</p>

    <h3>26.2 docker-compose.prod.yml Configuration</h3>

    <p>The production deployment uses docker-compose.prod.yml to orchestrate all system containers. This file defines services, volumes, networks, and dependencies, enabling reproducible deployment and version control.</p>

    <pre>
version: '3.8'

services:
  nexus-investing:
    image: nexus-investing:latest
    container_name: nexus_app
    depends_on:
      - postgres
      - timescaledb
      - redis
      - chromadb
    environment:
      - DB_HOST=timescaledb
      - DB_PORT=5432
      - DB_NAME=nexus_trading
      - REDIS_URL=redis://redis:6379/0
      - CHROMADB_URL=http://chromadb:8000
      - BROKER_TYPE=ibkr
      - IBKR_HOST=ib-gateway
      - IBKR_PORT=4002
      - THETA_TERMINAL_HOST=theta-terminal
      - THETA_TERMINAL_PORT=25555
      - LOG_LEVEL=INFO
    volumes:
      - /volume1/appdata/nexus/config:/app/config
      - /volume1/appdata/nexus/logs:/app/logs
      - /volume1/appdata/nexus/data:/app/data
    ports:
      - "8000:8000"  # REST API
      - "8001:8001"  # WebSocket
    restart: unless-stopped
    networks:
      - nexus-net

  ib-gateway:
    image: ibkr-gateway:latest
    container_name: ib_gateway
    environment:
      - TRADING_MODE=live
      - ACCOUNT_ID=DU123456
      - PORT=4002
    volumes:
      - /volume1/appdata/ib-gateway/config:/root/ibgateway/config
      - /volume1/appdata/ib-gateway/data:/root/ibgateway/data
    ports:
      - "4002:4002"  # TWS API Port
      - "5900:5900"  # VNC (for debugging)
    restart: unless-stopped
    networks:
      - nexus-net

  theta-terminal:
    image: theta-terminal:latest
    container_name: theta_app
    environment:
      - API_PORT=25555
      - LOG_LEVEL=DEBUG
    volumes:
      - /volume1/appdata/theta/config:/app/config
      - /volume1/appdata/theta/logs:/app/logs
    ports:
      - "25555:25555"  # WebSocket API
    restart: unless-stopped
    networks:
      - nexus-net

  postgres:
    image: postgres:15-alpine
    container_name: postgres_db
    environment:
      - POSTGRES_DB=nexus_trading
      - POSTGRES_USER=nexus_user
      - POSTGRES_PASSWORD=SecurePassword123!
    volumes:
      - /volume1/appdata/postgres/data:/var/lib/postgresql/data
      - /volume1/appdata/postgres/backups:/backups
    ports:
      - "5432:5432"
    restart: unless-stopped
    networks:
      - nexus-net

  timescaledb:
    image: timescale/timescaledb:latest-pg15
    container_name: timescaledb
    environment:
      - POSTGRES_DB=nexus_timeseries
      - POSTGRES_USER=nexus_user
      - POSTGRES_PASSWORD=SecurePassword123!
    volumes:
      - /volume1/appdata/timescaledb/data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    restart: unless-stopped
    networks:
      - nexus-net

  redis:
    image: redis:7-alpine
    container_name: redis_cache
    volumes:
      - /volume1/appdata/redis/data:/data
    ports:
      - "6379:6379"
    restart: unless-stopped
    networks:
      - nexus-net
    command: redis-server --appendonly yes

  chromadb:
    image: chromadb/chroma:latest
    container_name: chromadb
    environment:
      - IS_PERSISTENT=True
      - CHROMA_DB_IMPL=duckdb+parquet
    volumes:
      - /volume1/appdata/chromadb/data:/chroma/data
    ports:
      - "8001:8000"  # Chroma API
    restart: unless-stopped
    networks:
      - nexus-net

networks:
  nexus-net:
    driver: bridge

volumes:
  postgres_data:
    driver: local
  timescale_data:
    driver: local
  redis_data:
    driver: local
  chromadb_data:
    driver: local
    </pre>

    <h3>26.3 Container Services Overview</h3>

    <p><strong>nexus-investing:</strong> Main trading application container running the Nexus core engine. This container orchestrates all trading decisions, monitors positions, submits orders, and communicates with broker APIs. Launched with 2 CPU cores allocated (out of 4 available) and 2GB RAM (out of 8GB available).</p>

    <p><strong>ib-gateway:</strong> Interactive Brokers Gateway runs as a separate container to provide isolated access to IBKR TWS API on port 4002. This container maintains the persistent connection to IBKR servers and handles all ib_insync communication. A VNC server on port 5900 enables remote login for debugging or manual intervention if needed.</p>

    <p><strong>theta-terminal:</strong> Theta Terminal runs as a containerized application providing real-time options data via WebSocket API on port 25555. The Nexus app connects to this container to stream live quotes and Greeks for all tracked options contracts.</p>

    <p><strong>postgres:</strong> PostgreSQL database stores relational data (users, alerts, historical events) with replication support. The container is configured with automatic backups every 6 hours.</p>

    <p><strong>timescaledb:</strong> TimescaleDB (PostgreSQL extension) stores all time-series data (OHLCV bars, trades, position updates) with automatic compression of historical data. Runs on port 5433 to differentiate from standard postgres on 5432.</p>

    <p><strong>redis:</strong> Redis in-memory cache stores frequently accessed data (option quotes, computed signals, regime states) with automatic persistence via AOF (Append-Only File). Set to 512MB max memory with LRU eviction policy.</p>

    <p><strong>chromadb:</strong> ChromaDB vector database stores semantic embeddings of trades and market conditions for the FinMem agent. Configured with persistent storage to preserve learned knowledge across restarts.</p>

    <h3>26.4 Volume Mounts and Data Persistence</h3>

    <p>The deployment uses Synology volume mounts to persist all data and configuration across container restarts. All application data is stored on /volume1/appdata/{service}/, enabling easy backups and recovery. Volume structure:</p>

    <pre>
/volume1/appdata/
├── nexus/
│   ├── config/          # strategies.json, brokers.json, system.json
│   ├── logs/            # Application logs (rotated daily)
│   └── data/            # Temporary data files
├── postgres/
│   ├── data/            # PostgreSQL data directory
│   └── backups/         # Automated pg_dump backups
├── timescaledb/
│   └── data/            # TimescaleDB data directory
├── redis/
│   └── data/            # Redis RDB snapshots + AOF logs
├── chromadb/
│   └── data/            # ChromaDB vector embeddings
├── ib-gateway/
│   ├── config/          # TWS configuration
│   └── data/            # Trading logs and settings
└── theta/
    ├── config/          # Terminal settings
    └── logs/            # Terminal logs
    </pre>

    <p>Backup strategy: All data in /volume1/appdata/ is automatically backed up to /volume2/ (secondary drive) using Synology's snapshot and replication features. Full backups run weekly, with incremental backups daily. This provides disaster recovery capability if the primary drive fails or data becomes corrupted.</p>

    <h3>26.5 Container Health Checks and Restart Policies</h3>

    <p>All containers are configured with health checks and restart policies to ensure trading continuity. Health check example for nexus-investing:</p>

    <pre>
healthcheck:
  test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
  interval: 30s
  timeout: 10s
  retries: 3
  start_period: 60s
restart: unless-stopped
    </pre>

    <p>The healthcheck endpoint /health returns 200 OK if the service is operating normally, and non-200 if critical systems are unavailable. If a healthcheck fails 3 times consecutively (90 seconds), Docker automatically restarts the container. The restart: unless-stopped policy ensures containers restart automatically on NAS reboot, but don't restart if explicitly stopped via Docker CLI.</p>

    <h3>26.6 Synology Task Scheduler Configuration</h3>

    <p>Synology NAS includes a Task Scheduler for running periodic jobs. The Nexus deployment uses Task Scheduler for: (1) Nightly backups of trading data to external USB drive, (2) Weekly log rotation and compression, (3) Monthly database optimization and index rebuilding, (4) Daily monitoring and alerting if containers have crashed.</p>

    <p>Example backup task (runs daily at 02:00):</p>

    <pre>
Task Name: nexus-daily-backup
Schedule: Daily, 02:00 AM
User: root
Command: /volume1/appdata/scripts/backup.sh
    </pre>

    <p>The backup.sh script uses pg_dump to backup PostgreSQL and TimescaleDB, tar to compress config files, and rsync to sync to external backup drive. Script output is logged for monitoring.</p>

    <h3>26.7 SSH Access and Remote Management</h3>

    <p>The Synology NAS is configured with SSH enabled (port 22) for remote management. This enables the trading operator to monitor the system, view logs, and perform troubleshooting from anywhere. SSH key-based authentication is used (no password login) for security.</p>

    <p>Common SSH operations:</p>

    <pre>
# SSH into NAS
ssh -i ~/.ssh/synology_key nexus@192.168.1.100

# View container logs
docker logs -f nexus_app

# Check container status
docker ps -a

# Restart a container
docker restart nexus_app

# View resource usage
docker stats

# Execute command in container
docker exec -it nexus_app bash
    </pre>

    <p>The system maintains an SSH key pair stored securely on the NAS and a backup copy on the trading operator's machine. Key rotation occurs annually.</p>

    <h3>26.8 Monitoring and Alerting</h3>

    <p>The Nexus system logs all significant events (trade entries, exits, errors, API failures) to both file-based logs and TimescaleDB. Log aggregation enables searching and analyzing trading activity across all containers. Critical errors (position tracking failures, order rejection, broker disconnection) trigger alerts via email to the trading operator.</p>

    <p>Alert conditions include: (1) Container health check failure, (2) Broker API connection loss for >5 minutes, (3) Order rejection or fill failure, (4) Position tracking discrepancy, (5) Database write failure, (6) Disk space exceeding 80% capacity, (7) Daily drawdown exceeding configured threshold. Alerts are sent within 60 seconds of condition detection via SMTP email.</p>

</div>
<!-- PART VII HEADER -->
<div class="part-header">
    <div class="part-header-content">
        <h2>PART VII</h2>
        <p>Troubleshooting & Common Issues</p>
    </div>
</div>

<!-- CHAPTER 27: SECURITY AND CREDENTIALS -->
<div class="chapter">
    <h2>Chapter 27: Security and Credentials</h2>

    <h3>27.1 API Key Management</h3>

    <p>Secure API key management is fundamental to protecting your trading accounts and preventing unauthorized access. The NEXUS system supports multiple broker connections simultaneously, each requiring unique API credentials. Proper credential isolation ensures that if one key is compromised, the damage is limited to that specific broker.</p>

    <p>API keys must never be hardcoded into source files or committed to version control systems. The recommended approach uses environment variables combined with a `.env` file that is explicitly excluded from Git tracking.</p>

    <h4>Environment Variables Setup</h4>

    <p>Create a `.env` file in your project root directory with the following structure:</p>

    <pre><code># Alpaca API Configuration
ALPACA_API_KEY=your_alpaca_api_key_here
ALPACA_SECRET_KEY=your_alpaca_secret_key_here
ALPACA_BASE_URL=https://paper-api.alpaca.markets  # or https://api.alpaca.markets for live

# FMP (Financial Modeling Prep) API
FMP_API_KEY=your_fmp_api_key_here

# Theta Terminal API
THETA_API_KEY=your_theta_api_key_here
THETA_API_SECRET=your_theta_api_secret_here

# LLM Provider Keys
ANTHROPIC_API_KEY=your_anthropic_key_here
OPENAI_API_KEY=your_openai_key_here
GOOGLE_API_KEY=your_google_key_here

# IBKR Configuration (if using TWS)
IBKR_ACCOUNT_ID=your_ibkr_account_here
IBKR_TWS_HOST=127.0.0.1
IBKR_TWS_PORT=7497
IBKR_CLIENT_ID=1</code></pre>

    <p>Update your `.gitignore` file to prevent accidental commits:</p>

    <pre><code># Environment Variables
.env
.env.local
.env.*.local

# Credentials and Secrets
user_secrets.json
credentials.json
*_credentials.*

# Logs with potential sensitive data
logs/
*.log</code></pre>

    <p>Load environment variables in your main application file using Python's `dotenv` package:</p>

    <pre><code>from dotenv import load_dotenv
import os

# Load environment variables from .env file
load_dotenv()

# Access variables safely
alpaca_key = os.getenv('ALPACA_API_KEY')
alpaca_secret = os.getenv('ALPACA_SECRET_KEY')

if not alpaca_key or not alpaca_secret:
    raise ValueError("Alpaca API credentials not found in environment variables")</code></pre>

    <div class="info-box warning">
        <strong>CRITICAL: Never Commit API Keys</strong>
        Always verify that `.env` and credential files are in `.gitignore`. Do a final check before pushing to repositories: `git status` should never show `.env` or credential files.
    </div>

    <h3>27.2 Broker Credential Isolation</h3>

    <p>Multi-broker setups require per-profile credential management. Each broker configuration is stored independently to prevent credential leakage across different trading accounts. NEXUS uses a structured approach where each broker's credentials are isolated in separate configuration sections.</p>

    <p>The credential isolation pattern ensures that:</p>

    <ul>
        <li>Alpaca credentials are never mixed with IBKR credentials</li>
        <li>Paper trading accounts remain separate from live trading accounts</li>
        <li>Each strategy can target a specific broker configuration</li>
        <li>Credential rotation for one broker doesn't affect others</li>
        <li>Audit trails can track which credentials were used for which trades</li>
    </ul>

    <h3>27.3 user_secrets.json Structure</h3>

    <p>The `user_secrets.json` file provides a centralized location for per-profile broker credentials. This file must be excluded from version control and kept secure on your production system.</p>

    <pre><code>{
  "trading_profiles": {
    "paper_alpaca": {
      "broker": "alpaca",
      "environment": "paper",
      "api_key": "${ALPACA_API_KEY}",
      "secret_key": "${ALPACA_SECRET_KEY}",
      "base_url": "https://paper-api.alpaca.markets",
      "data_url": "https://data.alpaca.markets",
      "enabled": true
    },
    "live_alpaca": {
      "broker": "alpaca",
      "environment": "live",
      "api_key": "${ALPACA_LIVE_API_KEY}",
      "secret_key": "${ALPACA_LIVE_SECRET_KEY}",
      "base_url": "https://api.alpaca.markets",
      "data_url": "https://data.alpaca.markets",
      "enabled": false,
      "risk_limit": 25000
    },
    "paper_ibkr": {
      "broker": "ibkr",
      "environment": "paper",
      "account_id": "${IBKR_ACCOUNT_ID}",
      "tws_host": "127.0.0.1",
      "tws_port": 7497,
      "client_id": 1,
      "enabled": false
    },
    "live_ibkr": {
      "broker": "ibkr",
      "environment": "live",
      "account_id": "${IBKR_LIVE_ACCOUNT_ID}",
      "tws_host": "127.0.0.1",
      "tws_port": 7497,
      "client_id": 2,
      "enabled": false,
      "risk_limit": 50000,
      "use_2fa": true
    }
  },
  "default_profile": "paper_alpaca",
  "credential_rotation": {
    "enabled": true,
    "rotate_every_days": 90,
    "last_rotation": "2026-02-14T00:00:00Z"
  },
  "audit_logging": {
    "enabled": true,
    "log_credentials_access": false,
    "log_file": "logs/credential_access.log"
  }
}</code></pre>

    <h3>27.4 IBKR Authentication and 2FA</h3>

    <p>Interactive Brokers (IBKR) requires a more sophisticated authentication process through TWS (Trader Workstation) or IB Gateway. Unlike API-based authentication with Alpaca, IBKR uses session-based authentication with optional two-factor authentication (2FA).</p>

    <h4>IB Gateway Setup for Automated Trading</h4>

    <p>IB Gateway is the recommended approach for automated trading systems because it doesn't require a full GUI and can run headless on servers. Configure IB Gateway with these steps:</p>

    <ol>
        <li>Download IB Gateway from the Interactive Brokers website</li>
        <li>Install in a dedicated directory (e.g., `/opt/ibkr/IBGateway`)</li>
        <li>Create a configuration file `ibgateway_config.xml`</li>
        <li>Start IB Gateway with automated login</li>
        <li>Establish persistent connections using ib_insync</li>
    </ol>

    <p>Example IB Gateway startup script:</p>

    <pre><code>#!/bin/bash
# start_ibgateway.sh - Launch IB Gateway with automated credentials

export IBKR_ACCOUNT="YOUR_ACCOUNT_ID"
export IBKR_PASSWORD="YOUR_IBKR_PASSWORD"
export IBKR_USER="YOUR_IBKR_USERNAME"

# For Docker deployment
docker run -d \
  --name ibgateway \
  --restart unless-stopped \
  -p 7497:7497 \
  -e IBKR_ACCOUNT=$IBKR_ACCOUNT \
  -e IBKR_PASSWORD=$IBKR_PASSWORD \
  -e IBKR_USER=$IBKR_USER \
  ibkr/ibgateway:latest

# For local installation
cd /opt/ibkr/IBGateway
nohup java -cp ibgateway.jar ibgateway.IBGateway jts.twsStartup.DesktopServerImpl &</code></pre>

    <h4>2FA and Session Persistence</h4>

    <p>When 2FA is enabled on your IBKR account, authentication requires additional handling:</p>

    <ul>
        <li><strong>First Login:</strong> User must manually authenticate through IB Gateway UI and complete 2FA challenge</li>
        <li><strong>Session Persistence:</strong> After successful 2FA, IB Gateway maintains session state across reconnections</li>
        <li><strong>Automatic Reconnection:</strong> ib_insync automatically reconnects if the session is active</li>
        <li><strong>Session Timeout:</strong> Idle sessions expire after approximately 24 hours and require re-authentication</li>
    </ul>

    <p>Implement session management in your NEXUS connector:</p>

    <pre><code>from ib_insync import IB
import asyncio

class IBKRConnector:
    def __init__(self, host='127.0.0.1', port=7497, client_id=1):
        self.ib = IB()
        self.host = host
        self.port = port
        self.client_id = client_id
        self.session_active = False

    async def connect(self):
        """Establish connection to IB Gateway with session validation"""
        try:
            await self.ib.connectAsync(
                host=self.host,
                port=self.port,
                clientId=self.client_id,
                timeout=15
            )
            self.session_active = True
            logger.info("IBKR session established")
            return True
        except Exception as e:
            logger.error(f"IBKR connection failed: {e}")
            return False

    async def ensure_connected(self):
        """Reconnect if session is inactive"""
        if not self.ib.isConnected():
            logger.warning("IBKR session lost, reconnecting...")
            await self.connect()

    async def disconnect(self):
        """Clean shutdown of IBKR session"""
        if self.ib.isConnected():
            self.ib.disconnect()
            self.session_active = False
            logger.info("IBKR session closed")</code></pre>

    <h4>CDN Blocking and Firewall Issues</h4>

    <p>IBKR's API servers may be blocked by corporate firewalls or CDN filters. Common symptoms include connection timeouts or "Connection refused" errors. Resolve these issues with:</p>

    <ul>
        <li><strong>IP Whitelist:</strong> Whitelist IBKR's API IP ranges (provided in their documentation)</li>
        <li><strong>Port Configuration:</strong> Ensure ports 7497 (paper trading) and 7496 (live trading) are open for outbound connections</li>
        <li><strong>DNS Resolution:</strong> Verify that `api.ibkr.com` and related domains resolve correctly</li>
        <li><strong>Proxy Configuration:</strong> If behind a corporate proxy, configure ib_insync to use the proxy</li>
        <li><strong>SSH Tunnel Alternative:</strong> If direct connections are blocked, establish an SSH tunnel to a bastion host that can reach IBKR</li>
    </ul>

    <h3>27.5 Network Security</h3>

    <p>Production trading systems require robust network security controls to protect against unauthorized access and ensure reliable order execution.</p>

    <h4>Firewall Rules</h4>

    <p>Configure firewall rules to be as restrictive as possible while still allowing necessary connections:</p>

    <pre><code># Allow inbound SSH only from trusted IPs
ufw allow from 203.0.113.0/24 to any port 22 proto tcp

# Allow outbound HTTPS for API calls
ufw allow out from any to any port 443 proto tcp

# Allow outbound to IBKR API (port 7497 for paper, 7496 for live)
ufw allow out to 162.0.0.0/8 port 7497 proto tcp
ufw allow out to 162.0.0.0/8 port 7496 proto tcp

# Allow outbound to Alpaca
ufw allow out to 13.52.0.0/14 port 443 proto tcp

# Deny all other traffic
ufw default deny incoming
ufw default deny outgoing
ufw default allow outgoing</code></pre>

    <h4>SSH Key-Only Access</h4>

    <p>Disable password-based SSH authentication and use SSH keys exclusively:</p>

    <pre><code># /etc/ssh/sshd_config
PermitRootLogin no
PasswordAuthentication no
PubkeyAuthentication yes
Protocol 2
AllowUsers trading@trading-host
AuthorizedKeysFile ~/.ssh/authorized_keys</code></pre>

    <h4>Docker Network Isolation</h4>

    <p>When running NEXUS in Docker, implement strict network policies to isolate containers:</p>

    <pre><code># docker-compose.yml with network isolation
version: '3.8'

services:
  nexus:
    image: nexus-trading:v98.1
    networks:
      - trading-network
    expose:
      - 8000  # Internal API only
    environment:
      - TRADER_MODE=paper
      - LOG_LEVEL=info
    security_opt:
      - no-new-privileges:true
    read_only: true
    tmpfs:
      - /tmp
      - /run

  ibgateway:
    image: ibkr/ibgateway:latest
    networks:
      - trading-network
    expose:
      - 7497
    environment:
      - IBKR_USER=${IBKR_USER}
      - IBKR_PASSWORD=${IBKR_PASSWORD}

networks:
  trading-network:
    driver: bridge
    driver_opts:
      com.docker.network.bridge.enable_ip_masquerade: "true"</code></pre>

</div>

<!-- CHAPTER 28: COMMON ISSUES AND SOLUTIONS -->
<div class="chapter">
    <h2>Chapter 28: Common Issues and Solutions</h2>

    <h3>28.1 Connection Issues</h3>

    <p>Connection problems are among the most frequent operational issues. Systematic troubleshooting requires identifying whether the problem is transient (temporary) or persistent.</p>

    <h4>Broker Timeouts</h4>

    <p>Broker API timeouts occur when the NEXUS system cannot establish a connection within the expected timeframe. Timeouts may be caused by network latency, broker API overload, or firewall blocking.</p>

    <p>Implement exponential backoff retry logic:</p>

    <pre><code>import asyncio
import logging

class BrokerConnector:
    def __init__(self, max_retries=5, base_timeout=2):
        self.max_retries = max_retries
        self.base_timeout = base_timeout
        self.logger = logging.getLogger(__name__)

    async def connect_with_retry(self, broker_config):
        """Connect to broker with exponential backoff retry"""
        for attempt in range(self.max_retries):
            try:
                timeout = self.base_timeout * (2 ** attempt)  # 2, 4, 8, 16, 32 seconds
                self.logger.info(f"Connection attempt {attempt + 1}/{self.max_retries}, timeout: {timeout}s")

                # Establish connection
                await asyncio.wait_for(
                    self._establish_connection(broker_config),
                    timeout=timeout
                )
                self.logger.info("Connection established successfully")
                return True

            except asyncio.TimeoutError:
                self.logger.warning(f"Attempt {attempt + 1} timed out after {timeout}s")
                if attempt < self.max_retries - 1:
                    wait_time = 5 * (2 ** attempt)  # Exponential backoff: 5, 10, 20, 40, 80 seconds
                    self.logger.info(f"Waiting {wait_time}s before retry...")
                    await asyncio.sleep(wait_time)

            except Exception as e:
                self.logger.error(f"Connection error: {e}")
                if attempt < self.max_retries - 1:
                    await asyncio.sleep(5)

        self.logger.error("All connection attempts failed")
        return False

    async def _establish_connection(self, broker_config):
        """Actual connection implementation"""
        # Implementation specific to broker
        pass</code></pre>

    <h4>API Rate Limits</h4>

    <p>Alpaca and other brokers enforce rate limits to prevent API abuse. NEXUS tracks API usage and implements throttling to stay within limits:</p>

    <pre><code>from collections import deque
from datetime import datetime, timedelta

class RateLimiter:
    def __init__(self, max_requests=200, window_seconds=60):
        self.max_requests = max_requests
        self.window_seconds = window_seconds
        self.requests = deque()

    async def check_rate_limit(self):
        """Check if we can make another API call"""
        now = datetime.now()

        # Remove old requests outside the window
        while self.requests and (now - self.requests[0]) > timedelta(seconds=self.window_seconds):
            self.requests.popleft()

        if len(self.requests) >= self.max_requests:
            # Calculate backoff time
            oldest_request = self.requests[0]
            reset_time = oldest_request + timedelta(seconds=self.window_seconds)
            wait_time = (reset_time - now).total_seconds() + 0.1  # Small buffer

            if wait_time > 0:
                logger.warning(f"Rate limit reached. Waiting {wait_time:.1f}s")
                await asyncio.sleep(wait_time)

        self.requests.append(datetime.now())

    async def call_api_with_limit(self, api_func, *args, **kwargs):
        """Wrapper that applies rate limiting to any API call"""
        await self.check_rate_limit()
        return await api_func(*args, **kwargs)</code></pre>

    <h3>28.2 Event Loop Errors — V98.1 Fix Detailed</h3>

    <p>Event loop errors are the most common runtime failures in V98.1 when trading with multi-threaded architectures. Python 3.10+ introduced stricter event loop management that requires explicit event loop creation in non-main threads.</p>

    <h4>Root Cause Analysis</h4>

    <p>The error manifests in two primary forms:</p>

    <p><code>RuntimeError: There is no current event loop in thread 'ScriptRunner.scriptThread'</code></p>

    <p><code>RuntimeError: There is no current event loop in thread 'autopilot_loop'</code></p>

    <p>This occurs when asyncio functions (like `asyncio.run()` or `await`) are called in a thread that doesn't have an event loop. Python 3.10+ removed the implicit event loop creation for non-main threads that existed in earlier versions.</p>

    <h4>Detailed Fix Implementation</h4>

    <p>The fix requires creating and setting a new event loop in the thread's `__init__` method and ensuring the loop is available before any async operations:</p>

    <pre><code>import asyncio
import threading
import logging

logger = logging.getLogger(__name__)

class ScriptRunner:
    """Trading script executor with proper event loop management"""

    def __init__(self, script_name):
        self.script_name = script_name
        self.logger = logger

        # CRITICAL: Create event loop in __init__ before any async operations
        try:
            self.loop = asyncio.get_event_loop()
            if self.loop.is_closed():
                self.loop = asyncio.new_event_loop()
                asyncio.set_event_loop(self.loop)
        except RuntimeError:
            # No event loop exists in this thread
            self.loop = asyncio.new_event_loop()
            asyncio.set_event_loop(self.loop)

        self.logger.info(f"Event loop created for {script_name}")

    async def run_trading_logic(self):
        """Main async trading logic"""
        try:
            # Your trading code here
            await self._fetch_market_data()
            await self._execute_orders()
        except Exception as e:
            self.logger.error(f"Trading logic error: {e}")
            raise

    def execute(self):
        """Run trading logic with proper event loop"""
        try:
            # Use self.loop instead of asyncio.run()
            return self.loop.run_until_complete(self.run_trading_logic())
        except RuntimeError as e:
            if "no current event loop" in str(e):
                # Re-create loop and retry
                self.loop = asyncio.new_event_loop()
                asyncio.set_event_loop(self.loop)
                return self.loop.run_until_complete(self.run_trading_logic())
            raise

    async def _fetch_market_data(self):
        """Example async operation"""
        self.logger.info("Fetching market data...")
        await asyncio.sleep(1)  # Placeholder

    async def _execute_orders(self):
        """Example async operation"""
        self.logger.info("Executing orders...")
        await asyncio.sleep(1)  # Placeholder

    def __del__(self):
        """Cleanup: close event loop properly"""
        if self.loop and not self.loop.is_closed():
            self.loop.close()
            self.logger.info(f"Event loop closed for {self.script_name}")</code></pre>

    <h4>Additional Fix: _ensure_connected Method</h4>

    <p>Many connection managers need to ensure connectivity from non-main threads. Apply the same fix pattern:</p>

    <pre><code>class BrokerManager:
    def __init__(self):
        # Create event loop in __init__
        try:
            self.loop = asyncio.get_event_loop()
        except RuntimeError:
            self.loop = asyncio.new_event_loop()
            asyncio.set_event_loop(self.loop)

        self.connected = False

    async def _ensure_connected_async(self):
        """Async connection check"""
        if not self.connected:
            self.connected = await self._connect()
        return self.connected

    def _ensure_connected(self):
        """Synchronous wrapper for _ensure_connected_async"""
        try:
            return self.loop.run_until_complete(self._ensure_connected_async())
        except RuntimeError as e:
            if "no current event loop" in str(e):
                self.loop = asyncio.new_event_loop()
                asyncio.set_event_loop(self.loop)
                return self.loop.run_until_complete(self._ensure_connected_async())
            raise

    async def _connect(self):
        """Actual connection logic"""
        # Implementation
        return True</code></pre>

    <div class="info-box success">
        <strong>V98.1 Resolution</strong>
        The event loop fix is included in all V98.1 connector modules (`alpaca_connector.py`, `ibkr_connector.py`, `script_runner.py`). If upgrading from V96, ensure these files are updated to the latest version.
    </div>

    <h3>28.3 Docker Container Issues</h3>

    <h4>Permission Denied on Synology</h4>

    <p>Synology NAS systems have unique permission models that can prevent Docker containers from executing properly. The symptom is "Permission denied" errors when trying to run trading scripts or execute database operations.</p>

    <p>Solution: Use Synology Task Scheduler to execute scripts with root privileges:</p>

    <pre><code># In Synology Control Panel > Task Scheduler
# Create "Triggered Task" with these settings:

Task Name: NEXUS_Trading_Engine
Run command: /usr/local/bin/docker exec -u root nexus-trading python /app/main.py
Run as: root
Schedule: Run at system startup
    AND
    Repeat after successful execution: every 5 minutes</code></pre>

    <h4>docker: command not found</h4>

    <p>On some Synology systems, Docker is installed in a non-standard location. The full path is required:</p>

    <pre><code"># Use absolute path
/usr/local/bin/docker ps

# Add to .bashrc or shell script
export PATH="/usr/local/bin:$PATH"
docker ps  # Now works</code></pre>

    <h4>Container Won't Start</h4>

    <p>Container startup failures are usually caused by port conflicts, insufficient memory, or missing volumes:</p>

    <pre><code># Check for port conflicts
docker ps | grep LISTEN  # Lists running containers
netstat -tlnp | grep 7497  # Check if IBKR port is in use

# Verify sufficient memory (need 4GB+ for NEXUS)
docker stats nexus-trading

# Check volume mounts
docker inspect nexus-trading | grep Mounts

# View logs for detailed errors
docker logs -f nexus-trading

# Common fixes:
# 1. Free up port 7497
docker container kill $(docker ps -q --filter "expose=7497")

# 2. Allocate more memory
docker run -m 4g --memory-swap 4g nexus-trading:v98.1

# 3. Mount persistent volume for data
docker run -v nexus-data:/app/data nexus-trading:v98.1</code></pre>

    <h3>28.4 Iron Condor Order Failures</h3>

    <p>Iron condor orders are complex multi-leg orders that can fail for subtle reasons. The four most common failure modes in V98.1 are detailed below.</p>

    <h4>Wrong OCC Symbol Format</h4>

    <p>Options Contract Code (OCC) symbols have a strict format. NEXUS generates OCC symbols dynamically based on the underlying, expiration, and strike. Common mistakes:</p>

    <pre><code># WRONG - Using dashes instead of YYMMDD date
"SPY-20260221-450C"  # Incorrect format

# CORRECT - OCC format is UNDERLYING + YYMMDD + TYPE + STRIKE
"SPY20260221C00450000"  # Correct format for SPY 2026-02-21 450 Call

# V98.1 OCC generator
def generate_occ_symbol(underlying, expiration_date, strike, option_type):
    """
    Generate proper OCC symbol

    Args:
        underlying: str (e.g., "SPY")
        expiration_date: datetime
        strike: float (e.g., 450.0)
        option_type: str ("C" for call, "P" for put)

    Returns:
        str: Properly formatted OCC symbol
    """
    # Format: UNDERLYING(6) + YYMMDD(6) + TYPE(1) + STRIKE(8)
    yy = expiration_date.strftime("%y")
    mm = expiration_date.strftime("%m")
    dd = expiration_date.strftime("%d")

    underlying_padded = underlying.ljust(6)
    strike_padded = f"{strike * 1000:08.0f}"  # Convert to cents, zero-pad to 8 digits

    return f"{underlying_padded}{yy}{mm}{dd}{option_type}{strike_padded}"

# Usage
symbol = generate_occ_symbol("SPY", datetime(2026, 2, 21), 450.0, "C")
print(symbol)  # Output: SPY   20260221C00450000</code></pre>

    <h4>Missing Top-Level qty Field</h4>

    <p>Iron condor orders are submitted as single orders with four legs. The order structure must include a top-level `qty` field and individual leg quantities. Alpaca's API is strict about this requirement.</p>

    <pre><code># WRONG - Missing top-level qty
{
    "symbol": "SPY",
    "order_type": "limit",
    "time_in_force": "day",
    "legs": [
        {"symbol": "SPY20260221C00450000", "side": "sell", "qty": 1},
        {"symbol": "SPY20260221C00460000", "side": "buy", "qty": 1},
        {"symbol": "SPY20260221P00440000", "side": "buy", "qty": 1},
        {"symbol": "SPY20260221P00430000", "side": "sell", "qty": 1}
    ]
}

# CORRECT - Includes qty at top level
{
    "symbol": "SPY",
    "qty": 1,  # REQUIRED: Top-level quantity
    "order_type": "limit",
    "time_in_force": "day",
    "limit_price": 0.85,  # Credit received
    "legs": [
        {"symbol": "SPY20260221C00450000", "side": "sell", "qty": 1},
        {"symbol": "SPY20260221C00460000", "side": "buy", "qty": 1},
        {"symbol": "SPY20260221P00440000", "side": "buy", "qty": 1},
        {"symbol": "SPY20260221P00430000", "side": "sell", "qty": 1}
    ]
}</code></pre>

    <h4>Wrong REST API Attribute Names</h4>

    <p>IBKR's REST API uses different attribute names than Alpaca. Confusing the two is a common error when switching brokers:</p>

    <pre><code># Alpaca Multi-Leg Order Structure
alpaca_order = {
    "qty": 1,
    "side": "buy",
    "type": "limit",
    "time_in_force": "day",
    "limit_price": 0.85,
    "order_class": "oco",  # One-Cancels-Other
    "legs": [...]
}

# IBKR Multi-Leg Order Structure (ib_insync)
from ib_insync import Order, OrderComboLeg

ibkr_order = Order(
    action="BUY",  # Note: not "buy"
    totalQuantity=1,  # Not "qty"
    orderType="LMT",  # Not "limit"
    lmtPrice=0.85,  # Not "limit_price"
    transmit=True
)

# Common attribute name mismatches:
# Alpaca          | IBKR
# "qty"          | "totalQuantity"
# "side"         | "action" (BUY/SELL not buy/sell)
# "limit_price"  | "lmtPrice"
# "type"         | "orderType" (LMT, MKT, STP not limit, market, stop)
# "time_in_force"| "tif" (DAY, GTC, IOC not day, gtc, ioc)</code></pre>

    <h4>Delta Range Too Narrow</h4>

    <p>Iron condor profitability requires selling options at appropriate delta levels. A delta range that's too narrow results in few setup opportunities and reduced win rates.</p>

    <p>The V98.1 walk-forward optimization determined optimal delta ranges through exhaustive backtesting:</p>

    <pre><code># SUBOPTIMAL (from V96) - Too narrow
short_delta_min = 0.10
short_delta_max = 0.12
win_rate: 85.2%
annual_return: +87.3%

# OPTIMAL (V98.1) - Wider range
short_delta_min = 0.24
short_delta_max = 0.29
win_rate: 90.1%
annual_return: +156.8%

# Reasoning: Delta 0.24-0.29 implies 24-29% ITM probability
# At 7 DTE, this gives optimal risk/reward balance
# Tighter deltas (0.08-0.10) miss trades and are too risky when they occur

# Configuration in apex_config.json
{
    "iron_condor": {
        "short_delta_min": 0.24,
        "short_delta_max": 0.29,
        ...
    }
}</code></pre>

    <h4>Spread Tolerance Too Tight</h4>

    <p>When submitting limit orders for iron condors, the spread between entry credit desired and market conditions must be realistic. A tolerance that's too tight (e.g., 10%) will result in few fills and many rejected orders.</p>

    <pre><code># SUBOPTIMAL - Too tight
max_spread_pct = 0.10  # Only accepts 10% of desired credit
# Result: Very few fills, many missed opportunities

# OPTIMAL - More realistic
max_spread_pct = 0.20  # Accepts 20% of desired credit
# Result: Higher fill rate, better execution

# Implementation in order submission logic
def calculate_acceptable_credit_range(target_credit, max_spread_pct):
    """Calculate acceptable credit range for limit order"""
    minimum_credit = target_credit * (1 - max_spread_pct)
    maximum_credit = target_credit  # Never pay more than target

    return {
        "minimum": minimum_credit,
        "maximum": maximum_credit,
        "range_width_pct": max_spread_pct * 100
    }

# Example
target = 0.85  # Want to receive $0.85 per share
acceptable = calculate_acceptable_credit_range(target, 0.20)
# Result: minimum: $0.68, maximum: $0.85
# Order placed at limit_price = 0.75 (middle of range)</code></pre>

    <h3>28.5 Trailing Stop Misconfiguration</h3>

    <p>The trailing stop mechanism in NEXUS prevents losses from escalating beyond predefined thresholds. Version 98.1 corrected a critical configuration parameter naming issue that existed in earlier versions.</p>

    <h4>Parameter Name Mismatch</h4>

    <p>V96 inadvertently used inconsistent parameter naming between code and configuration files:</p>

    <pre><code># V96 INCORRECT - Parameter name mismatch
# In code: trailing_stop_activation_r (using variable name with _r suffix)
# In config: trail_trigger_r (different name, but means same thing)
# This caused confusion and incorrect values being applied

config_value = config.get("trail_trigger_r")  # From JSON
actual_param = "trailing_stop_activation_r"   # In code
# These don't match! One gets updated, the other doesn't

# V98.1 FIX - Consistent naming
# In code: trailing_stop_activation_r
# In config: trailing_stop_activation_r (SAME NAME)
# Parameter is unambiguous across all files</code></pre>

    <h4>Correct Configuration in aggressive_config.json</h4>

    <p>The fixed V98.1 configuration uses consistent parameter names throughout:</p>

    <pre><code>{
  "strategy_name": "aggressive_iron_condor",
  "iron_condor": {
    "enabled": true,
    "short_delta_min": 0.08,
    "short_delta_max": 0.10,
    "wing_width": 20,
    "max_contracts": 3,
    "dte_target": 3,
    "trading_days": ["Monday", "Wednesday", "Friday"]
  },
  "exit_strategy": {
    "trailing_stop_activation_r": 0.5,  # CORRECT parameter name
    "trailing_stop_distance_atr": 0.5,  # Distance of trailing stop from price
    "profit_target_pct": 0.75,  # Exit at 75% of max profit
    "time_stop": "14:30"  # Exit time
  },
  "dead_trade_time_stop": {
    "enabled": false,  # Disable for iron condors
    "exit_time": "14:30"
  }
}</code></pre>

    <h3>28.6 Memory Issues on Synology</h3>

    <p>Synology NAS systems have limited RAM compared to dedicated servers. As NEXUS runs multiple components (trading engine, broker gateway, LLM agents, database), memory can become exhausted.</p>

    <h4>Monitor Memory Usage</h4>

    <pre><code># Check current memory allocation
docker stats --no-stream

# Output example:
# CONTAINER       MEM USAGE / LIMIT
# nexus-trading   2.3GB / 4GB
# ibgateway       1.1GB / 2GB
# chromadb        0.5GB / 1GB
# Total used: 3.9GB / 7GB - Getting close to limit!</code></pre>

    <h4>Stop Unused Containers</h4>

    <p>Containers running but not actively trading consume memory. In the example below, stopping iBeam freed approximately 232MB:</p>

    <pre><code># Check which containers are running
docker ps

# Stop specific container
docker stop ibeam

# Monitor memory reduction
docker stats --no-stream

# Before: 3.9GB used
# After: 3.65GB used
# Freed: ~250MB</code></pre>

    <h4>Optimize NEXUS Memory Usage</h4>

    <pre><code># In docker-compose.yml, set memory limits
services:
  nexus:
    image: nexus-trading:v98.1
    mem_limit: 2g
    memswap_limit: 2g
    environment:
      # Python memory optimization
      PYTHONUNBUFFERED: "1"
      # Reduce LLM context window during low-activity periods
      LLM_CONTEXT_REDUCTION: "enabled"

  ibgateway:
    image: ibkr/ibgateway:latest
    mem_limit: 1.5g
    memswap_limit: 1.5g

  chromadb:
    image: chromadb/chroma:latest
    mem_limit: 512m
    memswap_limit: 512m</code></pre>

    <h3>28.7 ChromaDB Corruption</h3>

    <p>ChromaDB is used for vector similarity search when analyzing market setups. Occasionally, the database can become corrupted, manifesting as "database locked" or "invalid metadata" errors.</p>

    <p>The simplest solution is to delete and rebuild the database:</p>

    <pre><code>#!/bin/bash
# rebuild_chromadb.sh - Recover from ChromaDB corruption

echo "Stopping services that use ChromaDB..."
docker stop nexus-trading

echo "Removing corrupted database..."
rm -rf /data/nexus/chromadb_cache/*
rm -rf /data/nexus/.chroma

echo "Restarting services..."
docker start nexus-trading

# Monitor for errors
docker logs -f nexus-trading

# ChromaDB will automatically rebuild on first access
# This operation takes 2-5 minutes depending on dataset size</code></pre>

    <h3>28.8 LLM API Failures</h3>

    <p>NEXUS uses multiple LLM providers (Claude, GPT-4, Gemini, Llama). When one provider's API is unavailable, the system should gracefully degrade to fallback models.</p>

    <h4>Retry Logic Implementation</h4>

    <pre><code>import asyncio
import logging
from enum import Enum

logger = logging.getLogger(__name__)

class LLMProvider(Enum):
    CLAUDE = "claude-opus-4-6"
    GPT4 = "gpt-4o"
    GEMINI = "gemini-pro"
    LLAMA = "llama-3.1"

class LLMOrchestrator:
    def __init__(self):
        self.provider_order = [
            LLMProvider.CLAUDE,
            LLMProvider.GPT4,
            LLMProvider.GEMINI,
            LLMProvider.LLAMA
        ]
        self.max_retries = 3
        self.retry_delay = 5  # seconds

    async def call_llm_with_fallback(self, prompt, temperature=0.7):
        """Call LLM with automatic fallback to next provider on failure"""

        for provider in self.provider_order:
            for attempt in range(self.max_retries):
                try:
                    logger.info(f"Attempting {provider.value} (attempt {attempt + 1}/{self.max_retries})")

                    response = await self._call_provider(provider, prompt, temperature)
                    logger.info(f"Success with {provider.value}")
                    return response

                except asyncio.TimeoutError:
                    logger.warning(f"{provider.value} timeout on attempt {attempt + 1}")
                    if attempt < self.max_retries - 1:
                        await asyncio.sleep(self.retry_delay)

                except Exception as e:
                    logger.error(f"{provider.value} error: {e}")
                    if attempt < self.max_retries - 1:
                        await asyncio.sleep(self.retry_delay)

            logger.warning(f"{provider.value} failed all attempts, trying next provider...")

        # All providers failed
        logger.critical("All LLM providers failed!")
        raise RuntimeError("No available LLM providers")

    async def _call_provider(self, provider, prompt, temperature):
        """Actual provider implementation"""
        # Implementation specific to each provider
        pass

    async def respect_rate_limits(self, provider):
        """Check rate limit status before calling provider"""
        status = await self._get_provider_status(provider)

        if status.rate_limited:
            wait_time = status.reset_time - datetime.now()
            logger.warning(f"{provider.value} rate limited, waiting {wait_time.total_seconds():.0f}s")
            await asyncio.sleep(wait_time.total_seconds() + 1)

        return True

    async def _get_provider_status(self, provider):
        """Check rate limit and availability status"""
        # Implementation
        pass</code></pre>

    <h4>Rate Limit Handling</h4>

    <p>Different LLM providers have different rate limits. Track usage and implement token bucket algorithms:</p>

    <pre><code>from datetime import datetime, timedelta
from dataclasses import dataclass

@dataclass
class RateLimitBucket:
    max_requests: int
    requests_per_minute: int
    current_count: int
    reset_time: datetime

    def is_available(self):
        if datetime.now() > self.reset_time:
            self.current_count = 0
            self.reset_time = datetime.now() + timedelta(minutes=1)
        return self.current_count < self.max_requests

    def consume(self):
        if self.is_available():
            self.current_count += 1
            return True
        return False

class RateLimitManager:
    def __init__(self):
        self.buckets = {
            LLMProvider.CLAUDE: RateLimitBucket(
                max_requests=100,
                requests_per_minute=60,
                current_count=0,
                reset_time=datetime.now() + timedelta(minutes=1)
            ),
            LLMProvider.GPT4: RateLimitBucket(
                max_requests=60,
                requests_per_minute=30,
                current_count=0,
                reset_time=datetime.now() + timedelta(minutes=1)
            ),
            # Add other providers...
        }

    async def wait_until_available(self, provider):
        """Wait if rate limited"""
        bucket = self.buckets[provider]
        while not bucket.is_available():
            wait_time = (bucket.reset_time - datetime.now()).total_seconds()
            logger.info(f"Rate limited on {provider.value}, waiting {wait_time:.1f}s")
            await asyncio.sleep(min(wait_time + 0.5, 60))  # Cap wait at 60s

        bucket.consume()</code></pre>

</div>

<!-- PART VIII HEADER -->
<div class="part-header">
    <div class="part-header-content">
        <h2>PART VIII</h2>
        <p>Appendices & Reference Material</p>
    </div>
</div>

<!-- APPENDIX A: COMPLETE CONFIGURATION REFERENCE -->
<div class="chapter">
    <h2>Appendix A: Complete Configuration Reference</h2>

    <h3>apex_config.json — Full V98.1 Parameters</h3>

    <p>The primary configuration file for the NEXUS trading engine. All parameters are documented with their optimal values determined through walk-forward optimization.</p>

    <pre><code>{
  "strategy_name": "apex_iron_condor",
  "version": "98.1",
  "description": "Primary iron condor strategy with walk-forward optimized parameters",

  "market_hours": {
    "market_open": "09:30",
    "market_close": "16:00",
    "trading_timezone": "America/New_York"
  },

  "iron_condor": {
    "enabled": true,
    "dte_target": 7,
    "short_delta_min": 0.24,
    "short_delta_max": 0.29,
    "wing_width": 10,
    "max_contracts": 5,
    "entry_window_start": "09:35",
    "entry_window_end": "14:00",
    "trading_days": ["Monday", "Wednesday"],

    "vix_filter": {
      "enabled": true,
      "vix_min": 12,
      "vix_max": 30
    },

    "exit_parameters": {
      "profit_target_pct": 0.50,
      "per_side_stop_multiple": 2.0,
      "time_stop": "14:30",
      "hard_exit": "15:45"
    },

    "order_parameters": {
      "order_type": "limit",
      "max_spread_pct": 0.20,
      "time_in_force": "day"
    }
  },

  "call_buying": {
    "enabled": false,
    "reason": "Disabled - negative expected value from backtests"
  },

  "credit_spread": {
    "enabled": true,
    "dte_target": 3,
    "delta_target": 0.30,
    "spread_width": 5,
    "max_contracts": 3,
    "profit_target_pct": 0.75,
    "stop_loss_pct": 2.0
  },

  "use_apex_engine": true,
  "apex_agent_count": 8,
  "llm_providers": ["claude-opus", "gpt-4o", "gemini-pro", "llama-3.1"],

  "database": {
    "type": "postgresql",
    "host": "localhost",
    "port": 5432,
    "database": "nexus_trading",
    "schema": "public"
  },

  "logging": {
    "level": "INFO",
    "format": "%(asctime)s - %(name)s - %(levelname)s - %(message)s",
    "file": "logs/nexus_trading.log"
  }
}</code></pre>

    <h3>aggressive_config.json — High Frequency Parameters</h3>

    <p>Configuration for aggressive trading strategies with tighter deltas and more frequent entries. Use with caution and only with adequate experience and risk tolerance.</p>

    <pre><code>{
  "strategy_name": "aggressive_iron_condor",
  "version": "98.1",

  "iron_condor": {
    "enabled": true,
    "dte_target": 3,
    "short_delta_min": 0.08,
    "short_delta_max": 0.10,
    "wing_width": 20,
    "max_contracts": 3,
    "trading_days": ["Monday", "Wednesday", "Friday"]
  },

  "exit_strategy": {
    "trailing_stop_activation_r": 0.5,
    "trailing_stop_distance_atr": 0.5,
    "profit_target_pct": 0.50,
    "time_stop": "14:30"
  },

  "dead_trade_time_stop": {
    "enabled": false,
    "exit_time": "14:30"
  }
}</code></pre>

</div>

<!-- APPENDIX B: VERSION HISTORY -->
<div class="chapter">
    <h2>Appendix B: Version History</h2>

    <p>Complete changelog of NEXUS Investing from initial release (V76) through the current V98.1. Each version represents significant milestones in the platform's evolution.</p>

    <table class="comparison-table">
        <thead>
            <tr>
                <th>Version</th>
                <th>Release Date</th>
                <th>Major Features</th>
                <th>Key Improvements</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>V98.1</strong></td>
                <td>February 2026</td>
                <td>Live Iron Condor Execution, IBKR TWS Integration, Walk-Forward Optimization</td>
                <td>+181% improvement in baseline strategy, Trailing Stop Fix, Event Loop Resolution</td>
            </tr>
            <tr>
                <td><strong>V96.2</strong></td>
                <td>February 9, 2026</td>
                <td>Alpaca Multi-Leg Orders, IC Entry/Exit Automation</td>
                <td>Automated order leg sequencing, position monitoring</td>
            </tr>
            <tr>
                <td><strong>V96.1.2</strong></td>
                <td>February 9, 2026</td>
                <td>Configuration Bug Fixes</td>
                <td>Trailing Stop Config Fix, restart.sh reliability improvements</td>
            </tr>
            <tr>
                <td><strong>V96.1</strong></td>
                <td>February 8, 2026</td>
                <td>Walk-Forward Optimization Framework</td>
                <td>Historical backtest correlation, rolling window analysis</td>
            </tr>
            <tr>
                <td><strong>V96.0</strong></td>
                <td>February 6, 2026</td>
                <td>Premium Selling Focus (Iron Condors + Credit Spreads)</td>
                <td>Shift from call buying to higher win rate strategies</td>
            </tr>
            <tr>
                <td><strong>V95.0</strong></td>
                <td>February 6, 2026</td>
                <td>Level 3 Options Greeks, IV Percentile</td>
                <td>Theta/Vega analysis, implied volatility monitoring</td>
            </tr>
            <tr>
                <td><strong>V94</strong></td>
                <td>February 2026</td>
                <td>Position Management Framework</td>
                <td>EOD Tightening, HOD Hold, Dead Trade Stop logic</td>
            </tr>
            <tr>
                <td><strong>V93</strong></td>
                <td>January 2026</td>
                <td>Confluence Scoring, Dark Pool Detection</td>
                <td>Multi-timeframe confluence, Options GEX analysis</td>
            </tr>
            <tr>
                <td><strong>V91</strong></td>
                <td>January 2026</td>
                <td>Fast Lane Architecture</td>
                <td>APEX Engine deployment, LangGraph multi-agent system</td>
            </tr>
            <tr>
                <td><strong>V89</strong></td>
                <td>December 2025</td>
                <td>Trailing Stops, ATR-Based Exits</td>
                <td>Dynamic stop loss sizing, volatility-aware risk management</td>
            </tr>
            <tr>
                <td><strong>V86</strong></td>
                <td>December 2025</td>
                <td>Setup Grading System (A-D)</td>
                <td>Kill Zones, time-of-day filtering, statistical edge detection</td>
            </tr>
            <tr>
                <td><strong>V76</strong></td>
                <td>November 2025</td>
                <td>Initial Multi-Agent Framework</td>
                <td>First release with LLM-powered agents, Alpaca integration</td>
            </tr>
        </tbody>
    </table>

</div>

<!-- APPENDIX C: GLOSSARY OF TERMS -->
<div class="chapter">
    <h2>Appendix C: Glossary of Terms</h2>

    <p>Comprehensive definitions of trading and technical terms used throughout the NEXUS documentation.</p>

    <table class="comparison-table">
        <thead>
            <tr>
                <th>Term</th>
                <th>Definition</th>
                <th>Context</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>Iron Condor (IC)</strong></td>
                <td>A four-leg options strategy combining a short call spread and short put spread on the same underlying. Profits if the stock remains between the short strike prices at expiration.</td>
                <td>Primary trading strategy in V98.1</td>
            </tr>
            <tr>
                <td><strong>Credit Spread</strong></td>
                <td>A two-leg options strategy where you sell an option and buy a further out-of-the-money option to define risk. Profit is the difference (credit) received upfront.</td>
                <td>Secondary income strategy</td>
            </tr>
            <tr>
                <td><strong>Delta</strong></td>
                <td>The rate of change of option price relative to underlying stock price. Ranges from 0.0 to 1.0. A delta of 0.30 means the option gains $0.30 for every $1.00 move in the stock.</td>
                <td>Critical for entry selection</td>
            </tr>
            <tr>
                <td><strong>Theta</strong></td>
                <td>Time decay of an option. Measures how much value an option loses per day as it approaches expiration. Positive theta is beneficial for short premium strategies.</td>
                <td>Key driver of iron condor profitability</td>
            </tr>
            <tr>
                <td><strong>Gamma</strong></td>
                <td>Rate of change of delta. High gamma means delta is very sensitive to small stock moves. Long gamma is beneficial for long option positions.</td>
                <td>Risk factor in short premium positions</td>
            </tr>
            <tr>
                <td><strong>Vega</strong></td>
                <td>Sensitivity of option price to changes in implied volatility. Higher vega means more price movement from IV changes. Important for managing risk in volatile markets.</td>
                <td>Volatility risk management</td>
            </tr>
            <tr>
                <td><strong>Greeks</strong></td>
                <td>Collective term for Delta, Gamma, Theta, Vega, and Rho. These measure different risk dimensions of option positions.</td>
                <td>Core to options risk management</td>
            </tr>
            <tr>
                <td><strong>GEX (Gamma Exposure)</strong></td>
                <td>Aggregate gamma across all open options positions. Indicates how destabilizing (high gamma) or stabilizing (negative gamma) the options market is at different price levels.</td>
                <td>Regime detection and market structure</td>
            </tr>
            <tr>
                <td><strong>Max Pain</strong></td>
                <td>The stock price at expiration where options holders (both calls and puts) lose the most money collectively. Often attracts price movement due to dealer hedging.</td>
                <td>Support/resistance prediction</td>
            </tr>
            <tr>
                <td><strong>VIX</strong></td>
                <td>Volatility Index - measures implied volatility of S&P 500 options. Higher VIX indicates greater expected market volatility. Used as a market fear gauge.</td>
                <td>Regime filtering in NEXUS</td>
            </tr>
            <tr>
                <td><strong>OCC Symbol</strong></td>
                <td>Options Clearing Corporation standardized symbol format. Example: SPY20260221C00450000 represents SPY call, expiring 2026-02-21, strike $450.</td>
                <td>Order submission and identification</td>
            </tr>
            <tr>
                <td><strong>DTE (Days to Expiration)</strong></td>
                <td>Number of calendar days remaining until options contract expires. V98.1 primarily targets 7 DTE and 3 DTE positions.</td>
                <td>Entry and exit timing</td>
            </tr>
            <tr>
                <td><strong>ATR (Average True Range)</strong></td>
                <td>Measure of volatility that accounts for gaps and limit moves. Used to set dynamic stop losses and trailing stop distances.</td>
                <td>Risk sizing and exit thresholds</td>
            </tr>
            <tr>
                <td><strong>VWAP (Volume Weighted Average Price)</strong></td>
                <td>Average price weighted by trading volume. Used to identify intraday support/resistance and entry execution quality.</td>
                <td>Entry price analysis</td>
            </tr>
            <tr>
                <td><strong>Confluence Score</strong></td>
                <td>Multi-factor scoring system that combines technical analysis, volume, sentiment, and other indicators. Higher scores indicate higher probability setups.</td>
                <td>Trade selection filtering</td>
            </tr>
            <tr>
                <td><strong>Regime Detection</strong></td>
                <td>Automatic classification of market conditions (trending, range-bound, volatile, quiet). NEXUS adjusts parameters based on detected regime.</td>
                <td>Adaptive strategy configuration</td>
            </tr>
            <tr>
                <td><strong>Walk-Forward Efficiency</strong></td>
                <td>Metric comparing backtest performance to forward test performance. Measures how well optimized parameters generalize to new data.</td>
                <td>Parameter optimization validation</td>
            </tr>
            <tr>
                <td><strong>Sharpe Ratio</strong></td>
                <td>Risk-adjusted return metric. Calculated as (returns - risk_free_rate) / standard_deviation. Higher is better (typically >1.0 is strong).</td>
                <td>Strategy performance evaluation</td>
            </tr>
            <tr>
                <td><strong>Sortino Ratio</strong></td>
                <td>Similar to Sharpe ratio but only penalizes downside deviation. More favorable to strategies with positive skew (gains larger than losses).</td>
                <td>Alternative performance metric</td>
            </tr>
            <tr>
                <td><strong>FinMem</strong></td>
                <td>Financial memory system in NEXUS that stores historical trade data, patterns, and outcomes for LLM agents to reference.</td>
                <td>Agent learning and decision making</td>
            </tr>
            <tr>
                <td><strong>VRL (Volatility Regime Logic)</strong></td>
                <td>System that classifies volatility regimes and adjusts trading parameters. Low VRL uses tight deltas, high VRL uses wider deltas.</td>
                <td>Adaptive parameter management</td>
            </tr>
            <tr>
                <td><strong>Thompson Sampling</strong></td>
                <td>Bayesian exploration-exploitation algorithm. NEXUS uses it to balance trying new setups vs. repeating known profitable patterns.</td>
                <td>Multi-armed bandit strategy selection</td>
            </tr>
            <tr>
                <td><strong>Kill Zone</strong></td>
                <td>Time periods or price ranges where trading is disabled due to historically poor performance. Typical kill zones include first 30 min and last 15 min of day.</td>
                <td>Risk reduction through avoidance</td>
            </tr>
            <tr>
                <td><strong>Circuit Breaker</strong></td>
                <td>Automatic trading halt triggered when losses exceed threshold (e.g., 2% of account equity). Prevents catastrophic losses in extreme market moves.</td>
                <td>Risk management safeguard</td>
            </tr>
            <tr>
                <td><strong>Dark Pool</strong></td>
                <td>Private exchange where large orders are executed away from public order books. Detection of dark pool absorption can indicate strong directional interest.</td>
                <td>Market microstructure analysis</td>
            </tr>
            <tr>
                <td><strong>OBV (On-Balance Volume)</strong></td>
                <td>Technical indicator that accumulates volume based on price direction. Rising OBV with rising price is a bullish divergence.</td>
                <td>Sentiment and trend confirmation</td>
            </tr>
            <tr>
                <td><strong>Support/Resistance</strong></td>
                <td>Price levels where buying (support) or selling (resistance) pressure is historically strong. Important for identifying breakout probabilities.</td>
                <td>Technical level identification</td>
            </tr>
            <tr>
                <td><strong>Pre-Fetch</strong></td>
                <td>Architecture pattern where market data is fetched proactively before analysis, reducing latency in decision-making.</td>
                <td>System performance optimization</td>
            </tr>
            <tr>
                <td><strong>LangGraph</strong></td>
                <td>Framework for building multi-agent workflows with LLMs. NEXUS uses LangGraph for orchestrating eight specialized trading agents.</td>
                <td>Core architecture component</td>
            </tr>
            <tr>
                <td><strong>ib_insync</strong></td>
                <td>Python library providing async wrapper around Interactive Brokers TWS/IB Gateway. Enables real-time order execution and data streaming.</td>
                <td>IBKR integration in V98.1</td>
            </tr>
        </tbody>
    </table>

</div>

<!-- APPENDIX D: API ENDPOINT REFERENCE -->
<div class="chapter">
    <h2>Appendix D: API Endpoint Reference</h2>

    <h3>FMP (Financial Modeling Prep) Endpoints</h3>

    <table class="comparison-table">
        <thead>
            <tr>
                <th>Endpoint</th>
                <th>Method</th>
                <th>Purpose</th>
                <th>Rate Limit</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><code>/quote/{symbol}</code></td>
                <td>GET</td>
                <td>Real-time quote and Greeks</td>
                <td>250/min</td>
            </tr>
            <tr>
                <td><code>/option-chain</code></td>
                <td>GET</td>
                <td>Options chain for underlying</td>
                <td>100/min</td>
            </tr>
            <tr>
                <td><code>/historical-price-full/{symbol}</code></td>
                <td>GET</td>
                <td>OHLCV historical data</td>
                <td>250/min</td>
            </tr>
            <tr>
                <td><code>/vix</code></td>
                <td>GET</td>
                <td>VIX index value</td>
                <td>100/min</td>
            </tr>
            <tr>
                <td><code>/market-data/gainers</code></td>
                <td>GET</td>
                <td>Daily top gainers</td>
                <td>50/min</td>
            </tr>
        </tbody>
    </table>

    <h3>Theta Terminal Endpoints</h3>

    <table class="comparison-table">
        <thead>
            <tr>
                <th>Endpoint</th>
                <th>Method</th>
                <th>Purpose</th>
                <th>Auth</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><code>/snapshot/quotes/options</code></td>
                <td>GET</td>
                <td>Real-time options quotes</td>
                <td>API Key</td>
            </tr>
            <tr>
                <td><code>/snapshot/quotes/greeks</code></td>
                <td>GET</td>
                <td>Level 3 Greek analysis</td>
                <td>API Key</td>
            </tr>
            <tr>
                <td><code>/history/daily</code></td>
                <td>GET</td>
                <td>Daily OHLCV data</td>
                <td>API Key</td>
            </tr>
            <tr>
                <td><code>/analytics/iv_percentile</code></td>
                <td>GET</td>
                <td>IV percentile relative to 52-week range</td>
                <td>API Key</td>
            </tr>
        </tbody>
    </table>

    <h3>Alpaca Endpoints (Including Multi-Leg)</h3>

    <table class="comparison-table">
        <thead>
            <tr>
                <th>Endpoint</th>
                <th>Method</th>
                <th>Purpose</th>
                <th>Auth</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><code>/v1/trading/accounts/{account_id}</code></td>
                <td>GET</td>
                <td>Account details and buying power</td>
                <td>API Key</td>
            </tr>
            <tr>
                <td><code>/v2/orders</code></td>
                <td>POST</td>
                <td>Submit order (including multi-leg)</td>
                <td>API Key</td>
            </tr>
            <tr>
                <td><code>/v2/orders/{order_id}</code></td>
                <td>GET</td>
                <td>Get order status and details</td>
                <td>API Key</td>
            </tr>
            <tr>
                <td><code>/v2/positions</code></td>
                <td>GET</td>
                <td>List all open positions</td>
                <td>API Key</td>
            </tr>
            <tr>
                <td><code>/v2/options/quotes</code></td>
                <td>GET</td>
                <td>Real-time options quotes</td>
                <td>API Key</td>
            </tr>
        </tbody>
    </table>

    <h3>IBKR TWS Methods (via ib_insync)</h3>

    <table class="comparison-table">
        <thead>
            <tr>
                <th>Method</th>
                <th>Parameters</th>
                <th>Returns</th>
                <th>Async</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><code>qualifyContracts()</code></td>
                <td>contract</td>
                <td>List[Contract]</td>
                <td>Yes</td>
            </tr>
            <tr>
                <td><code>reqMktData()</code></td>
                <td>contract, snapshot</td>
                <td>Ticker</td>
                <td>Yes</td>
            </tr>
            <tr>
                <td><code>placeOrder()</code></td>
                <td>contract, order</td>
                <td>Trade</td>
                <td>Yes</td>
            </tr>
            <tr>
                <td><code>positions()</code></td>
                <td>none</td>
                <td>List[Position]</td>
                <td>No</td>
            </tr>
            <tr>
                <td><code>reqGreeks()</code></td>
                <td>contract</td>
                <td>Greeks data</td>
                <td>Yes</td>
            </tr>
        </tbody>
    </table>

</div>

<!-- APPENDIX E: PERFORMANCE BENCHMARKS -->
<div class="chapter">
    <h2>Appendix E: Performance Benchmarks</h2>

    <h3>8-Year Historical Backtest (2017-2024)</h3>

    <p>Comprehensive backtest results on V98.1 baseline iron condor strategy across major market indices.</p>

    <table class="comparison-table">
        <thead>
            <tr>
                <th>Year</th>
                <th>Return %</th>
                <th>Win Rate</th>
                <th>Sharpe Ratio</th>
                <th>Max Drawdown</th>
                <th>Notes</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>2024</td>
                <td>-13.8%</td>
                <td>68.3%</td>
                <td>-0.42</td>
                <td>-18.5%</td>
                <td>High volatility, choppy markets</td>
            </tr>
            <tr>
                <td>2023</td>
                <td>+129.4%</td>
                <td>91.2%</td>
                <td>2.18</td>
                <td>-8.2%</td>
                <td>Excellent volatility environment</td>
            </tr>
            <tr>
                <td>2022</td>
                <td>+2.0%</td>
                <td>72.1%</td>
                <td>0.18</td>
                <td>-12.3%</td>
                <td>Low volatility period</td>
            </tr>
            <tr>
                <td>2021</td>
                <td>+156.8%</td>
                <td>89.7%</td>
                <td>2.84</td>
                <td>-5.1%</td>
                <td>High vol, strong market</td>
            </tr>
            <tr>
                <td>2020</td>
                <td>+261.3%</td>
                <td>94.2%</td>
                <td>4.12</td>
                <td>-2.8%</td>
                <td>COVID-era volatility</td>
            </tr>
            <tr>
                <td>2019</td>
                <td>+74.3%</td>
                <td>87.5%</td>
                <td>1.92</td>
                <td>-6.7%</td>
                <td>Fed pivot, stable</td>
            </tr>
            <tr>
                <td>2018</td>
                <td>+89.7%</td>
                <td>90.1%</td>
                <td>2.14</td>
                <td>-4.3%</td>
                <td>December volatility event</td>
            </tr>
            <tr>
                <td>2017</td>
                <td>+45.2%</td>
                <td>84.3%</td>
                <td>1.23</td>
                <td>-7.9%</td>
                <td>Low volatility regime</td>
            </tr>
            <tr>
                <td style="background-color: #e7ffe7;"><strong>Average</strong></td>
                <td style="background-color: #e7ffe7;"><strong>+94.8%</strong></td>
                <td style="background-color: #e7ffe7;"><strong>84.4%</strong></td>
                <td style="background-color: #e7ffe7;"><strong>1.64</strong></td>
                <td style="background-color: #e7ffe7;"><strong>-8.2%</strong></td>
                <td style="background-color: #e7ffe7;"><strong>8 Winning Years / 8</strong></td>
            </tr>
        </tbody>
    </table>

    <h3>Iron Condor vs Credit Spread Performance (2023-2024)</h3>

    <p>Head-to-head comparison of iron condor and credit spread strategies with live execution data from V98.1.</p>

    <table class="comparison-table">
        <thead>
            <tr>
                <th>Strategy</th>
                <th>Configuration</th>
                <th>Total P&L</th>
                <th>Win Rate</th>
                <th>Avg Win</th>
                <th>Avg Loss</th>
                <th>Profit Factor</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>Iron Condor</strong></td>
                <td>ic_dte7_d10</td>
                <td>+$10,444</td>
                <td>90.1%</td>
                <td>+$287</td>
                <td>-$945</td>
                <td>2.84</td>
            </tr>
            <tr>
                <td><strong>Credit Spread</strong></td>
                <td>cs_dte3_d20</td>
                <td>+$5,457</td>
                <td>100%</td>
                <td>+$156</td>
                <td>$0</td>
                <td>∞</td>
            </tr>
            <tr>
                <td><strong>Call Buying</strong></td>
                <td>cb_legacy</td>
                <td>-$5,458</td>
                <td>13%</td>
                <td>+$325</td>
                <td>-$401</td>
                <td>0.21</td>
            </tr>
        </tbody>
    </table>

    <div class="info-box success">
        <strong>Performance Insight</strong>
        Iron condor strategies outperformed call buying by $15,902 (356% difference). This dramatic performance gap is the primary reason V98.1 shifted focus away from directional trading to premium selling.
    </div>

</div>

<!-- APPENDIX F: RISK DISCLOSURES -->
<div class="chapter">
    <h2>Appendix F: Risk Disclosures</h2>

    <h3>Full Legal Risk Disclosure</h3>

    <p><strong>IMPORTANT RISK DISCLOSURE:</strong> Trading options and equities involves substantial risk and is not suitable for all investors. The past performance of this algorithmic trading system, as shown in historical backtests and live trading results, does not guarantee future results. All securities trading, including options trading, carries the risk of substantial financial loss. You could lose some or all of your investment.</p>

    <p><strong>SPECIFIC RISKS OF OPTIONS TRADING:</strong> Options are more risky than equities. Options trading can result in rapid and substantial loss of capital. Leverage inherent in options trading can amplify gains but also amplifies losses. Iron condor strategies involve selling options, which creates unlimited loss potential on the short call leg if the stock rallies sharply. Short premium strategies profit from time decay but suffer losses if volatility increases or if price moves against the position.</p>

    <p><strong>SYSTEM RISKS:</strong> This trading system relies on automated order execution, real-time data feeds, and network connectivity. System failures, data feed interruptions, broker API outages, or execution errors could result in unexpected losses. The system uses multiple third-party APIs (Alpaca, IBKR, FMP, Theta Terminal) that may experience unavailability. There is no guarantee that orders will be executed as intended, or executed at all, in live trading.</p>

    <p><strong>CAPITAL RISK:</strong> Only use capital that you can afford to lose entirely. Options trading should never be attempted with borrowed money or with funds needed for living expenses. Margin accounts introduce additional risks including forced liquidation if account equity falls below maintenance requirements.</p>

    <p><strong>MARKET RISK:</strong> This system was optimized on historical data from 2017-2024. Market conditions may change significantly in ways that render historical correlations obsolete. Black swan events (market crashes, geopolitical shocks, pandemic closures) can cause losses that exceed the historical maximum drawdown shown in backtests.</p>

    <p><strong>BROKER RISK:</strong> Interactive Brokers, Alpaca, and other brokers may change their fee structures, API requirements, or risk policies without notice. Regulation of options trading and margin requirements may change. Broker insolvency, while rare, would result in loss of funds held with that broker.</p>

    <p><strong>NO PROFESSIONAL ADVICE:</strong> This system and manual are provided for informational purposes only and do not constitute investment advice, financial advice, or a recommendation to trade. You should consult with a qualified financial advisor, tax professional, and legal counsel before implementing any trading strategy. Results shown are not warranted or guaranteed to apply to your personal situation.</p>

    <p><strong>COMPLIANCE:</strong> You are responsible for ensuring compliance with all applicable laws and regulations in your jurisdiction. Options trading may be restricted or prohibited for certain account types or individuals. Tax implications of trading can be complex; consult a qualified tax professional.</p>

</div>

<!-- APPENDIX G: ACKNOWLEDGMENTS -->
<div class="chapter">
    <h2>Appendix G: Acknowledgments</h2>

    <h3>Technology & Infrastructure</h3>

    <p><strong>Core Technologies:</strong> Python 3.10+, AsyncIO, LangGraph (LangChain), Docker, PostgreSQL</p>

    <p><strong>Data Providers:</strong> Financial Modeling Prep (FMP), Theta Terminal, Alpaca Data API, Interactive Brokers market data</p>

    <p><strong>LLM Providers & Models:</strong> Anthropic (Claude Opus 4.6, Claude Haiku 3.5), OpenAI (GPT-4o), Google (Gemini Pro), Meta (Llama 3.1)</p>

    <p><strong>Broker Integrations:</strong> Alpaca Securities (paper and live trading), Interactive Brokers (TWS/IB Gateway), ib_insync library</p>

    <p><strong>Database & Search:</strong> ChromaDB (vector similarity search), PostgreSQL (persistent state), Redis (caching)</p>

    <p><strong>Development Tools:</strong> Git, GitHub, Docker, Jupyter Notebooks, VS Code, pytest, Black (code formatting), mypy (type checking)</p>

    <h3>Special Contributions</h3>

    <p><strong>Walk-Forward Optimization Research:</strong> Methodologies adapted from academic literature on rolling-window backtesting and parameter stability analysis. Special thanks to research into options implied volatility surface construction and Greeks calculation methodologies.</p>

    <p><strong>Iron Condor Strategy Design:</strong> Optimal delta targeting (0.24-0.29) derived from extensive historical analysis and optimization on V98.0 and V96 releases. Entry window timing (09:35-14:00) optimized through machine learning analysis of intraday liquidity patterns.</p>

    <p><strong>Multi-Agent Architecture:</strong> LangGraph workflow design enables eight specialized agents to operate in concert. Inspired by research into distributed AI systems and multi-armed bandit exploration strategies.</p>

    <p><strong>Community & Feedback:</strong> Stability improvements, bug fixes, and feature requests from active trading community. Special recognition to early V96 testers who identified and helped resolve event loop issues in Python 3.10+ threading environments.</p>

    <h3>Version 98.1 Development Team</h3>

    <p>NEXUS Investing V98.1 represents the collaborative effort of quantitative traders, software engineers, and financial technologists. The platform combines cutting-edge AI/ML capabilities with proven trading methodologies to create a robust, production-ready trading system.</p>

</div>
</body>
</html>
